import{_ as ae,r as c,K as te,y as se,c as w,L as re,M as le,o as oe,E as ne,l as g,k as U,i as d,f as u,N as B,O as ce,w as i,P as ie,q as j,b as de,e as h,S as ue,Q as pe,R as me,T as ye,x as I,U as L,p as z,W as ve}from"./index-B12n8wa1.js";const ge={class:"card-management-container"},he={key:0,class:"filter-panel"},fe={class:"filter-content"},Ie=["title"],_e={key:0,class:"filter-indicator"},be={key:0},we={key:1},ke={key:2},Ae={key:3},Ce={__name:"cardManagementDetails",setup(Ne){const M=de(),k=c(!1),_=c(null),y=c(!0),l=c(""),p=c(1),b=c(25),F=c(0),v=c([]),S=c([]),A=te.getTenantId(),C=se.getToken();c(["rfid","tag"]);const x=w(()=>[{key:"employeeId",label:"EmpId",sortable:!1,width:"120px"},{key:"employeeName",label:"Name",sortable:!1,width:"150px"},{key:"rfidCard",label:"RFID Card",sortable:!0,width:"150px"},{key:"type",label:"Type",sortable:!0,width:"100px"},{key:"cardAccess",label:"Card Access",sortable:!0,width:"120px"},{key:"accessLevelsId",label:"Access Level",sortable:!1,width:"130px"}]),s=re({type:[],cardAccess:"all",organization:"",department:"",branch:""}),q=[{key:"branch",label:"Branch",type:"select",show:!0},{key:"department",label:"Department",type:"select",show:!0}],R=w(()=>({type:s.type,cardAccess:s.cardAccess,organization:s.organization,department:s.department,branch:s.branch})),D=w(()=>s.type.length>0||s.cardAccess!=="all"||s.organization||s.branch||s.department||l.value!==""),N=c([]),V=e=>{switch(e==null?void 0:e.toLowerCase()){case"rfid":return"primary";case"tag":return"info";default:return"grey"}},Q=e=>{console.log("Row clicked:",e),e&&e.employeeId&&e.employeeId.id?(console.log("Navigating to employee:",e.employeeId.id),M.push(`/employee-details/employee/${e.employeeId.id}/accessmodule`)):(console.error("Invalid item or employee ID not found"),console.log("Item structure:",e))},H=async()=>{var e,a,r;try{if(!C||!A)throw new Error("Authentication required or tenant not found");const o={"aggregate[count]":"id",...E()},t=Object.keys(o).map($=>`${$}=${o[$]}`).join("&"),n=await fetch(`https://appv1.fieldseasy.com/directus/items/cardManagement?${t}`,{headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const f=await n.json();F.value=((r=(a=(e=f==null?void 0:f.data)==null?void 0:e[0])==null?void 0:a.count)==null?void 0:r.id)||0}catch(o){console.error("Error fetching aggregate count:",o),o.value="Failed to load card count"}},m=async()=>{try{k.value=!0,_.value=null,await H();const e={fields:["id","tenant.tenantId","accessLevelsId","cardAccessLevelArray","cardAccessLevelHex","employeeId.employeeId","rfidCard","employeeId.id","employeeId.assignedUser.first_name","type","cardAccess"],...E(),sort:"date_created",page:p.value,limit:b.value},a=Object.keys(e).map(t=>t==="fields"?e[t].map(n=>`fields[]=${n}`).join("&"):`${t}=${e[t]}`).join("&"),r=await fetch(`https://appv1.fieldseasy.com/directus/items/cardManagement?${a}`,{headers:{Authorization:`Bearer ${C}`}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const o=await r.json();N.value=o.data,console.log("Fetched card management data:",o.data)}catch(e){console.error("Error fetching card management data:",e),_.value=e.message||"Failed to load card data"}finally{k.value=!1}},E=()=>{const e={};return e["filter[tenant][tenantId][_eq]"]=A,l.value&&(isNaN(l.value)?(e["filter[_or][0][type][_icontains]"]=l.value,e["filter[_or][1][employeeId][assignedUser][first_name][_icontains]"]=l.value,e["filter[_or][2][employeeId][employeeId][_icontains]"]=l.value):(e["filter[_or][0][rfidCard][_eq]"]=l.value,e["filter[_or][1][accessLevelsId][_eq]"]=l.value,e["filter[_or][2][employeeId][employeeId][_icontains]"]=l.value)),s.type.length>0&&(e["filter[type][_in]"]=s.type.join(",")),s.cardAccess!=="all"&&(e["filter[cardAccess][_eq]"]=s.cardAccess),e},P=w(()=>N.value.map(e=>{var o,t,n,f;const a=((t=(o=e.employeeId)==null?void 0:o.assignedUser)==null?void 0:t.first_name)||"N/A",r=((n=e.employeeId)==null?void 0:n.employeeId)||"N/A";return{...e,employeeName:a,employeeId:{employeeId:r,id:(f=e.employeeId)==null?void 0:f.id}}})),O=e=>{Object.assign(s,e),p.value=1,y.value=!0,m()},K=e=>{y.value=e},T=le.debounce(()=>{p.value=1,m()},300),W=()=>{y.value=!y.value},G=()=>{s.type=[],s.cardAccess="all",s.organization="",s.department="",s.branch="",l.value="",p.value=1,m()},J=e=>{var a;v.value=[{key:e,order:((a=v.value[0])==null?void 0:a.order)||"asc"}]},X=e=>{var a;v.value=[{key:((a=v.value[0])==null?void 0:a.key)||"",order:e}]},Y=({field:e,direction:a})=>{v.value=[{key:e,order:a}],m()},Z=e=>{p.value=e,m()},ee=e=>{b.value=e,p.value=1,m()};return oe(async()=>{await m()}),ne(l,()=>{T()}),(e,a)=>(h(),g("div",ge,[y.value?(h(),g("div",he,[d("div",fe,[u(ce,{tenantId:B(A),initialFilters:R.value,initiallyVisible:!0,"filter-schema":q,onApplyFilters:O,onFilterVisibilityChanged:K},null,8,["tenantId","initialFilters"])])])):U("",!0),d("div",{class:j(["main-content",{"full-width":!y.value}])},[u(ie,{searchQuery:l.value,"onUpdate:searchQuery":[a[3]||(a[3]=r=>l.value=r),B(T)],showSearch:!0,searchPlaceholder:"Search Card Details",isEmpty:P.value.length===0&&!l.value,hasError:_.value},{"before-search":i(()=>[d("button",{class:j(["filter-toggle-static",{active:D.value}]),onClick:W,title:y.value?"Hide filters":"Show filters","aria-label":"Toggle filters"},[a[4]||(a[4]=d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[d("polygon",{points:"22,3 2,3 10,12.46 10,19 14,21 14,12.46"})],-1)),D.value?(h(),g("div",_e)):U("",!0)],10,Ie)]),pagination:i(()=>[u(ve,{page:p.value,"onUpdate:page":[a[1]||(a[1]=r=>p.value=r),Z],itemsPerPage:b.value,"onUpdate:itemsPerPage":[a[2]||(a[2]=r=>b.value=r),ee],"total-items":F.value},null,8,["page","itemsPerPage","total-items"])]),default:i(()=>{var r,o;return[k.value?(h(),g("div",be,[u(ue,{variant:"table-body-only",rows:N.value.length||10,columns:x.value.length},null,8,["rows","columns"])])):_.value?(h(),g("div",we,[u(pe,{title:"Unable to load card details",message:_.value,onRetry:m},null,8,["message"])])):P.value.length===0?(h(),g("div",ke,[u(me,{title:"No card details found",message:"Try adjusting your filters or search term",primaryAction:{text:"Clear Filters"},onPrimaryAction:G})])):(h(),g("div",Ae,[u(ye,{items:P.value,columns:x.value,selectedItems:S.value,showSelection:!1,sortBy:((r=v.value[0])==null?void 0:r.key)||"",sortDirection:((o=v.value[0])==null?void 0:o.order)||"asc",itemKey:"id",rowClickable:!0,"onUpdate:selectedItems":a[0]||(a[0]=t=>S.value=t),"onUpdate:sortBy":J,"onUpdate:sortDirection":X,onRowClick:Q,onSort:Y},{"cell-employeeId":i(({item:t})=>{var n;return[d("span",null,I(((n=t.employeeId)==null?void 0:n.employeeId)||"N/A"),1)]}),"cell-employeeName":i(({item:t})=>[d("span",null,I(t.employeeName||"N/A"),1)]),"cell-rfidCard":i(({item:t})=>[d("span",null,I(t.rfidCard||"N/A"),1)]),"cell-type":i(({item:t})=>[u(L,{color:V(t.type),size:"small",label:"",variant:"tonal"},{default:i(()=>[z(I(t.type),1)]),_:2},1032,["color"])]),"cell-cardAccess":i(({item:t})=>[u(L,{color:t.cardAccess?"success":"error",size:"small",label:""},{default:i(()=>[z(I(t.cardAccess?"Enable":"Disable"),1)]),_:2},1032,["color"])]),"cell-accessLevelsId":i(({item:t})=>[d("span",null,I(t.accessLevelsId||"N/A"),1)]),_:1},8,["items","columns","selectedItems","sortBy","sortDirection"])]))]}),_:1},8,["searchQuery","isEmpty","hasError","onUpdate:searchQuery"])],2)]))}},Fe=ae(Ce,[["__scopeId","data-v-2510b014"]]);export{Fe as default};
