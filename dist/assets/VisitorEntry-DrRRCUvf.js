import{_ as B,r as v,o as O,c as h,a as V,w as a,V as z,e as f,f as t,j as w,i as s,I as M,J as b,a2 as C,C as T,s as g,v as p,p as r,x as c,be as R,l as I,b3 as E,F as $,B as j,b4 as q,H as S}from"./index-B12n8wa1.js";import{v as _}from"./visitorService-CAUcA7DC.js";import{p as H}from"./passTemplateService-D9Jd4I3Q.js";const W={class:"text-body-1 mb-4 text-center"},A={class:"d-flex align-center pa-3"},L={class:"flex-grow-1"},D={class:"font-weight-bold"},G={class:"text-caption"},J={class:"font-weight-bold text-h6"},Q={key:1,class:"text-center pa-4 text-grey"},Y={class:"d-flex justify-center my-4 pa-4 border rounded dashed"},K={class:"text-center py-6"},X={__name:"VisitorEntry",setup(Z){const u=v(1),n=v(!1),y=v(""),x=v(null),m=v([]),d=v(null),o=v({mobile:"",name:"",purpose:"",host:""});O(async()=>{try{const i=await H.getAll();m.value=i.filter(e=>e.type==="Visitor"),m.value.length>0&&(d.value=m.value[0].id)}catch(i){console.error(i)}});const k=h(()=>{const i=m.value.find(e=>e.id===d.value);return i?i.cost:0}),F=async()=>{o.value.mobile&&(n.value=!0,setTimeout(()=>{n.value=!1,u.value=2},1e3))},U=async()=>{n.value=!0,setTimeout(()=>{n.value=!1,y.value==="1234"?u.value=3:alert("Invalid OTP (Use 1234)")},1e3)},N=async()=>{const{valid:i}=await x.value.validate();if(i){n.value=!0;try{const e=m.value.find(l=>l.id===d.value);await _.create({...o.value,passType:e.name,cost:e.cost,accessMode:e.accessMode}),u.value=5}catch(e){console.error(e),alert("Check-in failed")}finally{n.value=!1}}},P=()=>{o.value={mobile:"",name:"",purpose:"",host:""},y.value="",u.value=1};return(i,e)=>(f(),V(z,{class:"fill-height bg-grey-lighten-5 justify-center",fluid:""},{default:a(()=>[t(w,{width:"100%","max-width":"450",class:"rounded-xl",elevation:"4"},{default:a(()=>[e[23]||(e[23]=s("div",{class:"bg-primary pa-6 text-center rounded-t-xl"},[s("h2",{class:"text-h5 font-weight-bold text-white mb-2"},"Welcome Visitor"),s("p",{class:"text-white opacity-80"},"Please check-in to continue")],-1)),t(M,{modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=l=>u.value=l),class:"pa-6"},{default:a(()=>[t(b,{value:1},{default:a(()=>[e[10]||(e[10]=s("p",{class:"text-body-1 mb-4 text-center"},"Enter your mobile number to verify.",-1)),t(C,{onSubmit:T(F,["prevent"])},{default:a(()=>[t(g,{modelValue:o.value.mobile,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.mobile=l),label:"Mobile Number",variant:"outlined","prepend-inner-icon":"mdi-phone",class:"mb-4 rounded-lg",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"]),t(p,{block:"",color:"primary",size:"large",class:"rounded-lg",type:"submit",loading:n.value},{default:a(()=>e[9]||(e[9]=[r(" Send OTP ")])),_:1},8,["loading"])]),_:1})]),_:1}),t(b,{value:2},{default:a(()=>[s("p",W,"Enter the OTP sent to "+c(o.value.mobile)+".",1),e[13]||(e[13]=s("div",{class:"text-caption text-center text-grey mb-4"},"Use '1234' for demo",-1)),t(R,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=l=>y.value=l),length:"4",class:"mb-4 justify-center"},null,8,["modelValue"]),t(p,{block:"",color:"primary",size:"large",class:"rounded-lg",onClick:U,loading:n.value},{default:a(()=>e[11]||(e[11]=[r(" Verify ")])),_:1},8,["loading"]),t(p,{block:"",variant:"text",class:"mt-2",onClick:e[2]||(e[2]=l=>u.value--)},{default:a(()=>e[12]||(e[12]=[r("Back")])),_:1})]),_:1}),t(b,{value:3},{default:a(()=>[e[15]||(e[15]=s("p",{class:"text-h6 mb-4 text-center"},"Select Your Pass",-1)),m.value.length>0?(f(),V(E,{key:0,modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=l=>d.value=l)},{default:a(()=>[(f(!0),I($,null,j(m.value,l=>(f(),V(w,{key:l.id,border:"",class:"mb-3",elevation:"0",onClick:ee=>d.value=l.id,color:d.value===l.id?"primary-lighten-5":""},{default:a(()=>[s("div",A,[t(q,{value:l.id,class:"flex-grow-0 mr-2"},null,8,["value"]),s("div",L,[s("div",D,c(l.name),1),s("div",G,c(l.duration)+" Hours • "+c(l.accessMode),1)]),s("div",J,c(l.cost===0?"Free":`₹${l.cost}`),1)])]),_:2},1032,["onClick","color"]))),128))]),_:1},8,["modelValue"])):(f(),I("div",Q,"Loading passes...")),t(p,{block:"",color:"primary",size:"large",class:"rounded-lg mt-4",onClick:e[4]||(e[4]=l=>u.value=4),disabled:!d.value},{default:a(()=>e[14]||(e[14]=[r(" Next ")])),_:1},8,["disabled"])]),_:1}),t(b,{value:4},{default:a(()=>[e[18]||(e[18]=s("p",{class:"text-body-1 mb-4 text-center"},"Almost there! Fill in your details.",-1)),t(C,{ref_key:"detailsForm",ref:x,onSubmit:T(N,["prevent"])},{default:a(()=>[t(g,{modelValue:o.value.name,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.name=l),label:"Full Name",variant:"outlined",density:"comfortable",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"]),t(g,{modelValue:o.value.purpose,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.purpose=l),label:"Purpose of Visit",variant:"outlined",density:"comfortable",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"]),t(g,{modelValue:o.value.host,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.host=l),label:"Host Name (Optional)",variant:"outlined",density:"comfortable"},null,8,["modelValue"]),s("div",Y,[t(S,{size:"40",color:"grey"},{default:a(()=>e[16]||(e[16]=[r("mdi-camera")])),_:1}),e[17]||(e[17]=s("span",{class:"ml-2 align-self-center text-grey"},"Take Photo",-1))]),t(p,{block:"",color:"success",size:"large",class:"rounded-lg",type:"submit",loading:n.value},{default:a(()=>[r(c(k.value>0?`Pay ₹${k.value} & Check In`:"Check In"),1)]),_:1},8,["loading"])]),_:1},512)]),_:1}),t(b,{value:5},{default:a(()=>[s("div",K,[t(S,{color:"success",size:"80",class:"mb-4"},{default:a(()=>e[19]||(e[19]=[r("mdi-qrcode")])),_:1}),e[21]||(e[21]=s("h3",{class:"text-h5 font-weight-bold mb-2"},"Check-in Successful!",-1)),e[22]||(e[22]=s("p",{class:"text-grey mb-6"},"Show this QR code at the entrance.",-1)),t(p,{variant:"outlined",onClick:P},{default:a(()=>e[20]||(e[20]=[r("New Check-in")])),_:1})])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}},se=B(X,[["__scopeId","data-v-be92f3cb"]]);export{se as default};
