import{_ as te,r as u,K as le,y as se,c as N,L as oe,M as re,o as ne,E as B,l as f,k as T,i as m,f as y,N as j,O as ie,w as c,P as ce,q as L,b as de,e as _,S as ue,Q as pe,R as ve,T as me,x as g,U as z,p as M,W as ye}from"./index-B12n8wa1.js";const ge={class:"card-management-container"},he={key:0,class:"filter-panel"},fe={class:"filter-content"},_e=["title"],be={key:0,class:"filter-indicator"},Ie={key:0},we={key:1},ke={key:2},Ae={key:3},Ce={key:0,class:"pagination-info"},Ne={__name:"cardDetails",setup(Fe){const q=de(),I=u(!1),A=u(null),b=u(!0),n=u(""),s=u(1),h=u(25),i=u(0),p=u([]),x=u([]),F=le.getTenantId(),S=se.getToken();u(["rfid","tag"]);const D=N(()=>[{key:"employeeId",label:"EmpId",sortable:!1,width:"120px"},{key:"employeeName",label:"Name",sortable:!1,width:"150px"},{key:"rfidCard",label:"RFID Card",sortable:!0,width:"150px"},{key:"type",label:"Type",sortable:!0,width:"100px"},{key:"cardAccess",label:"Card Access",sortable:!0,width:"120px"},{key:"accessLevelsId",label:"Access Level",sortable:!1,width:"130px"}]),l=oe({type:[],cardAccess:"all",organization:"",department:"",branch:""}),R=[{key:"branch",label:"Branch",type:"select",show:!0},{key:"department",label:"Department",type:"select",show:!0}],V=N(()=>({type:l.type,cardAccess:l.cardAccess,organization:l.organization,department:l.department,branch:l.branch})),E=N(()=>l.type.length>0||l.cardAccess!=="all"||l.organization||l.branch||l.department||n.value!==""),w=u([]),Q=e=>{switch(e==null?void 0:e.toLowerCase()){case"rfid":return"primary";case"tag":return"info";default:return"grey"}},H=e=>{console.log("Row clicked:",e),e&&e.employeeId&&e.employeeId.id?(console.log("Navigating to employee:",e.employeeId.id),q.push(`/employee-details/employee/${e.employeeId.id}/accessmodule`)):(console.error("Invalid item or employee ID not found"),console.log("Item structure:",e))},O=async()=>{var e,t,o;try{if(!S||!F)throw new Error("Authentication required or tenant not found");const r={"aggregate[count]":"id",...$()};delete r.page,delete r.limit,delete r.sort;const a=Object.keys(r).map(U=>`${U}=${r[U]}`).join("&"),d=await fetch(`https://appv1.fieldseasy.com/directus/items/cardManagement?${a}`,{headers:{Authorization:`Bearer ${S}`,"Content-Type":"application/json"}});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const k=await d.json();i.value=((o=(t=(e=k==null?void 0:k.data)==null?void 0:e[0])==null?void 0:t.count)==null?void 0:o.id)||0,console.log("Total items count:",i.value)}catch(r){console.error("Error fetching aggregate count:",r),r.value="Failed to load card count",i.value=0}},v=async()=>{try{if(I.value=!0,A.value=null,s.value>1&&i.value>0){const a=Math.ceil(i.value/h.value);a>0&&s.value>a&&(s.value=1)}await O();const e={fields:["id","tenant.tenantId","accessLevelsId","cardAccessLevelArray","cardAccessLevelHex","employeeId.employeeId","rfidCard","employeeId.id","employeeId.assignedUser.first_name","type","cardAccess"],...$(),sort:p.value.length>0?`${p.value[0].key}${p.value[0].order==="desc",""}`:"date_created",page:s.value,limit:h.value},t=Object.keys(e).map(a=>a==="fields"?e[a].map(d=>`fields[]=${d}`).join("&"):`${a}=${e[a]}`).join("&");console.log("Fetching data with params:",e);const o=await fetch(`https://appv1.fieldseasy.com/directus/items/cardManagement?${t}`,{headers:{Authorization:`Bearer ${S}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const r=await o.json();w.value=r.data,console.log("Fetched card management data:",r.data)}catch(e){console.error("Error fetching card management data:",e),A.value=e.message||"Failed to load card data",w.value=[],i.value=0}finally{I.value=!1}},$=()=>{const e={};return e["filter[tenant][tenantId][_eq]"]=F,n.value&&(isNaN(n.value)?(e["filter[_or][0][type][_icontains]"]=n.value,e["filter[_or][1][employeeId][assignedUser][first_name][_icontains]"]=n.value,e["filter[_or][2][employeeId][employeeId][_icontains]"]=n.value):(e["filter[_or][0][rfidCard][_eq]"]=n.value,e["filter[_or][1][accessLevelsId][_eq]"]=n.value,e["filter[_or][2][employeeId][employeeId][_icontains]"]=n.value)),l.type.length>0&&(e["filter[type][_in]"]=l.type.join(",")),l.cardAccess!=="all"&&(e["filter[cardAccess][_eq]"]=l.cardAccess),e},C=N(()=>w.value.map(e=>{var r,a,d,k;const t=((a=(r=e.employeeId)==null?void 0:r.assignedUser)==null?void 0:a.first_name)||"N/A",o=((d=e.employeeId)==null?void 0:d.employeeId)||"N/A";return{...e,employeeName:t,employeeId:{employeeId:o,id:(k=e.employeeId)==null?void 0:k.id}}})),K=e=>{Object.assign(l,e),s.value=1,b.value=!0,v()},W=e=>{b.value=e},P=re.debounce(()=>{s.value=1,v()},300),G=()=>{b.value=!b.value},J=()=>{l.type=[],l.cardAccess="all",l.organization="",l.department="",l.branch="",n.value="",s.value=1,v()},X=e=>{var t;p.value=[{key:e,order:((t=p.value[0])==null?void 0:t.order)||"asc"}]},Y=e=>{var t;p.value=[{key:((t=p.value[0])==null?void 0:t.key)||"",order:e}]},Z=({field:e,direction:t})=>{p.value=[{key:e,order:t}],s.value=1,v()},ee=e=>{console.log("Page changed to:",e),e!==s.value&&!I.value&&(s.value=e,v(),window.scrollTo({top:0,behavior:"smooth"}))},ae=e=>{console.log("Items per page changed to:",e),e!==h.value&&(h.value=e,s.value=1,v())};return ne(async()=>{await v()}),B(n,()=>{P()}),B([w,i],()=>{w.value.length===0&&i.value>0&&s.value>1&&(console.log("No data on current page, resetting to page 1"),s.value=1,v())}),(e,t)=>(_(),f("div",ge,[b.value?(_(),f("div",he,[m("div",fe,[y(ie,{tenantId:j(F),initialFilters:V.value,initiallyVisible:!0,"filter-schema":R,onApplyFilters:K,onFilterVisibilityChanged:W},null,8,["tenantId","initialFilters"])])])):T("",!0),m("div",{class:L(["main-content",{"full-width":!b.value}])},[y(ce,{searchQuery:n.value,"onUpdate:searchQuery":[t[3]||(t[3]=o=>n.value=o),j(P)],showSearch:!0,searchPlaceholder:"Search Card Details",isEmpty:C.value.length===0&&!n.value,hasError:A.value},{"before-search":c(()=>[m("button",{class:L(["filter-toggle-static",{active:E.value}]),onClick:G,title:b.value?"Hide filters":"Show filters","aria-label":"Toggle filters"},[t[4]||(t[4]=m("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[m("polygon",{points:"22,3 2,3 10,12.46 10,19 14,21 14,12.46"})],-1)),E.value?(_(),f("div",be)):T("",!0)],10,_e)]),"before-pagination":c(()=>[!I.value&&C.value.length>0&&i.value>0?(_(),f("div",Ce," Showing "+g((s.value-1)*h.value+1)+" to "+g(Math.min(s.value*h.value,i.value))+" of "+g(i.value)+" entries ",1)):T("",!0)]),pagination:c(()=>[y(ye,{page:s.value,"onUpdate:page":[t[1]||(t[1]=o=>s.value=o),ee],itemsPerPage:h.value,"onUpdate:itemsPerPage":[t[2]||(t[2]=o=>h.value=o),ae],"total-items":i.value,loading:I.value,"items-per-page-options":[10,25,50,100]},null,8,["page","itemsPerPage","total-items","loading"])]),default:c(()=>{var o,r;return[I.value?(_(),f("div",Ie,[y(ue,{variant:"table-body-only",rows:w.value.length||10,columns:D.value.length},null,8,["rows","columns"])])):A.value?(_(),f("div",we,[y(pe,{title:"Unable to load card details",message:A.value,onRetry:v},null,8,["message"])])):C.value.length===0?(_(),f("div",ke,[y(ve,{title:"No card details found",message:"Try adjusting your filters or search term",primaryAction:{text:"Clear Filters"},onPrimaryAction:J})])):(_(),f("div",Ae,[y(me,{items:C.value,columns:D.value,selectedItems:x.value,showSelection:!1,sortBy:((o=p.value[0])==null?void 0:o.key)||"",sortDirection:((r=p.value[0])==null?void 0:r.order)||"asc",itemKey:"id",rowClickable:!0,"onUpdate:selectedItems":t[0]||(t[0]=a=>x.value=a),"onUpdate:sortBy":X,"onUpdate:sortDirection":Y,onRowClick:H,onSort:Z},{"cell-employeeId":c(({item:a})=>{var d;return[m("span",null,g(((d=a.employeeId)==null?void 0:d.employeeId)||"N/A"),1)]}),"cell-employeeName":c(({item:a})=>[m("span",null,g(a.employeeName||"N/A"),1)]),"cell-rfidCard":c(({item:a})=>[m("span",null,g(a.rfidCard||"N/A"),1)]),"cell-type":c(({item:a})=>[y(z,{color:Q(a.type),size:"small",label:"",variant:"tonal"},{default:c(()=>[M(g(a.type),1)]),_:2},1032,["color"])]),"cell-cardAccess":c(({item:a})=>[y(z,{color:a.cardAccess?"success":"error",size:"small",label:""},{default:c(()=>[M(g(a.cardAccess?"Enable":"Disable"),1)]),_:2},1032,["color"])]),"cell-accessLevelsId":c(({item:a})=>[m("span",null,g(a.accessLevelsId||"N/A"),1)]),_:1},8,["items","columns","selectedItems","sortBy","sortDirection"])]))]}),_:1},8,["searchQuery","isEmpty","hasError","onUpdate:searchQuery"])],2)]))}},Te=te(Ne,[["__scopeId","data-v-9749bbd5"]]);export{Te as default};
