import{c as U}from"./canteenService-CyqqLO9V.js";import{r as u,c as O,o as ae,a as p,w as a,aR as le,e as n,f as l,aY as se,l as b,a_ as oe,p as i,a0 as W,v as g,i as s,x as d,aG as ne,j as T,$ as ie,ak as j,a1 as N,a7 as re,F as A,B as E,a8 as de,a9 as ue,b0 as ce,aj as F,b6 as R,k as P,aC as ve,bf as fe,H as S,aQ as pe,V as me,U as Y,m as ge,av as ye,g as xe,h as be,X as J,s as we,al as Ve}from"./index-B12n8wa1.js";const H="accesseasy_wallets_db",Q=()=>{const c=localStorage.getItem(H);return c?JSON.parse(c):{}},G=c=>{localStorage.setItem(H,JSON.stringify(c))},$={async getBalance(c){await new Promise(r=>setTimeout(r,300));const v=Q();return v[c]||(v[c]={points:500,transactions:[]},G(v)),v[c]},async deductPoints(c,v,r){await new Promise(w=>setTimeout(w,400));const k=Q(),m=k[c];if(!m||m.points<v)throw new Error("Insufficient Balance");return m.points-=v,m.transactions.push({id:Date.now(),type:"DEBIT",amount:v,description:r,date:new Date().toISOString()}),G(k),m.points}},ke={key:1,class:"mr-4 text-right"},Ce={class:"text-caption font-weight-bold"},_e={class:"text-caption text-success font-weight-bold"},Pe={key:1},Be={class:"mx-1 text-caption"},Ie={class:"pa-4 bg-grey-lighten-5"},Me={class:"d-flex justify-space-between mb-2 text-h6 font-weight-bold"},Te={key:0,class:"mb-3 pa-3 bg-white rounded border"},Se={class:"d-flex justify-space-between mb-2"},he={class:"text-caption font-weight-bold"},Oe={key:0,class:"text-center text-caption text-error mt-1"},Ae={class:"d-flex overflow-x-auto mb-4 pb-2",style:{gap:"12px"}},Ee={class:"d-flex"},$e={class:"ml-3 flex-grow-1"},ze={class:"d-flex justify-space-between"},De={class:"text-subtitle-1 font-weight-medium"},qe={class:"text-caption text-grey-darken-1"},Le={class:"d-flex justify-space-between align-center mt-2"},Ue={key:0,class:"text-decoration-line-through text-caption text-grey mr-1"},We={class:"font-weight-bold text-primary"},je={class:"bg-white pa-3 rounded border d-inline-block mb-4"},Ne={class:"text-body-2 bg-grey-lighten-4 pa-2 rounded"},Fe={class:"font-weight-bold"},Qe={__name:"CanteenClientApp",setup(c){const v=u([]),r=u([]),k=u(!0),m=u(!1),w=u("All"),B=u(!1),I=u(!1),V=u(null),_=u(!1),f=u(null),y=u(null),M=u("EMP001"),h=u(""),K=O(()=>{let o=v.value;return w.value!=="All"&&(o=o.filter(e=>e.category===w.value)),o.map(e=>({...e,originalPrice:e.price,price:f.value?Math.floor(e.price*.8):e.price}))}),z=O(()=>r.value.reduce((o,e)=>o+e.quantity,0)),C=O(()=>r.value.reduce((o,e)=>o+e.price*e.quantity,0)),X=async()=>{k.value=!0;try{v.value=await U.getMenu()}catch(o){console.error(o)}finally{k.value=!1}},Z=async()=>{if(M.value)try{f.value={id:M.value,name:"John Doe"},y.value=await $.getBalance(f.value.id),_.value=!1,r.value=[]}catch(o){console.error(o)}},ee=o=>{const e=r.value.find(t=>t.id===o.id);e?e.quantity++:r.value.push({...o,quantity:1}),B.value=!0},D=(o,e)=>{const t=r.value.find(x=>x.id===o.id);t&&(t.quantity+=e,t.quantity<=0&&te(o.id))},te=o=>{r.value=r.value.filter(e=>e.id!==o)},q=async o=>{m.value=!0,h.value=o;try{o==="Wallet"&&f.value&&(await $.deductPoints(f.value.id,C.value,"Canteen Order"),y.value=await $.getBalance(f.value.id));const e=r.value.map(t=>({...t}));V.value=await U.placeOrder(e,C.value),V.value.total=C.value,V.value.paymentMode=o,V.value.id=Math.floor(Math.random()*1e5),r.value=[],B.value=!1,I.value=!0}catch(e){alert("Order failed: "+e.message)}finally{m.value=!1}};return ae(X),(o,e)=>(n(),p(le,null,{default:a(()=>[l(se,{color:"white",elevation:"1"},{default:a(()=>[l(oe,{class:"text-primary font-weight-bold"},{default:a(()=>e[9]||(e[9]=[i("Tasty Bites")])),_:1}),l(W),f.value?(n(),b("div",ke,[s("div",Ce,d(f.value.name),1),s("div",_e,d(y.value?`₹${y.value.points}`:"0 Pts"),1)])):(n(),p(g,{key:0,variant:"text",size:"small",onClick:e[0]||(e[0]=t=>_.value=!0),color:"primary"},{default:a(()=>e[10]||(e[10]=[i(" Emp Login ")])),_:1})),l(ne,{modelValue:B.value,"onUpdate:modelValue":e[3]||(e[3]=t=>B.value=t),"close-on-content-click":!1,location:"bottom end"},{activator:a(({props:t})=>[l(g,ve({icon:"",color:"grey-darken-2"},t),{default:a(()=>[z.value>0?(n(),p(fe,{key:0,content:z.value,color:"error"},{default:a(()=>[l(S,null,{default:a(()=>e[11]||(e[11]=[i("mdi-cart-outline")])),_:1})]),_:1},8,["content"])):(n(),p(S,{key:1},{default:a(()=>e[12]||(e[12]=[i("mdi-cart-outline")])),_:1}))]),_:2},1040)]),default:a(()=>[l(T,{width:"350"},{default:a(()=>[l(ie,null,{default:a(()=>e[13]||(e[13]=[i("Your Cart")])),_:1}),l(j),r.value.length===0?(n(),p(N,{key:0,class:"text-center text-grey py-8"},{default:a(()=>e[14]||(e[14]=[i("Cart is empty")])),_:1})):(n(),b("div",Pe,[l(re,{density:"compact",class:"overflow-y-auto",style:{"max-height":"300px"}},{default:a(()=>[(n(!0),b(A,null,E(r.value,t=>(n(),p(de,{key:t.id},{prepend:a(()=>[l(F,{rounded:"",size:"32"},{default:a(()=>[l(R,{src:t.image,cover:""},null,8,["src"])]),_:2},1024)]),append:a(()=>[l(g,{icon:"mdi-minus",size:"x-small",variant:"text",density:"compact",onClick:x=>D(t,-1)},null,8,["onClick"]),s("span",Be,d(t.quantity),1),l(g,{icon:"mdi-plus",size:"x-small",variant:"text",density:"compact",onClick:x=>D(t,1)},null,8,["onClick"])]),default:a(()=>[l(ue,{class:"font-weight-medium"},{default:a(()=>[i(d(t.name),1)]),_:2},1024),l(ce,null,{default:a(()=>[i(d(t.quantity)+" x ₹"+d(t.price),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(j),s("div",Ie,[s("div",Me,[e[15]||(e[15]=s("span",null,"Total",-1)),s("span",null,"₹"+d(C.value),1)]),f.value&&y.value?(n(),b("div",Te,[s("div",Se,[e[16]||(e[16]=s("span",{class:"text-caption"},"Wallet Balance",-1)),s("span",he,"₹"+d(y.value.points),1)]),l(g,{block:"",color:"secondary",variant:"flat",size:"small",disabled:y.value.points<C.value,onClick:e[1]||(e[1]=t=>q("Wallet")),loading:m.value&&h.value==="Wallet"},{default:a(()=>e[17]||(e[17]=[i(" Pay with Wallet ")])),_:1},8,["disabled","loading"]),y.value.points<C.value?(n(),b("div",Oe,"Insufficient Points")):P("",!0)])):P("",!0),l(g,{block:"",color:"primary",onClick:e[2]||(e[2]=t=>q("Cash/UPI")),loading:m.value&&h.value==="Cash/UPI"},{default:a(()=>e[18]||(e[18]=[i(" Pay Cash / UPI ")])),_:1},8,["loading"])])]))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(pe,{class:"bg-grey-lighten-5"},{default:a(()=>[l(me,{class:"pa-4"},{default:a(()=>[s("div",Ae,[(n(),b(A,null,E(["All","Meals","Snacks","Beverages"],t=>l(Y,{key:t,color:w.value===t?"primary":"default",variant:w.value===t?"flat":"outlined",filter:"",onClick:x=>w.value=t},{default:a(()=>[i(d(t),1)]),_:2},1032,["color","variant","onClick"])),64))]),e[22]||(e[22]=s("h3",{class:"text-h6 font-weight-bold mt-4 mb-3"},"Menu",-1)),f.value?(n(),p(ge,{key:0,type:"success",variant:"tonal",class:"mb-4",density:"compact"},{default:a(()=>e[19]||(e[19]=[i(" You are viewing discounted Employee prices! ")])),_:1})):P("",!0),k.value?(n(),p(ye,{key:1,indeterminate:"",color:"primary",class:"d-flex mx-auto"})):(n(),p(xe,{key:2},{default:a(()=>[(n(!0),b(A,null,E(K.value,t=>(n(),p(be,{cols:"12",md:"6",key:t.id},{default:a(()=>[l(T,{class:"mb-3 rounded-lg pa-2",elevation:"0",disabled:!t.available},{default:a(()=>[s("div",Ee,[l(F,{size:"80",class:"rounded-lg"},{default:a(()=>[l(R,{src:t.image,cover:"",class:"bg-grey-lighten-2"},null,8,["src"])]),_:2},1024),s("div",$e,[s("div",ze,[s("div",De,d(t.name),1),t.available?P("",!0):(n(),p(Y,{key:0,size:"x-small",color:"error"},{default:a(()=>e[20]||(e[20]=[i("Sold Out")])),_:1}))]),s("div",qe,d(t.category),1),s("div",Le,[s("div",null,[f.value?(n(),b("span",Ue,"₹"+d(t.originalPrice),1)):P("",!0),s("span",We,"₹"+d(t.price),1)]),l(g,{size:"small",variant:"tonal",color:"primary",onClick:x=>ee(t),disabled:!t.available},{default:a(()=>e[21]||(e[21]=[i(" Add ")])),_:2},1032,["onClick","disabled"])])])])]),_:2},1032,["disabled"])]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1}),l(J,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=t=>_.value=t),"max-width":"350"},{default:a(()=>[l(T,{title:"Employee Login"},{default:a(()=>[l(N,null,{default:a(()=>[e[23]||(e[23]=s("div",{class:"text-caption text-grey mb-2"},"Login to access wallet & discounts.",-1)),l(we,{modelValue:M.value,"onUpdate:modelValue":e[4]||(e[4]=t=>M.value=t),label:"Employee ID",variant:"outlined","hide-details":"",class:"mb-2"},null,8,["modelValue"]),e[24]||(e[24]=s("div",{class:"text-center text-caption text-grey"},"For demo, use 'EMP001'",-1))]),_:1}),l(Ve,null,{default:a(()=>[l(W),l(g,{onClick:e[5]||(e[5]=t=>_.value=!1)},{default:a(()=>e[25]||(e[25]=[i("Cancel")])),_:1}),l(g,{color:"primary",onClick:Z},{default:a(()=>e[26]||(e[26]=[i("Login")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(J,{modelValue:I.value,"onUpdate:modelValue":e[8]||(e[8]=t=>I.value=t),"max-width":"320",persistent:""},{default:a(()=>[l(T,{class:"text-center pa-6"},{default:a(()=>{var t,x,L;return[l(S,{size:"64",color:"success"},{default:a(()=>e[27]||(e[27]=[i("mdi-check-circle-outline")])),_:1}),e[30]||(e[30]=s("h3",{class:"text-h6 mt-2 font-weight-bold"},"Order Placed!",-1)),e[31]||(e[31]=s("p",{class:"text-caption text-grey mb-4"},"Show this QR to counter staff",-1)),s("div",je,[l(S,{size:"100",color:"black"},{default:a(()=>e[28]||(e[28]=[i("mdi-qrcode")])),_:1})]),s("div",Ne,[s("div",null,"Order #"+d((t=V.value)==null?void 0:t.id),1),s("div",Fe,"Paid: ₹"+d((x=V.value)==null?void 0:x.total)+" ("+d((L=V.value)==null?void 0:L.paymentMode)+")",1)]),l(g,{block:"",color:"primary",class:"mt-6",onClick:e[7]||(e[7]=Re=>I.value=!1)},{default:a(()=>e[29]||(e[29]=[i("Close")])),_:1})]}),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Qe as default};
