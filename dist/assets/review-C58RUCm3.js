import{_ as _e,r as I,u as Ue,y as Ne,K as ze,o as Ce,l as ye,i as o,a as Pe,f as b,w as E,N as k,H as D,p as F,x as C,aw as Ae,ax as Ie,ay as H,az as J,aA as De,Z as ve,aB as Re,Y as $e,b as Te,e as X,v as Be,aC as Le,ar as Oe,ag as ge}from"./index-B12n8wa1.js";const je={class:"payroll-dashboard"},Ve={class:"header-banner"},We={class:"header-content"},Me={class:"title-section"},qe={class:"main-title"},Ye={class:"subtitle-wrapper"},He={class:"employee-count"},Je={class:"date-badge"},Xe={class:"stepper-container"},Ge={class:"stepper"},Ke={class:"step completed"},Ze={class:"step-icon"},Qe={key:1,class:"main-content"},et={class:"content-wrapper"},tt={class:"content-grid"},ot={class:"content-section"},st={class:"deduction-item"},nt={class:"deduction-amount positive"},at={class:"deduction-item"},lt={class:"deduction-amount deduction"},it={class:"deduction-item"},rt={class:"deduction-amount deduction"},dt={class:"deduction-item"},ct={class:"deduction-amount deduction"},mt={class:"deduction-item"},pt={class:"deduction-amount deduction"},ut={class:"total-row net-salary"},yt={class:"total-amount positive"},vt={class:"content-section"},gt={class:"report-list"},ft={class:"report-icon"},ht={class:"report-icon"},bt={class:"report-icon"},Ft={class:"action-footer"},St={__name:"review",setup(wt){const j=Te(),G=Ue(),$=I({start:G.query.start,end:G.query.end}),V=Ne.getToken(),K=ze.getTenantId(),Z=e=>e?new Date(e).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"",A=I([]),_=I(),T=I([]),W=I(!1),B=I(!1),O=I(""),M=I("success"),Q=()=>{j.push(`/payroll/salary-verification?start=${$.value.start}&end=${$.value.end}`)},fe=async()=>{try{W.value=!0;const e=localStorage.getItem("selectedEmployees");if(e)T.value=JSON.parse(e),console.log("✅ selectedEmployees loaded from 'selectedEmployees':",T.value);else{const t=localStorage.getItem("selectedEmployee");if(t)T.value=[JSON.parse(t)],console.log("✅ selectedEmployees loaded from 'selectedEmployee':",T.value);else{console.warn("❌ No selected employee found in localStorage, redirecting..."),j.push("/payroll");return}}await he()}catch(e){console.error("❌ Error loading employee data:",e),B.value=!0,O.value=`Error loading employee data: ${e.message}`,M.value="error"}finally{W.value=!1}},he=async()=>{var e,t,n,y,r,i,c,u,l;try{if(!V||!K)throw new Error("Authentication required or tenant not found");const U=[...["id","employee.id","attendaceVerification","salaryVerification","ctc","payableDays","netSalary","earnings","deductions","penalties","benefits","startDate","endDate","individualDeduction","salaryArrears","totalEarnings","totalBenefits","tdsAmount","totalPenality","totalOtherDeduction","finalizeDate","employee.assignedUser.UAN","employee.assignedUser.role.name","employee.assignedUser.first_name","employee.branch.state","employee.branch.branchName","employee.assignedUser.ESIAccountNumber","employee.assignedUser.tenant.tenantName","employee.assignedUser.tenant.logo","employee.assignedUser.tenant.companyAddress","employee.department.departmentName","employee.employeeId","employee.assignedUser.designation"].map(m=>`fields[]=${m}`),`filter[_and][0][employee][assignedUser][tenant][tenantId][_eq]=${K}`,"filter[_and][1][employee][status][_neq]=archived",`filter[_and][2][startDate]=${$.value.start}`,`filter[_and][3][endDate]=${$.value.end}`,`filter[_and][4][employee][id][_in]=${T.value.map(m=>m.employee.id).join(",")}`,"limit=-1"].join("&"),N=await fetch(`https://appv1.fieldseasy.com/directus/items/payrollVerification?${U}`,{headers:{Authorization:`Bearer ${V}`,"Content-Type":"application/json"}});if(!N.ok)throw new Error(`HTTP error! status: ${N.status}`);const d=await N.json();if(d!=null&&d.data){for(const m of d.data)if((n=(t=(e=m.employee)==null?void 0:e.assignedUser)==null?void 0:t.tenant)!=null&&n.logo){const v=`https://appv1.fieldseasy.com/directus/assets/${m.employee.assignedUser.tenant.logo}`,x=await(await fetch(v,{headers:{Authorization:`Bearer ${V}`}})).blob();m.tenantLogoBase64=await new Promise(z=>{const p=new FileReader;p.onloadend=()=>z(p.result),p.readAsDataURL(x)})}}A.value=d==null?void 0:d.data,_.value={totalEarnings:(y=d==null?void 0:d.data)==null?void 0:y.reduce((m,s)=>m+Number(s.totalEarnings||0),0),totalDeductions:(r=d==null?void 0:d.data)==null?void 0:r.reduce((m,s)=>m+Number(s.totalOtherDeduction||0),0),totalBenefits:(i=d==null?void 0:d.data)==null?void 0:i.reduce((m,s)=>m+Number(s.totalBenefits||0),0),totalTDS:(c=d==null?void 0:d.data)==null?void 0:c.reduce((m,s)=>m+Number(s.tdsAmount||0),0),totalPenalties:(u=d==null?void 0:d.data)==null?void 0:u.reduce((m,s)=>m+Number(s.totalPenality||0),0),totalNetSalary:(l=d==null?void 0:d.data)==null?void 0:l.reduce((m,s)=>m+Number(s.netSalary||0),0)},console.log("✅ Employee Totals:",_.value)}catch(w){console.error("❌ Error fetching employee totals:",w)}},be=()=>{const e=new Oe;(Array.isArray(A.value)?A.value:[A.value]).forEach((n,y)=>{var oe,se,ne,ae,le,ie,re,de,ce,me,pe,ue;y>0&&e.addPage();let r=15;const i=297,c=30,u=(f=20)=>r+f>i-c?(e.addPage(),r=15,!0):!1,l=(f,S,h,R)=>{e.setLineWidth(.3),e.setDrawColor(0,0,0),e.rect(f,S,h,R)},w=(f,S,h,R)=>{e.setLineWidth(.5),e.setDrawColor(100,100,100),e.rect(f,S,h,R)};if(u(35),w(10,r,190,30),e.setFont("helvetica","bold"),e.setFontSize(16),n.tenantLogoBase64&&e.addImage(n.tenantLogoBase64,"PNG",15,r+2,25,25),e.text(n.employee.assignedUser.tenant.tenantName||"-",105,r+10,{align:"center"}),n.employee.assignedUser.tenant.companyAddress){e.setFont("helvetica","normal"),e.setFontSize(9);const f=`${n.employee.assignedUser.tenant.companyAddress.house}, ${n.employee.assignedUser.tenant.companyAddress.street}, ${n.employee.assignedUser.tenant.companyAddress.vtc}, ${n.employee.assignedUser.tenant.companyAddress.dist}, ${n.employee.assignedUser.tenant.companyAddress.state}, ${n.employee.assignedUser.tenant.companyAddress.zip}, Landmark: ${n.employee.assignedUser.tenant.companyAddress.landmark}`;e.text(f,105,r+18,{align:"center"})}e.setFont("helvetica","bold"),e.setFontSize(12);const U=new Date(n.endDate).toLocaleString("en-US",{month:"short",year:"numeric"});e.text(`PAYSLIP FOR ${U}`,105,r+26,{align:"center"}),r+=40,u(50),w(10,r,190,45),e.setFillColor(240,240,240),e.rect(10,r,190,8,"F"),e.setFont("helvetica","bold"),e.setFontSize(11),e.text("Employee Details",15,r+6),r+=12,e.setFont("helvetica","normal"),e.setFontSize(9),[["Employee Name:",((se=(oe=n.employee)==null?void 0:oe.assignedUser)==null?void 0:se.first_name)||"-","Employee ID:",((ne=n.employee)==null?void 0:ne.employeeId)||"-"],["Role:",((ie=(le=(ae=n.employee)==null?void 0:ae.assignedUser)==null?void 0:le.role)==null?void 0:ie.name)||"-","Designation:",((de=(re=n.employee)==null?void 0:re.assignedUser)==null?void 0:de.designation)||"-"],["PF(UAN) Number:",((me=(ce=n.employee)==null?void 0:ce.assignedUser)==null?void 0:me.UAN)||"-","ESI Number:",((ue=(pe=n.employee)==null?void 0:pe.assignedUser)==null?void 0:ue.ESIAccountNumber)||"-"],["Pay Period:",U,"Payable Days:",n.payableDays||"-"]].forEach((f,S)=>{const h=r+S*8;l(10,h-2,95,8),l(105,h-2,95,8),e.setFont("helvetica","bold"),e.text(String(f[0]??""),12,h+3),e.text(String(f[2]??""),107,h+3),e.setFont("helvetica","normal"),e.text(String(f[1]??""),50,h+3),e.text(String(f[3]??""),145,h+3)}),r+=40,u(80);const m=r,s=10,v=92;let a=r;e.setFillColor(230,230,230),e.rect(s,a,v,8,"F"),l(s,a,v,8),e.setFont("helvetica","bold"),e.setFontSize(11),e.text("Earnings",s+3,a+6),a+=10,e.setFont("helvetica","normal"),e.setFontSize(9);let x=0;n.earnings&&Object.entries(n.earnings).forEach(([f,S])=>{const h=Math.round(Number(S||0));x+=h,l(s,a,v,7),l(s,a,60,7),l(s+60,a,32,7),e.text(f,s+2,a+5),e.text(String(h),s+v-2,a+5,{align:"right"}),a+=7}),n.salaryArrears&&Object.keys(n.salaryArrears).length>0&&(e.setFillColor(245,245,245),e.rect(s,a,v,6,"F"),l(s,a,v,6),e.setFont("helvetica","bold"),e.setFontSize(8),e.text("Salary Arrears",s+3,a+4),a+=6,e.setFont("helvetica","normal"),e.setFontSize(9),Object.entries(n.salaryArrears).forEach(([f,S])=>{typeof S=="object"&&Object.entries(S).forEach(([h,R])=>{const L=Math.round(Number(R||0));x+=L,l(s,a,v,7),l(s,a,60,7),l(s+60,a,32,7),e.text(h,s+2,a+5),e.text(`${L}`,s+v-2,a+5,{align:"right"}),a+=7})}));let z=0;n.benefits&&Object.keys(n.benefits).length>0&&(e.setFillColor(245,245,245),e.rect(s,a,v,6,"F"),l(s,a,v,6),e.setFont("helvetica","bold"),e.setFontSize(8),e.text("Benefits",s+3,a+4),a+=6,e.setFont("helvetica","normal"),e.setFontSize(9),Object.entries(n.benefits).forEach(([f,S])=>{const h=Math.round(Number(S||0));z+=h,l(s,a,v,7),l(s,a,60,7),l(s+60,a,32,7),e.text(f,s+2,a+5),e.text(String(h),s+v-2,a+5,{align:"right"}),a+=7})),e.setFillColor(220,220,220),e.rect(s,a,v,8,"F"),l(s,a,v,8),l(s,a,60,8),l(s+60,a,32,8),e.setFont("helvetica","bold"),e.setFontSize(10),e.text("Total Earnings",s+2,a+6),e.text(String(Math.round(x+z)),s+v-2,a+6,{align:"right"});const p=108,P=92;let g=m;e.setFillColor(230,230,230),e.rect(p,g,P,8,"F"),l(p,g,P,8),e.setFont("helvetica","bold"),e.setFontSize(11),e.text("Deductions",p+3,g+6),g+=10,e.setFont("helvetica","normal"),e.setFontSize(9);let te=0;const Y=(f,S)=>{f&&Object.keys(f).length>0&&(e.setFillColor(245,245,245),e.rect(p,g,P,6,"F"),l(p,g,P,6),e.setFont("helvetica","bold"),e.setFontSize(8),e.text(S,p+3,g+4),g+=6,e.setFont("helvetica","normal"),e.setFontSize(9),Object.entries(f).forEach(([h,R])=>{const L=Math.round(Number(R||0));te+=L,l(p,g,P,7),l(p,g,60,7),l(p+60,g,32,7),e.text(h,p+2,g+5),e.text(String(L),p+P-2,g+5,{align:"right"}),g+=7}))};Y(n.deductions,"Deductions"),Y(n.penalties,"Penalties"),Y(n.otherDeduction,"Other Deductions"),e.setFillColor(220,220,220),e.rect(p,g,P,8,"F"),l(p,g,P,8),l(p,g,60,8),l(p+60,g,32,8),e.setFont("helvetica","bold"),e.setFontSize(10),e.text("Total Deductions",p+2,g+6),e.text(String(Math.round(te)),p+P-2,g+6,{align:"right"}),r=Math.max(a,g)+15,u(20);const xe=Math.round(Number(n.netSalary)||0);w(10,r,190,15),e.setFillColor(240,248,255),e.rect(10,r,190,15,"F"),e.setFont("helvetica","bold"),e.setFontSize(12),e.text("Net Salary (in words):",12,r+6),e.setFont("helvetica","normal"),e.setFontSize(11),e.text(String(xe),198,r+6,{align:"right"}),e.setFont("helvetica","italic"),e.setFontSize(8),e.setTextColor(100,100,100),e.text("This is a computer-generated document and does not require a signature.",105,285,{align:"center"})}),e.save("payslip.pdf`")},Fe=async(e,t)=>{if(!e||e.length===0)return null;const n=new ge.Workbook,y=n.addWorksheet("PF_Data"),r=["EmployeeId","Name","Role","Designation","Department","PF Account No","EmployerPF","EmployeePF","FinalizeDate"];return y.addRow(r),e.forEach(i=>{var c,u,l,w,U,N,d,m,s,v,a,x,z,p;y.addRow([((c=i.employee)==null?void 0:c.employeeId)||"",((l=(u=i.employee)==null?void 0:u.assignedUser)==null?void 0:l.first_name)||"",((N=(U=(w=i.employee)==null?void 0:w.assignedUser)==null?void 0:U.role)==null?void 0:N.name)||"",((m=(d=i.employee)==null?void 0:d.assignedUser)==null?void 0:m.designation)||"",((v=(s=i.employee)==null?void 0:s.department)==null?void 0:v.departmentName)||"",((x=(a=i.employee)==null?void 0:a.assignedUser)==null?void 0:x.PFAccountNumber)||"",((z=i.deductions)==null?void 0:z.EmployerPF)||0,((p=i.deductions)==null?void 0:p.EmployeePF)||0,i.finalizeDate||""])}),y.columns.forEach((i,c)=>{i.width=[15,25,20,20,25,25,20,20,15,15,20][c]}),y.eachRow((i,c)=>{i.eachCell(u=>{u.alignment={wrapText:!0,vertical:"middle",horizontal:c===1?"center":"left"},u.font={bold:c===1||c===y.rowCount,size:c===1?12:11},u.border={top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}})}),y.getRow(1).height=40,n},Se=async(e,t)=>{if(!e||e.length===0)return null;const n=new ge.Workbook,y=n.addWorksheet("ESI_Data"),r=["EmployeeId","Name","Role","Designation","Department","ESI Number","EmployerESI","EmployeeESI","FinalizeDate"];return y.addRow(r),e.forEach(i=>{var c,u,l,w,U,N,d,m,s,v,a,x,z,p;y.addRow([((c=i.employee)==null?void 0:c.employeeId)||"",((l=(u=i.employee)==null?void 0:u.assignedUser)==null?void 0:l.first_name)||"",((N=(U=(w=i.employee)==null?void 0:w.assignedUser)==null?void 0:U.role)==null?void 0:N.name)||"",((m=(d=i.employee)==null?void 0:d.assignedUser)==null?void 0:m.designation)||"",((v=(s=i.employee)==null?void 0:s.department)==null?void 0:v.departmentName)||"",((x=(a=i.employee)==null?void 0:a.assignedUser)==null?void 0:x.ESINumber)||"",((z=i.deductions)==null?void 0:z.EmployerESI)||0,((p=i.deductions)==null?void 0:p.EmployeeESI)||0,i.finalizeDate||""])}),y.columns.forEach((i,c)=>{i.width=[15,25,20,20,25,25,20,20,20][c]}),y.eachRow((i,c)=>{i.eachCell(u=>{u.alignment={wrapText:!0,vertical:"middle",horizontal:c===1?"center":"left"},u.font={bold:c===1||c===y.rowCount,size:c===1?12:11},u.border={top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}})}),y.getRow(1).height=40,n},ee=async(e,t="PF_Data")=>{if(!e)return;const n=await e.xlsx.writeBuffer(),y=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=URL.createObjectURL(y),i=document.createElement("a");i.href=r,i.download=`${t}.xlsx`,i.click(),URL.revokeObjectURL(r)},we=async()=>{if(!A.value.length){console.warn("No data available to download.");return}const e=await Fe(A.value,_.value);await ee(e,"PF_Report")},Ee=async()=>{if(!A.value.length){console.warn("No data available to download.");return}const e=await Se(A.value,_.value);await ee(e,"ESI_Report")},ke=()=>{B.value=!0,O.value="Proceeding to next step...",j.push("/payroll/management")},q=e=>{B.value=!0,O.value=`Downloading ${e} report...`,M.value="info"};return Ce(async()=>{await fe()}),(e,t)=>{var n,y,r,i,c,u;return X(),ye("div",je,[o("div",Ve,[o("div",We,[o("button",{class:"back-button",onClick:Q},[b(k(D),null,{default:E(()=>t[5]||(t[5]=[F("mdi-arrow-left")])),_:1})]),o("div",Me,[o("h1",qe,[b(k(D),{size:"32",class:"title-icon"},{default:E(()=>t[6]||(t[6]=[F("mdi-account-cash")])),_:1}),t[7]||(t[7]=F(" Payroll Summary "))]),o("div",Ye,[o("span",He,[b(k(D),{size:"18"},{default:E(()=>t[8]||(t[8]=[F("mdi-account-group")])),_:1}),F(" "+C(T.value.length)+" Employees ",1)]),o("span",Je,[b(k(D),{size:"18"},{default:E(()=>t[9]||(t[9]=[F("mdi-calendar")])),_:1}),F(" "+C(Z($.value.start))+" - "+C(Z($.value.end)),1)])])])])]),o("div",Xe,[o("div",Ge,[o("div",Ke,[o("div",Ze,[b(k(D),null,{default:E(()=>t[10]||(t[10]=[F("mdi-check-circle")])),_:1})]),t[11]||(t[11]=o("div",{class:"step-label"},"Attendance Verification",-1))]),t[12]||(t[12]=Ae('<div class="step-connector completed" data-v-cd9f1c53></div><div class="step completed" data-v-cd9f1c53><div class="step-icon" data-v-cd9f1c53><span data-v-cd9f1c53>2</span></div><div class="step-label" data-v-cd9f1c53>Salary Calculation</div></div><div class="step-connector" data-v-cd9f1c53></div><div class="step active" data-v-cd9f1c53><div class="step-icon" data-v-cd9f1c53><span data-v-cd9f1c53>3</span></div><div class="step-label" data-v-cd9f1c53>Review</div></div>',4))])]),W.value?(X(),Pe(Ie,{key:0,title:"Fetching Data...",message:"Please wait while we load your records.",showProgress:!0,progress:60})):(X(),ye("div",Qe,[o("div",et,[o("div",tt,[o("div",ot,[t[19]||(t[19]=o("h3",{class:"section-title"},"Payroll Review",-1)),o("div",st,[t[13]||(t[13]=o("div",{class:"deduction-info"},[o("h4",{class:"deduction-name"},"Total Earnings")],-1)),o("div",nt," ₹"+C((n=_.value)==null?void 0:n.totalEarnings),1)]),o("div",at,[t[14]||(t[14]=o("div",{class:"deduction-info"},[o("h4",{class:"deduction-name"},"Total Deductions")],-1)),o("div",lt," ₹"+C((y=_.value)==null?void 0:y.totalDeductions),1)]),o("div",it,[t[15]||(t[15]=o("div",{class:"deduction-info"},[o("h4",{class:"deduction-name"},"Total Benifits")],-1)),o("div",rt," ₹ "+C((r=_.value)==null?void 0:r.totalBenefits),1)]),o("div",dt,[t[16]||(t[16]=o("div",{class:"deduction-info"},[o("h4",{class:"deduction-name"},"Total penalities")],-1)),o("div",ct," ₹ "+C((i=_.value)==null?void 0:i.totalPenalties),1)]),o("div",mt,[t[17]||(t[17]=o("div",{class:"deduction-info"},[o("h4",{class:"deduction-name"},"Total TDS")],-1)),o("div",pt," ₹ "+C((c=_.value)==null?void 0:c.totalTDS),1)]),o("div",ut,[t[18]||(t[18]=o("div",{class:"total-label"},"Total Net Salary Paid",-1)),o("div",yt," ₹ "+C((u=_.value)==null?void 0:u.totalNetSalary),1)])]),o("div",vt,[t[26]||(t[26]=o("h3",{class:"section-title"},"Reports",-1)),o("div",gt,[o("div",{class:"report-item",onClick:t[0]||(t[0]=l=>q("payslips"))},[o("div",ft,[b(k(D),{color:"primary"},{default:E(()=>t[20]||(t[20]=[F("mdi-file-document-multiple")])),_:1})]),t[21]||(t[21]=o("div",{class:"report-info"},[o("div",{class:"report-name"},"Payslips")],-1)),b(J,{text:"Download",icon:k(H),variant:"edit",size:"sm",onClick:be,class:"action-btn edit-btn"},null,8,["icon"])]),o("div",{class:"report-item",onClick:t[1]||(t[1]=l=>q("pf"))},[o("div",ht,[b(k(D),{color:"teal"},{default:E(()=>t[22]||(t[22]=[F("mdi-clipboard-text")])),_:1})]),t[23]||(t[23]=o("div",{class:"report-info"},[o("div",{class:"report-name"},"PF Report")],-1)),b(J,{text:"Download",icon:k(H),variant:"edit",size:"sm",onClick:we,class:"action-btn edit-btn"},null,8,["icon"])]),o("div",{class:"report-item",onClick:t[2]||(t[2]=l=>q("esi"))},[o("div",bt,[b(k(D),{color:"deep-orange"},{default:E(()=>t[24]||(t[24]=[F("mdi-file-document")])),_:1})]),t[25]||(t[25]=o("div",{class:"report-info"},[o("div",{class:"report-name"},"ESI Report")],-1)),b(J,{text:"Download",icon:k(H),variant:"edit",size:"sm",onClick:Ee,class:"action-btn edit-btn"},null,8,["icon"])])])])])])])),o("div",Ft,[b(ve,{varient:"grey",size:"md","left-icon":k(De),onClick:Q,class:"ms-2"},{default:E(()=>t[27]||(t[27]=[F(" back ")])),_:1},8,["left-icon"]),b(ve,{variant:"primary",size:"md","left-icon":k(Re),onClick:ke,class:"ms-2"},{default:E(()=>t[28]||(t[28]=[F(" Close ")])),_:1},8,["left-icon"])]),b($e,{modelValue:B.value,"onUpdate:modelValue":t[4]||(t[4]=l=>B.value=l),color:M.value,timeout:3e3},{action:E(({attrs:l})=>[b(Be,Le({text:""},l,{onClick:t[3]||(t[3]=w=>B.value=!1)}),{default:E(()=>t[29]||(t[29]=[F("Close")])),_:2},1040)]),default:E(()=>[F(C(O.value)+" ",1)]),_:1},8,["modelValue","color"])])}}},kt=_e(St,[["__scopeId","data-v-cd9f1c53"]]);export{kt as default};
