import{_ as Y,af as ee,r as l,K as F,y as ae,L as te,c as R,E as se,o as oe,u as le,l as ne,i as r,f as B,a as v,k as D,w as n,P as re,q as ie,d as ce,b as ue,e as g,S as de,Q as me,R as pe,T as ge,x as i,W as fe,N as L,Z as ye,aD as ve}from"./index-B12n8wa1.js";const he={class:"logs-container"},_e={class:"d-flex align-center",style:{gap:"8px"}},we={__name:"salaryPolicyDetails",setup(be){const z=ee(()=>{p.value=1,c()},300),q=le(),A=ue(),P=l([]),w=l(!1),d=l(""),W=l(!0),b=l(!1),$=l(""),I=l("all");l([]);const k=l(!1),p=l(1),h=l(25),x=l(0),E=F.getTenantId(),C=ae.getToken(),f=F.getRole(),T=F.getUserId(),m=l({key:"date_created",order:"desc"}),M=l(!1),o=te({status:"",mode:"",dateFrom:""});R(()=>({status:o.status,mode:o.mode,dateFrom:o.dateFrom}));const U=l([{key:"configName",label:"Policy Name",sortable:!0,width:"200px"},{key:"stateTaxes",label:"State Taxes",sortable:!1,width:"160px"},{key:"basicPay",label:"Basic Pay",sortable:!0,width:"150px"},{key:"adminCharges",label:"Admin Charges",sortable:!1,width:"160px"}]),O=async(s=I.value)=>{var a,t,e;try{if(!C||!E)throw new Error("Authentication required or tenant not found");const u={"aggregate[count]":"id",...j(s)},y=Object.keys(u).map(N=>`${N}=${encodeURIComponent(u[N])}`).join("&"),_=await fetch(`https://appv1.fieldseasy.com/directus/items/salarySetting?${y}`,{headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"}});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const S=await _.json();x.value=((e=(t=(a=S==null?void 0:S.data)==null?void 0:a[0])==null?void 0:t.count)==null?void 0:e.id)||0}catch(u){console.error("Error fetching aggregate count:",u),x.value=0}},c=async()=>{if(!C){b.value=!0,$.value="Authentication required. Please login again.";return}w.value=!0;try{await O();let s={fields:["skillLevel","zone","basicPay","earnings","status","tenant","deductions","employerContribution","advancedMode","allowances","professionalTax","LWF","id","configName","adminCharges","stateTaxes.state"],sort:m.value.key&&m.value.order==="desc"?`-${m.value.key}`:m.value.key,limit:h.value,page:p.value,...j()};const t=`https://appv1.fieldseasy.com/directus/items/salarySetting?${Object.keys(s).map(y=>y==="fields"?s[y].map(_=>`fields[]=${_}`).join("&"):`${y}=${encodeURIComponent(s[y])}`).join("&")}`,e=await fetch(t,{headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const u=await e.json();P.value=u.data||[]}catch(s){b.value=!0,$.value=s.message||"Failed to fetch salary settings. Please try again."}finally{w.value=!1}},Q=l(""),V=s=>{s&&s.id?(Q.value=s.id,k.value=!0,A.push({path:`/configuration/payroll-policy/salary-templateEdit/${s.id}`})):console.error("Invalid item or item ID")},j=(s=I.value)=>{const a={};let t=0;if((f==="Admin"||f==="Dealer"||f==="Administrator")&&(a[`filter[_and][${t}][tenant][tenantId][_eq]`]=E,a[`filter[_and][${t}][configName][_neq]`]="Custom",t++),f==="Manager"&&(a[`filter[_and][${t}][employeeId][approver][id][_eq]`]=T,a[`filter[_and][${t}][employeeId][assignedUser][id][_eq]`]=T,t++),f==="Employee"&&(a[`filter[_and][${t}][employeeId][assignedUser][id][_eq]`]=T,t++),d.value){let e=0;a[`filter[_and][${t}][_or][${e}][employeeId][employeeId][_icontains]`]=d.value,e++,a[`filter[_and][${t}][_or][${e}][employeeId][assignedUser][first_name][_icontains]`]=d.value,e++,a[`filter[_and][${t}][_or][${e}][employeeId][assignedUser][last_name][_icontains]`]=d.value,e++,t++}return o.dateFrom&&(a[`filter[_and][${t}][date][_gte]`]=o.dateFrom,t++),o.status&&(a[`filter[_and][${t}][action][_in]`]=o.status,t++),o.mode&&(a[`filter[_and][${t}][mode][_in]`]=o.mode,t++),a},H=s=>{p.value=s,c()},K=s=>{h.value=s,p.value=1,c()},X=({field:s,direction:a})=>{m.value={key:s,order:a},c()};R(()=>o.status||o.mode||o.dateFrom||d.value);const Z=()=>{Object.keys(o).forEach(s=>{o[s]=Array.isArray(o[s])?[]:""}),p.value=1,c()},G=()=>{k.value=!0,A.push({name:"salary-template"})};se([d,o,m,I],()=>{z()},{deep:!0});const J=()=>{k.value=!1,c()};return oe(()=>{console.log("router",q),q.query,c()}),(s,a)=>{const t=ce("router-view");return g(),ne("div",he,[r("div",{class:ie(["main-content",{"full-width":!W.value}])},[!k.value&&!M.value?(g(),v(re,{key:0,searchQuery:d.value,"onUpdate:searchQuery":a[2]||(a[2]=e=>d.value=e),"search-placeholder":"Search Logs...","show-search":!0,"has-error":b.value,"wrapper-class":"logs-table-wrapper"},{"toolbar-actions":n(()=>[r("div",_e,[L(f)==="Admin"?(g(),v(ye,{key:0,variant:"primary",size:"md",text:"Create Policies",leftIcon:L(ve),onClick:G},null,8,["leftIcon"])):D("",!0)])]),pagination:n(()=>[B(fe,{page:p.value,"onUpdate:page":[a[0]||(a[0]=e=>p.value=e),H],itemsPerPage:h.value,"onUpdate:itemsPerPage":[a[1]||(a[1]=e=>h.value=e),K],"total-items":x.value},null,8,["page","itemsPerPage","total-items"])]),default:n(()=>[w.value?(g(),v(de,{key:0,variant:"table-body-only",rows:h.value||10,columns:U.value.length},null,8,["rows","columns"])):b.value?(g(),v(me,{key:1,title:"Unable to load logs",message:$.value,onRetry:c},null,8,["message"])):P.value.length===0&&!w.value?(g(),v(pe,{key:2,title:"No logs data found",message:"Try adjusting your filters or check back later","primary-action":{text:"Clear Filters",icon:"X"},onPrimaryAction:Z})):(g(),v(ge,{key:3,items:P.value,columns:U.value,"sort-by":m.value.key,"sort-direction":m.value.order,"row-clickable":!0,onRowClick:V,onSort:X},{"cell-configName":n(({item:e})=>[r("span",null,i(e.configName||"-"),1)]),"cell-skillLevel":n(({item:e})=>[r("span",null,i(e.skillLevel||"-"),1)]),"cell-zone":n(({item:e})=>[r("span",null,i(e.zone||"-"),1)]),"cell-basicPay":n(({item:e})=>[r("span",null,i(e.basicPay||"-"),1)]),"cell-earnings":n(({item:e})=>[r("span",null,i(e.earnings||"-"),1)]),"cell-deductions":n(({item:e})=>[r("span",null,i(e.deductions||"-"),1)]),"cell-employerContribution":n(({item:e})=>[r("span",null,i(e.employerContribution||"-"),1)]),"cell-allowances":n(({item:e})=>[r("span",null,i(e.allowances||"-"),1)]),"cell-professionalTax":n(({item:e})=>[r("span",null,i(e.professionalTax||"-"),1)]),"cell-LWF":n(({item:e})=>[r("span",null,i(e.LWF||"-"),1)]),"cell-adminCharges":n(({item:e})=>[r("span",null,i(e.adminCharges.charge||"-")+"%",1)]),"cell-stateTaxes":n(({item:e})=>{var u;return[r("span",null,i(((u=e.stateTaxes)==null?void 0:u.state)||"-"),1)]}),_:1},8,["items","columns","sort-by","sort-direction"]))]),_:1},8,["searchQuery","has-error"])):D("",!0)],2),B(t,{onClose:J})])}}},Ce=Y(we,[["__scopeId","data-v-5a7f2418"]]);export{Ce as default};
