import{_ as pe,r as u,c as Z,E as ke,l as S,e as C,f as g,w as r,p as R,H as W,v as ue,j as me,$ as ye,a1 as Ue,i as n,x as p,a6 as Ce,X as be,y as Q,K as j,ag as Ne,ah as $e,ai as q,a as _e,F as Ee,B as De,q as fe,aj as Se,U as Ie,ak as xe,al as Pe,L as Me,af as Re,o as Fe,A as Te,k as de,O as Le,N as Be,P as je,b as Oe,d as ze,S as Ve,R as qe,T as He,am as ce,W as Je}from"./index-B12n8wa1.js";const Ge={class:"excel-export-container"},We={class:"mb-2"},ge=100,Qe="0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef",Ke={__name:"employeeExcelExport",props:{headers:{type:Array,required:!0},filters:{type:Object,default:()=>({})},search:{type:String,default:""}},setup(ne){const i=ne,F=u(!1),P=u(!1),L=u(0),b=u("Initializing..."),w=u(0),_=u(0),d=u("Company");function y(t){if(!t||typeof t!="string")return!1;const c=t.split(":");if(c.length!==2)return!1;const m=/^[0-9a-fA-F]+$/;return m.test(c[0])&&m.test(c[1])}function H(t){try{if(!t||typeof t!="string")return t||"";if(!y(t))return t;const c=t.split(":"),m=c[0],A=c[1],U=q.enc.Hex.parse(m),N=q.enc.Hex.parse(Qe),h=q.enc.Hex.parse(A),x=q.lib.CipherParams.create({ciphertext:h});return q.AES.decrypt(x,N,{iv:U,mode:q.mode.CBC,padding:q.pad.Pkcs7}).toString(q.enc.Utf8)}catch(c){return console.error("Decryption failed:",c),t}}const I=["assignedUser.aadhar","assignedUser.pan","assignedUser.voter_ID","assignedUser.driving_License","assignedUser.UAN","assignedUser.IFSC"],J=Z(()=>w.value===0?0:Math.round(_.value/w.value*100));ke(J,t=>{L.value=t});const T=async()=>{try{F.value=!0,P.value=!0,b.value="Counting total records...",await ee(),await ae(),await o()}catch(t){console.error("Error generating Excel:",t),b.value="Error generating Excel. Please try again."}finally{setTimeout(()=>{F.value=!1,P.value=!1,L.value=0,_.value=0},1e3)}},ee=async()=>{try{const t=Q.getToken(),c=j.getTenantId();b.value="Fetching tenant information...";const m=await fetch(`https://appv1.fieldseasy.com/directus/items/tenant?filter[tenantId][_eq]=${c}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);const A=await m.json();A.data&&A.data.length>0&&(d.value=A.data[0].tenantName||A.data[0].companyName||"Company")}catch(t){console.error("Error fetching tenant name:",t)}},ae=async()=>{var c,m,A;const t=Q.getToken();try{const U={"aggregate[count]":"id",...se()},N=Object.keys(U).map(M=>`${M}=${U[M]}`).join("&"),h=await fetch(`https://appv1.fieldseasy.com/directus/items/personalModule?${N}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const x=await h.json();w.value=((A=(m=(c=x==null?void 0:x.data)==null?void 0:c[0])==null?void 0:m.count)==null?void 0:A.id)||0,b.value=`Found ${w.value} records. Starting download...`}catch(U){throw console.error("Error getting total record count:",U),U}},o=async()=>{const t=Q.getToken();try{const c=Math.ceil(w.value/ge);let m=1,A=[];const U=new Ne.Workbook;U.creator="Employee Management System",U.lastModifiedBy="System",U.created=new Date,U.modified=new Date;const N=U.addWorksheet("Employee Other Details",{pageSetup:{paperSize:9,orientation:"landscape",fitToPage:!0}}),h=i.headers.filter(k=>k.key!=="avatarImage"&&k.key!=="actions").map(k=>k.title),x=new Date().toLocaleDateString();N.mergeCells("A1:E1");const M=N.getCell("A1");M.value=`${d.value} - Employee Report - Generated: ${x}`,M.font={name:"Arial",size:14,bold:!0},M.alignment={horizontal:"left",vertical:"middle"};const re=N.addRow(h);for(re.font={name:"Arial",size:12,bold:!0},re.eachCell(k=>{k.fill={type:"pattern",pattern:"solid",fgColor:{argb:"EBEAEA"}},k.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},k.alignment={horizontal:"center",vertical:"middle",wrapText:!0}});_.value<w.value;){b.value=`Fetching batch ${m} of ${c}...`;const k={fields:te(),...se(),sort:"date_created",page:m,limit:ge},K=Object.keys(k).map(E=>E==="fields"?k[E].map(X=>`fields[]=${X}`).join("&"):`${E}=${k[E]}`).join("&"),O=await fetch(`https://appv1.fieldseasy.com/directus/items/personalModule?${K}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!O.ok)throw new Error(`HTTP error! status: ${O.status}`);const G=(await O.json()).data||[];b.value=`Processing batch ${m} of ${c}...`;for(const E of G){const X=i.headers.filter(s=>s.key!=="avatarImage"&&s.key!=="actions").map(s=>{var f,D,e,a,B;if(s.value&&typeof s.value=="function")return s.value(E)||"";if(s.key==="rfidStatus")return`${((f=E.assignedCards)==null?void 0:f.filter($=>$.cardManagement_id.type==="rfid").length)||0} RFID Cards`;if(s.key==="tagStatus"){const z=(D=E.assignedCards)==null?void 0:D.find($=>$.cardManagement_id.type==="tag");return z?`${z.cardManagement_id.rfidCard} (${z.cardManagement_id.cardAccess?"Enabled":"Disabled"})`:""}if(s.key==="controllerStatus")return E.controllerStatus||"N/A";if(s.key==="branchName")return((B=(a=(e=E.assignedBranch)==null?void 0:e[0])==null?void 0:a.branch_id)==null?void 0:B.branchName)||"";if(s.key.includes(".")){const z=s.key.split(".");let $=E;for(const ve of z)if($=$==null?void 0:$[ve],$===void 0)break;return I.includes(s.key)&&$&&($=H($)),$||""}let v=E[s.key]||"";return I.includes(s.key)&&v&&(v=H(v)),v});N.addRow(X).eachCell(s=>{s.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},s.alignment={vertical:"middle",wrapText:!0}})}if(_.value+=G.length,b.value=`Processed ${_.value} of ${w.value} records...`,m++,G.length<ge)break}h.forEach((k,K)=>{const O=N.getColumn(K+1);O.width=Math.max(k.length*1.5,15),O.alignment={horizontal:"left",vertical:"middle"}}),N.autoFilter={from:{row:2,column:1},to:{row:2,column:h.length}},b.value="Saving Excel file...";const ie=await U.xlsx.writeBuffer(),oe=`${d.value}_Employee_Other_Details_${x.replace(/\//g,"-")}.xlsx`;$e.saveAs(new Blob([ie]),oe),b.value="Download complete!"}catch(c){throw console.error("Error fetching and processing data:",c),c}},se=()=>{var U,N,h,x,M;const t={},c=j.getTenantId(),m=j.getRole(),A=j.getUserId();return t["filter[assignedUser][tenant][tenantId][_eq]"]=c,m==="Manager"&&(t["filter[assignedUser][role][name][_eq]"]="Employee"),m==="Employee"&&(t["filter[assignedUser][id][_eq]"]=A),i.search&&(t["filter[_or][0][employeeId][_contains]"]=i.search,t["filter[_or][1][assignedUser][first_name][_contains]"]=i.search,t["filter[_or][2][assignedUser][email][_contains]"]=i.search,t["filter[_or][3][assignedUser][role][name][_contains]"]=i.search,t["filter[_or][4][assignedDepartment][department_id][departmentName][_contains]"]=i.search,t["filter[_or][5][assignedBranch][branch_id][branchName][_contains]"]=i.search,t["filter[_or][6][assignedUser][phone][_contains]"]=i.search,t["filter[_or][7][assignedUser][officeEmail][_contains]"]=i.search,t["filter[_or][8][assignedUser][gender][_contains]"]=i.search,t["filter[_or][9][config][configName][_contains]"]=i.search,t["filter[_or][10][salaryConfig][configName][_contains]"]=i.search,t["filter[_or][11][assignedUser][aadhar][_contains]"]=i.search,t["filter[_or][12][assignedUser][ESIAccountNumber][_contains]"]=i.search,t["filter[_or][13][assignedUser][PFAccountNumber][_contains]"]=i.search,t["filter[_or][14][assignedUser][pan][_contains]"]=i.search,t["filter[_or][15][assignedAccessLevels][accesslevels_id][accessLevelName][_contains]"]=i.search,t["filter[_or][16][controllerStatus][_contains]"]=i.search),i.filters&&((U=i.filters.branch)!=null&&U.length&&(t["filter[assignedBranch][branch_id][branchName][_in]"]=i.filters.branch.join(",")),(N=i.filters.department)!=null&&N.length&&(t["filter[assignedDepartment][department_id][departmentName][_in]"]=i.filters.department.join(",")),(h=i.filters.role)!=null&&h.length&&(t["filter[assignedUser][role][name][_in]"]=i.filters.role.join(",")),(x=i.filters.accessLevel)!=null&&x.length&&(t["filter[assignedAccessLevels][accesslevels_id][accessLevelName][_in]"]=i.filters.accessLevel.join(",")),(M=i.filters.gender)!=null&&M.length&&(t["filter[assignedUser][gender][_in]"]=i.filters.gender.join(",")),i.filters.dateFrom&&(t["filter[assignedUser][dateOfJoining][_gte]"]=i.filters.dateFrom),i.filters.dateTo&&(t["filter[assignedUser][dateOfJoining][_lte]"]=i.filters.dateTo)),t},te=()=>["id","employeeId","controllerStatus","accessOn","status","assignedUser.first_name","assignedUser.role.name","assignedDepartment.department_id.departmentName","assignedBranch.branch_id.branchName","assignedUser.phone","assignedUser.email","assignedUser.officeEmail","assignedUser.gender","assignedUser.DOB","assignedUser.bloodGroup","assignedUser.maritalStatus","assignedUser.tenant.tenantName","assignedCards.cardManagement_id.type","assignedCards.cardManagement_id.rfidCard","assignedCards.cardManagement_id.cardAccess","assignedUser.dateOfLeaving","assignedUser.dateOfJoining","assignedUser.ESIAccountNumber","assignedUser.PFAccountNumber","assignedUser.aadhar","assignedUser.pan","assignedUser.gst","assignedUser.permanent_Address","assignedUser.current_Address","assignedUser.emergency_Contact_Name","assignedUser.emergency_Contact_Mobile_Number","assignedUser.emergency_Contact_Relationship","assignedUser.guardians_Name","assignedUser.voter_ID","assignedUser.driving_License","assignedUser.UAN","assignedUser.IFSC","config.configName","salaryConfig.configName","assignedAccessLevels.accesslevels_id.accessLevelName"];return(t,c)=>(C(),S("div",Ge,[g(ue,{color:"primary",loading:F.value,onClick:T,class:"download-btn",variant:"text",size:"large",title:"Download Excel"},{default:r(()=>[g(W,{class:"mr-1"},{default:r(()=>c[1]||(c[1]=[R("mdi-microsoft-excel")])),_:1}),c[2]||(c[2]=R(" Excel "))]),_:1},8,["loading"]),g(be,{modelValue:P.value,"onUpdate:modelValue":c[0]||(c[0]=m=>P.value=m),persistent:"","max-width":"400"},{default:r(()=>[g(me,null,{default:r(()=>[g(ye,{class:"text-h6"},{default:r(()=>c[3]||(c[3]=[R("Generating Excel")])),_:1}),g(Ue,null,{default:r(()=>[n("p",We,p(b.value),1),g(Ce,{value:L.value,height:"25",color:"primary",striped:""},{default:r(()=>[n("strong",null,p(L.value)+"%",1)]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Xe=pe(Ke,[["__scopeId","data-v-b4498ccf"]]),Ye={class:"d-flex align-center"},Ze={key:0,class:"text-center pa-6"},ea={key:1,class:"card-grid"},aa={class:"d-flex align-center pa-3"},sa={class:"flex-grow-1"},ta={class:"d-flex justify-space-between align-center"},ra={class:"text-subtitle-1 font-weight-bold"},na={class:"text-caption text-grey mt-1"},ia={__name:"rfidCardPopup",setup(ne,{expose:i}){const F=u(!1),P=u([]),L=_=>{P.value=_,F.value=!0},b=_=>({Access:"indigo",Employee:"teal",Visitor:"amber-darken-2",Admin:"deep-purple",Security:"red-darken-1"})[_]||"blue",w=_=>({Access:"mdi-door",Employee:"mdi-account-badge",Visitor:"mdi-account-question",Admin:"mdi-shield-account",Security:"mdi-security"})[_]||"mdi-credit-card";return i({open:L}),(_,d)=>(C(),_e(be,{modelValue:F.value,"onUpdate:modelValue":d[2]||(d[2]=y=>F.value=y),"max-width":"600px"},{default:r(()=>[g(me,{class:"rounded-lg"},{default:r(()=>[g(ye,{class:"d-flex justify-space-between align-center gradient-header text-white pa-4"},{default:r(()=>[n("div",Ye,[g(W,{color:"white",class:"mr-2"},{default:r(()=>d[3]||(d[3]=[R("mdi-credit-card-multiple")])),_:1}),d[4]||(d[4]=n("span",{class:"text-h5 font-weight-bold"},"RFID Cards",-1))]),g(ue,{icon:"",variant:"text",color:"white",onClick:d[0]||(d[0]=y=>F.value=!1)},{default:r(()=>[g(W,null,{default:r(()=>d[5]||(d[5]=[R("mdi-close")])),_:1})]),_:1})]),_:1}),g(Ue,{class:"pa-4"},{default:r(()=>[P.value.length===0?(C(),S("div",Ze,[g(W,{size:"64",color:"grey-lighten-1"},{default:r(()=>d[6]||(d[6]=[R("mdi-credit-card-off")])),_:1}),d[7]||(d[7]=n("div",{class:"text-h6 mt-2 text-grey"},"No RFID cards found",-1))])):(C(),S("div",ea,[(C(!0),S(Ee,null,De(P.value,(y,H)=>(C(),_e(me,{key:H,class:fe(["card-item mb-3",y.cardManagement_id.cardAccess?"border-active":"border-inactive"]),variant:"outlined",elevation:"2"},{default:r(()=>[n("div",aa,[g(Se,{color:b(y.cardManagement_id.type),size:"42",class:"mr-3"},{default:r(()=>[g(W,{color:"white"},{default:r(()=>[R(p(w(y.cardManagement_id.type)),1)]),_:2},1024)]),_:2},1032,["color"]),n("div",sa,[n("div",ta,[n("span",ra,p(y.cardManagement_id.rfidCard),1),g(Ie,{color:y.cardManagement_id.cardAccess?"success":"error",size:"small",class:"ml-2",label:""},{default:r(()=>[R(p(y.cardManagement_id.cardAccess?"Enabled":"Disabled"),1)]),_:2},1032,["color"])]),n("div",na,[g(W,{size:"small",class:"mr-1"},{default:r(()=>d[8]||(d[8]=[R("mdi-tag")])),_:1}),R(" "+p(y.cardManagement_id.type||"Standard"),1)])])])]),_:2},1032,["class"]))),128))]))]),_:1}),g(xe),g(Pe,{class:"pa-4 d-flex justify-end"},{default:r(()=>[g(ue,{color:"primary",variant:"text",onClick:d[1]||(d[1]=y=>F.value=!1)},{default:r(()=>d[9]||(d[9]=[R(" Close ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},oa=pe(ia,[["__scopeId","data-v-15cf7bdf"]]),la={class:"employee-container"},da={key:0,class:"filter-panel"},ca={class:"filter-content"},ga=["title"],ua={key:0,class:"filter-indicator"},ma={class:"header-actions"},fa={key:0},pa={key:1},ha={key:2},va={key:3},_a={class:"profile-avatar"},ya=["src","alt"],Ua={key:1,class:"avatar-placeholder"},ba={class:"employee-info"},wa={class:"employee-name"},Aa={class:"employee-email"},ka={class:"address-text"},Ca={class:"address-text"},Na={__name:"otherEmployeeDetails",setup(ne){const i=u(null),F=Oe(),P=u(j.getTenantId()),L=u(!1),b=u(null),w=u(!0),_=u(""),d=u(1),y=u(25),H=u(0),I=u([{key:"assignedUser.first_name",order:"asc"}]),J=u([]),T=u([]),ee=u(j.getRole()),ae=u(j.getUserId());u(null),u([]),u([]),u([]),u([]);const o=Me({organization:"",branch:"",department:"",role:[],accessLevel:[],gender:[],dateFrom:"",dateTo:""}),se=[{key:"branch",label:"Branch",type:"select",show:!0},{key:"department",label:"Department",type:"select",show:!0}],te=Z(()=>[{key:"avatarImage",label:"Avatar",sortable:!1,width:"0.8"},{key:"assignedUser.first_name",label:"Name",sortable:!1,width:"1.5"},{key:"assignedUser.gender",label:"Gender",sortable:!1,width:"1"},{key:"assignedUser.DOB",label:"DOB",sortable:!1,width:"1.2"},{key:"assignedUser.bloodGroup",label:"Blood Group",sortable:!1,width:"1.2"},{key:"assignedUser.maritalStatus",label:"Marital Status",sortable:!1,width:"1.4"},{key:"tagStatus",label:"Tag Status",sortable:!1,width:"180px"},{key:"assignedUser.dateOfLeaving",label:"Date of Leaving",sortable:!1,width:"1.5"},{key:"assignedUser.dateOfJoining",label:"Date of Joining",sortable:!1,width:"1.5"},{key:"assignedUser.ESIAccountNumber",label:"ESI AccNo",sortable:!1,width:"1.5"},{key:"assignedUser.PFAccountNumber",label:"PF AccNo",sortable:!1,width:"1.5"},{key:"assignedUser.permanent_Address",label:"Permanent Address",sortable:!1,width:"2"},{key:"assignedUser.current_Address",label:"Current Address",sortable:!1,width:"2"},{key:"assignedUser.emergency_Contact_Name",label:"Emergency Contact",sortable:!1,width:"1.5"},{key:"assignedUser.emergency_Contact_Mobile_Number",label:"Emergency Contact Number",sortable:!1,width:"1.8"},{key:"assignedUser.emergency_Contact_Relationship",label:"Emergency Relationship",sortable:!1,width:"1.5"},{key:"assignedUser.guardians_Name",label:"Guardian's Name",sortable:!1,width:"1.5"},{key:"assignedUser.aadhar",label:"Aadhar",sortable:!1,width:"1.2"},{key:"assignedUser.pan",label:"PAN",sortable:!1,width:"1.2"},{key:"assignedUser.UAN",label:"UAN",sortable:!1,width:"1.5"}]),t=Z(()=>({branch:o.branch,department:o.department,organization:o.organization,role:o.role,accessLevel:o.accessLevel,gender:o.gender,dateFrom:o.dateFrom,dateTo:o.dateTo})),c=Z(()=>o.branch||o.organization||o.department||o.role.length>0||o.accessLevel.length>0||o.gender.length>0||o.dateFrom!==""||o.dateTo!==""||_.value!==""),m=Z(()=>J.value),A=l=>l?new Date(l).toLocaleDateString():"N/A",U=l=>{var v;const s=(v=l.assignedCards)==null?void 0:v.find(f=>{var D;return((D=f.cardManagement_id)==null?void 0:D.type)==="tag"});return s?`${s.cardManagement_id.rfidCard} (${s.cardManagement_id.cardAccess?"Enabled":"Disabled"})`:"N/A"},N=async l=>{try{const s=Q.getToken(),v=await fetch(l,{headers:{Authorization:`Bearer ${s}`}});if(!v.ok)throw new Error("Failed to load image");const f=await v.blob();return URL.createObjectURL(f)}catch(s){return console.error("Error loading profile image:",s),null}},h=async(l=d.value,s=y.value,v=_.value)=>{try{L.value=!0,b.value=null;const f=Q.getToken(),D=["employeeId","accessOn","status","assignedUser.appAccess","config.configName","config.id","salaryConfig.configName","salaryConfig.id","controllerStatus","assignedCards.cardManagement_id.id","assignedCards.cardManagement_id.rfidCard","assignedCards.cardManagement_id.type","assignedCards.cardManagement_id.cardAccess","assignedTag.cardManagement_id.rfidCard","assignedTag.cardManagement_id.type","assignedTag.cardManagement_id.cardAccess","assignedAccessLevels.accesslevels_id.accessLevelName","assignedAccessLevels.accesslevels_id.id","assignedAccessLevels.accesslevels_id.accessLevelNumber","department.id","department.departmentName","branch.branchName","branch.id","id","assignedCards.id","assignedTag.id","assignedAccessLevels.id","assignedUser.first_name","assignedUser.phone","assignedUser.email","assignedUser.avatar.id","assignedUser.avatar.type","assignedUser.avatar.title","assignedUser.tenant.tenantId","assignedUser.tenant.tenantName","assignedUser.role.name","assignedUser.role.id","assignedUser.id","date_created","assignedUser.accountNumber","assignedUser.aadhar","assignedUser.IFSC","assignedUser.gender","assignedUser.UPI","assignedUser.dateOfLeaving","assignedUser.dateOfJoining","assignedUser.DOB","assignedUser.PFAccountNumber","assignedUser.maritalStatus","assignedUser.ESIAccountNumber","assignedUser.officeEmail","assignedUser.pan","assignedUser.bloodGroup","assignedUser.gst","assignedUser.permanent_Address","assignedUser.current_Address","assignedUser.emergency_Contact_Name","assignedUser.emergency_Contact_Mobile_Number","assignedUser.emergency_Contact_Relationship","assignedUser.emergency_Contact_Address","assignedUser.guardians_Name","assignedUser.voter_ID","assignedUser.driving_License","assignedUser.UAN","assignedUser.verification","previousRecord.id","previousRecord.previousRecord_id.id","previousRecord.previousRecord_id.companyName","previousRecord.previousRecord_id.Designation","previousRecord.previousRecord_id.joiningDate","previousRecord.previousRecord_id.leavingDate","previousRecord.previousRecord_id.Currency","previousRecord.previousRecord_id.salary"];let e=[];if(ee.value==="Admin"||ee.value==="Dealer"?e.push(`filter[assignedUser][tenant][tenantId][_eq]=${P.value}`):(e.push(`filter[_or][0][approver][id][_eq]=${ae.value}`),e.push(`filter[_or][1][assignedUser][id][_eq]=${ae.value}`)),v&&(e.push(`filter[_or][0][employeeId][_contains]=${v}`),e.push(`filter[_or][1][assignedUser][first_name][_contains]=${v}`),e.push(`filter[_or][2][assignedUser][email][_contains]=${v}`),e.push(`filter[_or][3][branch][branchName][_contains]=${v}`)),o.organization&&e.push(`filter[assignedUser][organization][id][_eq]=${o.organization}`),o.department&&e.push(`filter[department][id][_eq]=${o.department}`),o.branch&&e.push(`filter[branchLocation][id][_eq]=${o.branch}`),o.role.length&&e.push(`filter[assignedUser][role][name][_in]=${o.role.join(",")}`),o.accessLevel.length&&e.push(`filter[assignedAccessLevels][accesslevels_id][accessLevelName][_in]=${o.accessLevel.join(",")}`),o.gender.length&&e.push(`filter[assignedUser][gender][_in]=${o.gender.join(",")}`),o.dateFrom&&e.push(`filter[assignedUser][dateOfJoining][_gte]=${o.dateFrom}`),o.dateTo&&e.push(`filter[assignedUser][dateOfJoining][_lte]=${o.dateTo}`),I.value.length>0){const V=I.value.map(Y=>`${Y.order==="desc"?"-":""}${Y.key}`).join(",");e.push(`sort=${V}`)}const a=[...D.map(V=>`fields[]=${V}`),...e,`limit=${s}`,`page=${l}`].join("&"),B=await fetch(`https://appv1.fieldseasy.com/directus/items/personalModule?${a}`,{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"}});if(!B.ok)throw new Error(`HTTP error! status: ${B.status}`);const z=await B.json();J.value=await Promise.all(z.data.map(async V=>{var Y,le;if((le=(Y=V.assignedUser)==null?void 0:Y.avatar)!=null&&le.id){const Ae=`https://appv1.fieldseasy.com/directus/assets/${V.assignedUser.avatar.id}`;V.avatarImage=await N(Ae)}return V}));const $=`https://appv1.fieldseasy.com/directus/items/personalModule?${e.join("&")}&aggregate[countDistinct]=id`,we=await(await fetch($,{headers:{Authorization:`Bearer ${f}`}})).json();H.value=parseInt(we.data[0].countDistinct.id)}catch(f){console.error("Error fetching employee data:",f),b.value=f.message||"Failed to load employees"}finally{L.value=!1}},x=()=>{w.value=!w.value},M=l=>{Object.assign(o,l),d.value=1,w.value=!0,h()},re=l=>{w.value=l},ie=()=>{Object.keys(o).forEach(l=>{o[l]=Array.isArray(o[l])?[]:""}),_.value="",T.value=[],I.value=[{key:"assignedUser.first_name",order:"asc"}],h()},oe=l=>{var s;I.value=[{key:l,order:((s=I.value[0])==null?void 0:s.order)||"asc"}]},k=l=>{var s;I.value=[{key:((s=I.value[0])==null?void 0:s.key)||"",order:l}]},K=({field:l,direction:s})=>{I.value=[{key:l,order:s}],h()},O=l=>{l&&l.id?F.push(`/employee-details/employee/${l.id}/personalmodule`):console.error("Invalid item or item ID")},he=async()=>{var l;if(!T.value.length){alert("Please select items to delete");return}if(confirm(`Are you sure you want to delete ${T.value.length} selected employee(s)?`))try{const s=Q.getToken();let v=0;for(const f of T.value){const D=J.value.find(a=>a.id===f);if(!D)continue;const e=[fetch(`https://appv1.fieldseasy.com/directus/items/personalModule/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})];(l=D.assignedUser)!=null&&l.id&&e.push(fetch(`https://appv1.fieldseasy.com/directus/users/${D.assignedUser.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}));try{await Promise.all(e)}catch(a){console.error(`Error deleting item ${f}:`,a),v++}}T.value=[],alert(v===0?"Selected employees deleted successfully":`Operation completed with ${v} errors. Please refresh the page.`),await h()}catch(s){console.error("Error in delete operation:",s),alert("An error occurred during the delete operation. Please try again.")}},G=Re(()=>{h(1,y.value,_.value)},300),E=async l=>{d.value=l,await h()},X=async l=>{y.value=l,d.value=1,await h()};return Fe(async()=>{await h(),await j.fetchLoginUserDetails(),P.value=j.getTenantId()}),Te(()=>{G.cancel()}),(l,s)=>{const v=ze("ErrorState");return C(),S("div",la,[w.value?(C(),S("div",da,[n("div",ca,[g(Le,{tenantId:P.value,initialFilters:t.value,initiallyVisible:!0,"filter-schema":se,onApplyFilters:M,onFilterVisibilityChanged:re},null,8,["tenantId","initialFilters"])])])):de("",!0),n("div",{class:fe(["main-content",{"full-width":!w.value}])},[g(je,{searchQuery:_.value,"onUpdate:searchQuery":[s[3]||(s[3]=f=>_.value=f),Be(G)],showSearch:!0,searchPlaceholder:"Search employees...",isEmpty:m.value.length===0&&!_.value,hasError:b.value},{"before-search":r(()=>[n("button",{class:fe(["filter-toggle-static",{active:c.value}]),onClick:x,title:w.value?"Hide filters":"Show filters","aria-label":"Toggle filters"},[s[4]||(s[4]=n("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("polygon",{points:"22,3 2,3 10,12.46 10,19 14,21 14,12.46"})],-1)),c.value?(C(),S("div",ua)):de("",!0)],10,ga)]),actions:r(()=>[n("div",ma,[T.value.length>0?(C(),S("button",{key:0,class:"btn-danger",onClick:he},[s[5]||(s[5]=n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-trash"},[n("path",{d:"M3 6h18"}),n("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),n("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})],-1)),R(" Delete ("+p(T.value.length)+") ",1)])):de("",!0),g(Xe,{headers:l.headers,items:m.value,filters:o,search:_.value},null,8,["headers","items","filters","search"])])]),pagination:r(()=>[g(Je,{page:d.value,"onUpdate:page":[s[1]||(s[1]=f=>d.value=f),E],itemsPerPage:y.value,"onUpdate:itemsPerPage":[s[2]||(s[2]=f=>y.value=f),X],"total-items":H.value},null,8,["page","itemsPerPage","total-items"])]),default:r(()=>{var f,D;return[L.value?(C(),S("div",fa,[g(Ve,{variant:"table-body-only",rows:J.value.length||10,columns:te.value.length},null,8,["rows","columns"])])):b.value?(C(),S("div",pa,[g(v,{title:"Unable to load employees",message:b.value,onRetry:h},null,8,["message"])])):m.value.length===0?(C(),S("div",ha,[g(qe,{title:"No employees found",message:"Try adjusting your filters or search term",primaryAction:{text:"Clear Filters",icon:"X"},onPrimaryAction:ie})])):(C(),S("div",va,[g(He,{items:m.value,columns:te.value,selectedItems:T.value,showSelection:!1,sortBy:((f=I.value[0])==null?void 0:f.key)||"",sortDirection:((D=I.value[0])==null?void 0:D.order)||"asc",itemKey:"id",rowClickable:!0,"onUpdate:selectedItems":s[0]||(s[0]=e=>T.value=e),"onUpdate:sortBy":oe,"onUpdate:sortDirection":k,onRowClick:O,onSort:K},{"cell-avatarImage":r(({item:e})=>{var a;return[n("div",_a,[e.avatarImage?(C(),S("img",{key:0,src:e.avatarImage,alt:(a=e.assignedUser)==null?void 0:a.first_name,class:"avatar-image"},null,8,ya)):(C(),S("div",Ua,s[6]||(s[6]=[n("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),n("circle",{cx:"12",cy:"7",r:"4"})],-1)])))])]}),"cell-assignedUser.first_name":r(({item:e})=>{var a,B;return[n("div",ba,[n("h3",wa,p(((a=e.assignedUser)==null?void 0:a.first_name)||"Unknown"),1),n("p",Aa,p(((B=e.assignedUser)==null?void 0:B.email)||"No email"),1)])]}),"cell-assignedUser.gender":r(({item:e})=>{var a;return[n("span",null,p(((a=e.assignedUser)==null?void 0:a.gender)||"N/A"),1)]}),"cell-assignedUser.DOB":r(({item:e})=>{var a;return[n("span",null,p(A((a=e.assignedUser)==null?void 0:a.DOB)),1)]}),"cell-assignedUser.bloodGroup":r(({item:e})=>{var a;return[n("span",null,p(((a=e.assignedUser)==null?void 0:a.bloodGroup)||"N/A"),1)]}),"cell-assignedUser.maritalStatus":r(({item:e})=>{var a;return[n("span",null,p(((a=e.assignedUser)==null?void 0:a.maritalStatus)||"N/A"),1)]}),"cell-tagStatus":r(({item:e})=>[n("span",null,p(U(e)),1)]),"cell-assignedUser.dateOfLeaving":r(({item:e})=>{var a;return[n("span",null,p(A((a=e.assignedUser)==null?void 0:a.dateOfLeaving)),1)]}),"cell-assignedUser.dateOfJoining":r(({item:e})=>{var a;return[n("span",null,p(A((a=e.assignedUser)==null?void 0:a.dateOfJoining)),1)]}),"cell-assignedUser.ESIAccountNumber":r(({item:e})=>{var a;return[n("span",null,p(((a=e.assignedUser)==null?void 0:a.ESIAccountNumber)||"N/A"),1)]}),"cell-assignedUser.PFAccountNumber":r(({item:e})=>{var a;return[n("span",null,p(((a=e.assignedUser)==null?void 0:a.PFAccountNumber)||"N/A"),1)]}),"cell-assignedUser.permanent_Address":r(({item:e})=>{var a;return[n("span",ka,p(((a=e.assignedUser)==null?void 0:a.permanent_Address)||"N/A"),1)]}),"cell-assignedUser.current_Address":r(({item:e})=>{var a;return[n("span",Ca,p(((a=e.assignedUser)==null?void 0:a.current_Address)||"N/A"),1)]}),"cell-assignedUser.emergency_Contact_Name":r(({item:e})=>{var a;return[n("span",null,p(((a=e.assignedUser)==null?void 0:a.emergency_Contact_Name)||"N/A"),1)]}),"cell-assignedUser.emergency_Contact_Mobile_Number":r(({item:e})=>{var a;return[n("span",null,p(((a=e.assignedUser)==null?void 0:a.emergency_Contact_Mobile_Number)||"N/A"),1)]}),"cell-assignedUser.emergency_Contact_Relationship":r(({item:e})=>{var a;return[n("span",null,p(((a=e.assignedUser)==null?void 0:a.emergency_Contact_Relationship)||"N/A"),1)]}),"cell-assignedUser.guardians_Name":r(({item:e})=>{var a;return[n("span",null,p(((a=e.assignedUser)==null?void 0:a.guardians_Name)||"N/A"),1)]}),"cell-assignedUser.aadhar":r(({item:e})=>{var a;return[g(ce,{"encrypted-value":(a=e.assignedUser)==null?void 0:a.aadhar,"field-name":"aadhar"},null,8,["encrypted-value"])]}),"cell-assignedUser.pan":r(({item:e})=>{var a;return[g(ce,{"encrypted-value":(a=e.assignedUser)==null?void 0:a.pan,"field-name":"pan"},null,8,["encrypted-value"])]}),"cell-assignedUser.UAN":r(({item:e})=>{var a;return[g(ce,{"encrypted-value":(a=e.assignedUser)==null?void 0:a.UAN,"field-name":"UAN"},null,8,["encrypted-value"])]}),_:1},8,["items","columns","selectedItems","sortBy","sortDirection"])]))]}),_:1},8,["searchQuery","isEmpty","hasError","onUpdate:searchQuery"]),g(oa,{ref_key:"rfidCardPopup",ref:i},null,512)],2)])}}},Ea=pe(Na,[["__scopeId","data-v-6730bb1d"]]);export{Ea as default};
