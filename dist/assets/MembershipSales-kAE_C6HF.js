import{_ as X,r as m,c as Y,o as J,l as p,i as a,f as s,p as i,w as t,H as r,v,g as T,X as K,e as u,h as M,a as x,k as f,U as F,x as n,D as W,G as w,F as Z,B as ee,j as k,n as se,q as te,aj as j,ak as q,a1 as E,al as le,$ as ae,m as ie,a2 as oe,C as ne,s as L,a3 as re}from"./index-B12n8wa1.js";import{a as de}from"./accessLevelService-CtifRQSW.js";const ue={class:"membership-sales"},ce={class:"sales-header mb-8"},me={class:"d-flex justify-space-between align-center"},pe={class:"text-h3 font-weight-bold mb-2"},fe={class:"d-flex justify-space-between align-center mb-4"},ve={class:"card-header pa-4"},ge={class:"d-flex align-center justify-space-between"},be={class:"d-flex align-center"},ye={class:"text-h6 font-weight-bold"},xe={class:"text-caption text-grey-darken-1"},ke={class:"d-flex align-center mb-3"},Ve={class:"text-h3 font-weight-bold text-primary mr-2"},_e={class:"text-body-2 text-grey-darken-1"},Ce={class:"features-list"},we={key:0,class:"feature-item"},Se={key:1,class:"feature-item"},ze={key:2,class:"feature-item"},Ae={key:3,class:"feature-item"},Me={class:"text-body-2"},Le={class:"text-h5 font-weight-bold mt-2"},he={key:1,class:"text-center py-8"},Pe={class:"text-body-1 text-grey-darken-1 mb-4"},De={class:"qr-placeholder bg-grey-lighten-4 pa-6 rounded"},Be={class:"text-caption mt-2"},Ie={class:"text-caption text-grey mt-2"},Ne={class:"d-flex gap-2"},Ue={__name:"MembershipSales",setup(Te){const V=m([]),_=m("all"),d=m(null),S=m(!1),C=m(!1),z=m(null),h=m("Cash"),P=m(""),D=Y(()=>_.value==="all"?V.value:V.value.filter(o=>o.recurringBilling===_.value)),c=m({name:"",mobile:"",email:""});J(async()=>{try{const o=await de.getAll();V.value=o.filter(e=>e.status==="active")}catch(o){console.error(o)}});const $=o=>{d.value=o},R=async()=>{const{valid:o}=await z.value.validate();if(o){S.value=!0;try{await new Promise(e=>setTimeout(e,1500)),P.value=`MEM${Date.now().toString().slice(-8)}`,C.value=!0}catch{alert("Error processing sale")}finally{S.value=!1}}},G=()=>{alert("Printing receipt...")},H=()=>{var o;C.value=!1,d.value=null,c.value={name:"",mobile:"",email:""},(o=z.value)==null||o.reset()},B=o=>({multi:"purple",visitor:"blue",parking:"indigo",canteen:"orange"})[o]||"grey",O=o=>({multi:"mdi-star-four-points",visitor:"mdi-account-group",parking:"mdi-car-parking",canteen:"mdi-food"})[o]||"mdi-key",Q=(o,e)=>o==="global"?"Valid at all locations":`Valid at ${e.length} location(s)`;return(o,e)=>(u(),p("div",ue,[a("div",ce,[a("div",me,[a("div",null,[a("h1",pe,[s(r,{size:"44",color:"primary",class:"mr-3"},{default:t(()=>e[6]||(e[6]=[i("mdi-card-account-details")])),_:1}),e[7]||(e[7]=i(" Membership Sales "))]),e[8]||(e[8]=a("p",{class:"text-subtitle-1 text-grey-darken-1"},"Sell access levels and memberships to customers",-1))]),s(v,{color:"primary",size:"large","prepend-icon":"mdi-cog",variant:"outlined",to:"/apps/access-levels"},{default:t(()=>e[9]||(e[9]=[i(" Manage Access Levels ")])),_:1})])]),s(T,null,{default:t(()=>[s(M,{cols:"12",md:"8"},{default:t(()=>[a("div",fe,[e[11]||(e[11]=a("h2",{class:"text-h5 font-weight-bold"},"Available Access Levels",-1)),s(F,{color:"success",variant:"flat"},{default:t(()=>[s(r,{start:"",size:"16"},{default:t(()=>e[10]||(e[10]=[i("mdi-check-circle")])),_:1}),i(" "+n(D.value.length)+" Plans Found ",1)]),_:1})]),s(W,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value=l),color:"primary",class:"mb-6"},{default:t(()=>[s(w,{value:"all",class:"text-none"},{default:t(()=>e[12]||(e[12]=[i("All Plans")])),_:1}),s(w,{value:"daily",class:"text-none"},{default:t(()=>e[13]||(e[13]=[i("Daily / Passes")])),_:1}),s(w,{value:"monthly",class:"text-none"},{default:t(()=>e[14]||(e[14]=[i("Monthly")])),_:1}),s(w,{value:"yearly",class:"text-none"},{default:t(()=>e[15]||(e[15]=[i("Yearly")])),_:1})]),_:1},8,["modelValue"]),s(T,null,{default:t(()=>[(u(!0),p(Z,null,ee(D.value,l=>(u(),x(M,{cols:"12",md:"6",key:l.id},{default:t(()=>{var I,N;return[s(k,{class:te(["membership-card",{selected:((I=d.value)==null?void 0:I.id)===l.id}]),style:se({borderColor:((N=d.value)==null?void 0:N.id)===l.id?"#1976D2":"transparent"}),elevation:"3",hover:"",onClick:A=>$(l)},{default:t(()=>{var A;return[a("div",ve,[a("div",ge,[a("div",be,[s(j,{color:B(l.module)+"-lighten-4",size:"56",class:"mr-3"},{default:t(()=>[s(r,{color:B(l.module),size:"32"},{default:t(()=>[i(n(O(l.module)),1)]),_:2},1032,["color"])]),_:2},1032,["color"]),a("div",null,[a("h3",ye,n(l.name),1),a("div",xe,n(Q(l.scope,l.locationIds)),1)])]),((A=d.value)==null?void 0:A.id)===l.id?(u(),x(F,{key:0,color:"primary",size:"small",variant:"flat"},{default:t(()=>[s(r,{start:"",size:"14"},{default:t(()=>e[16]||(e[16]=[i("mdi-check")])),_:1}),e[17]||(e[17]=i(" Selected "))]),_:1})):f("",!0)])]),s(q),s(E,{class:"pb-2"},{default:t(()=>{var g,b,y,U;return[a("div",ke,[a("div",Ve," ₹"+n(l.price.toLocaleString()),1),a("div",_e," / "+n(l.recurringBilling),1)]),a("div",Ce,[(g=l.permissions.visitor)!=null&&g.allowEntry?(u(),p("div",we,[s(r,{size:"18",color:"success",class:"mr-2"},{default:t(()=>e[18]||(e[18]=[i("mdi-check-circle")])),_:1}),a("span",null,"Visitor Access"+n(l.permissions.visitor.vipAccess?" (VIP)":""),1)])):f("",!0),(b=l.permissions.parking)!=null&&b.allowParking?(u(),p("div",Se,[s(r,{size:"18",color:"success",class:"mr-2"},{default:t(()=>e[19]||(e[19]=[i("mdi-check-circle")])),_:1}),a("span",null,"Parking Access"+n(l.permissions.parking.premiumSlots?" (Premium)":""),1)])):f("",!0),((y=l.permissions.canteen)==null?void 0:y.creditLimit)>0?(u(),p("div",ze,[s(r,{size:"18",color:"success",class:"mr-2"},{default:t(()=>e[20]||(e[20]=[i("mdi-check-circle")])),_:1}),a("span",null,"₹"+n(l.permissions.canteen.creditLimit)+" Canteen Credit",1)])):f("",!0),((U=l.permissions.canteen)==null?void 0:U.discount)>0?(u(),p("div",Ae,[s(r,{size:"18",color:"success",class:"mr-2"},{default:t(()=>e[21]||(e[21]=[i("mdi-check-circle")])),_:1}),a("span",null,n(l.permissions.canteen.discount)+"% Discount",1)])):f("",!0)])]}),_:2},1024),s(q),s(le,{class:"pa-4"},{default:t(()=>{var g,b;return[s(v,{block:"",color:((g=d.value)==null?void 0:g.id)===l.id?"success":"primary",variant:((b=d.value)==null?void 0:b.id)===l.id?"flat":"outlined",size:"large"},{default:t(()=>{var y;return[i(n(((y=d.value)==null?void 0:y.id)===l.id?"Selected":"Select Plan"),1)]}),_:2},1032,["color","variant"])]}),_:2},1024)]}),_:2},1032,["class","style","onClick"])]}),_:2},1024))),128))]),_:1}),V.value.length===0?(u(),x(k,{key:0,class:"text-center pa-8"},{default:t(()=>[s(r,{size:"64",color:"grey-lighten-2"},{default:t(()=>e[22]||(e[22]=[i("mdi-package-variant")])),_:1}),e[24]||(e[24]=a("h3",{class:"text-h6 mt-4 mb-2"},"No Access Levels Available",-1)),e[25]||(e[25]=a("p",{class:"text-body-2 text-grey mb-4"},"Create access levels to start selling memberships",-1)),s(v,{color:"primary",to:"/apps/access-levels","prepend-icon":"mdi-plus"},{default:t(()=>e[23]||(e[23]=[i(" Create Access Level ")])),_:1})]),_:1})):f("",!0)]),_:1}),s(M,{cols:"12",md:"4"},{default:t(()=>[s(k,{class:"sticky-card",elevation:"3"},{default:t(()=>[s(ae,{class:"bg-primary text-white pa-6"},{default:t(()=>[s(r,{class:"mr-2",color:"white"},{default:t(()=>e[26]||(e[26]=[i("mdi-account-plus")])),_:1}),e[27]||(e[27]=a("span",null,"Customer Details",-1))]),_:1}),s(E,{class:"pa-6"},{default:t(()=>[d.value?(u(),x(ie,{key:0,type:"info",variant:"tonal",class:"mb-4",density:"comfortable"},{default:t(()=>[a("div",Me,[e[28]||(e[28]=a("strong",null,"Selected:",-1)),i(" "+n(d.value.name),1)]),a("div",Le," ₹"+n(d.value.price.toLocaleString()),1)]),_:1})):f("",!0),d.value?(u(),x(oe,{key:2,onSubmit:ne(R,["prevent"]),ref_key:"form",ref:z},{default:t(()=>[s(L,{modelValue:c.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>c.value.name=l),label:"Customer Name",variant:"outlined","prepend-inner-icon":"mdi-account",rules:[l=>!!l||"Name is required"],class:"mb-3"},null,8,["modelValue","rules"]),s(L,{modelValue:c.value.mobile,"onUpdate:modelValue":e[2]||(e[2]=l=>c.value.mobile=l),label:"Mobile Number",variant:"outlined","prepend-inner-icon":"mdi-phone",rules:[l=>!!l||"Mobile is required",l=>/^\d{10}$/.test(l)||"Invalid mobile"],class:"mb-3"},null,8,["modelValue","rules"]),s(L,{modelValue:c.value.email,"onUpdate:modelValue":e[3]||(e[3]=l=>c.value.email=l),label:"Email (Optional)",variant:"outlined","prepend-inner-icon":"mdi-email",type:"email",class:"mb-3"},null,8,["modelValue"]),s(re,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),items:["Cash","Card","UPI","Net Banking"],label:"Payment Method",variant:"outlined","prepend-inner-icon":"mdi-credit-card",class:"mb-4"},null,8,["modelValue"]),s(v,{block:"",color:"success",size:"x-large",type:"submit",loading:S.value,"prepend-icon":"mdi-cash-check",class:"text-none font-weight-bold"},{default:t(()=>[i(" Collect ₹"+n(d.value.price.toLocaleString())+" & Issue ",1)]),_:1},8,["loading"])]),_:1},512)):(u(),p("div",he,[s(r,{size:"64",color:"grey-lighten-3"},{default:t(()=>e[29]||(e[29]=[i("mdi-hand-pointing-left")])),_:1}),e[30]||(e[30]=a("p",{class:"text-body-2 text-grey mt-4"},"Select a plan to proceed",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),s(K,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=l=>C.value=l),"max-width":"500",persistent:""},{default:t(()=>[s(k,{class:"text-center pa-8"},{default:t(()=>[s(j,{color:"success-lighten-5",size:"96",class:"mb-4"},{default:t(()=>[s(r,{size:"64",color:"success"},{default:t(()=>e[31]||(e[31]=[i("mdi-check-circle")])),_:1})]),_:1}),e[39]||(e[39]=a("h2",{class:"text-h4 font-weight-bold mb-2"},"Membership Active!",-1)),a("p",Pe,[e[32]||(e[32]=i(" Issued to ")),a("strong",null,n(c.value.name),1)]),s(k,{variant:"outlined",class:"pa-4 mb-4"},{default:t(()=>[e[34]||(e[34]=a("div",{class:"text-caption text-grey-darken-1 mb-2"},"Access Code",-1)),a("div",De,[s(r,{size:"48",color:"grey"},{default:t(()=>e[33]||(e[33]=[i("mdi-qrcode")])),_:1}),a("div",Be,"QR Code: "+n(P.value),1)]),a("div",Ie,"SMS sent to "+n(c.value.mobile),1)]),_:1}),a("div",Ne,[s(v,{block:"",color:"primary",variant:"outlined",onClick:G},{default:t(()=>[s(r,{start:""},{default:t(()=>e[35]||(e[35]=[i("mdi-printer")])),_:1}),e[36]||(e[36]=i(" Print Receipt "))]),_:1}),s(v,{block:"",color:"primary",onClick:H},{default:t(()=>[s(r,{start:""},{default:t(()=>e[37]||(e[37]=[i("mdi-check")])),_:1}),e[38]||(e[38]=i(" Done "))]),_:1})])]),_:1})]),_:1},8,["modelValue"])]))}},qe=X(Ue,[["__scopeId","data-v-b929606c"]]);export{qe as default};
