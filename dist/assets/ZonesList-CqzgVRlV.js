import{_ as J,r as s,K as Z,y as O,c as E,E as Y,o as ee,l as ae,f as t,w as l,P as te,aV as le,X as oe,e as V,a as S,k as se,S as ne,T as re,i as x,H as b,C as N,p as n,x as y,W as ie,Z as z,j as T,$ as A,a0 as L,v as ue,ak as de,a1 as U,al as ce}from"./index-B12n8wa1.js";import{z as B,Z as ve}from"./ZoneForm-CuWZZbpF.js";const me={class:"zones-container"},fe={class:"actions-cell"},ge={__name:"ZonesList",setup(pe){const r=s(""),c=s(1),v=s(25),C=s(0),_=s([]),i=s(!1),m=s(!1),f=s({}),g=s([]),u=s(!1),d=s(!1),p=s(null),M=Z.getTenantId(),$=O.getToken();var w;const Q=[{key:"zoneName",label:"Zone Name",sortable:!0},{key:"entry_doors",label:"Entry Doors",sortable:!1},{key:"exit_doors",label:"Exit Doors",sortable:!1},{key:"actions",label:"Actions",sortable:!1}],I=a=>!a||!Array.isArray(a)||a.length===0?"None":a.map(e=>e.doorName).join(", "),k=async()=>{var a;try{if(w=(a=(await Z.fetchLoginUserDetails()).role)==null?void 0:a.name,!$||!M)throw new Error("Authentication required or tenant not found");u.value=!0;const o=await B.fetchZones();g.value=o,C.value=o.length}catch(e){console.error("Error fetching zones data:",e)}finally{u.value=!1}},R=a=>{c.value=a},j=a=>{v.value=a},F=()=>{m.value=!1,f.value={},i.value=!0},P=a=>{m.value=!0,f.value={...a},i.value=!0},W=a=>{(w=="Admin"||w=="Manager")&&P(a)},q=a=>{p.value=a,d.value=!0},H=async()=>{try{await B.deleteZone(p.value.id),d.value=!1,p.value=null,await k()}catch(a){console.error("Error deleting zone:",a),alert("Error deleting zone")}},h=()=>{i.value=!1,f.value={}},K=()=>{h(),k()},D=E(()=>r.value?g.value.filter(a=>{var e;return(e=a.zoneName)==null?void 0:e.toLowerCase().includes(r.value.toLowerCase())}):g.value),X=E(()=>{const a=(c.value-1)*v.value,e=a+v.value;return D.value.slice(a,e)});return Y(r,()=>{C.value=D.value.length,c.value=1}),ee(async()=>{await k()}),(a,e)=>(V(),ae("div",me,[t(te,{title:"Zones Management",searchQuery:r.value,"onUpdate:searchQuery":e[1]||(e[1]=o=>r.value=o),searchPlaceholder:"Search zones...",isLoading:u.value,isEmpty:g.value.length===0&&!u.value},{"toolbar-actions":l(()=>[t(z,{variant:"primary","left-icon":"plus",onClick:F},{default:l(()=>e[5]||(e[5]=[n(" Create Zone ")])),_:1})]),pagination:l(()=>[t(ie,{page:c.value,itemsPerPage:v.value,"total-items":C.value,"is-searching":!!r.value,"onUpdate:page":R,"onUpdate:itemsPerPage":j},null,8,["page","itemsPerPage","total-items","is-searching"])]),default:l(()=>[u.value?(V(),S(ne,{key:0,variant:"data-table",rows:6,columns:4})):D.value.length>0?(V(),S(re,{key:1,items:X.value,columns:Q,showSelection:!0,selectedItems:_.value,"onUpdate:selectedItems":e[0]||(e[0]=o=>_.value=o),onRowClick:W},{"cell-entry_doors":l(({value:o})=>[x("span",null,y(I(o)),1)]),"cell-exit_doors":l(({value:o})=>[x("span",null,y(I(o)),1)]),"cell-actions":l(({item:o})=>[x("div",fe,[t(b,{small:"",class:"mr-2",onClick:N(G=>P(o),["stop"]),color:"primary"},{default:l(()=>e[6]||(e[6]=[n(" mdi-pencil ")])),_:2},1032,["onClick"]),t(b,{small:"",onClick:N(G=>q(o),["stop"]),color:"error"},{default:l(()=>e[7]||(e[7]=[n(" mdi-delete ")])),_:2},1032,["onClick"])])]),_:1},8,["items","selectedItems"])):se("",!0)]),_:1},8,["searchQuery","isLoading","isEmpty"]),t(le,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value=o),location:"right",temporary:"",width:"400",class:"zone-form-drawer"},{default:l(()=>[t(T,{class:"h-100 d-flex flex-column",elevation:"0"},{default:l(()=>[t(A,{class:"text-h5 pa-4 border-b"},{default:l(()=>[n(y(m.value?"Edit Zone":"Create Zone")+" ",1),t(L),t(ue,{icon:"",onClick:h,size:"small"},{default:l(()=>[t(b,null,{default:l(()=>e[8]||(e[8]=[n("mdi-close")])),_:1})]),_:1})]),_:1}),t(de),t(U,{class:"pa-4 flex-grow-1 overflow-y-auto"},{default:l(()=>[t(ve,{"is-editing":m.value,"zone-data":f.value,onSaveSuccess:K,onCancel:h},null,8,["is-editing","zone-data"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(oe,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=o=>d.value=o),"max-width":"500px"},{default:l(()=>[t(T,null,{default:l(()=>[t(A,{class:"text-h5"},{default:l(()=>e[9]||(e[9]=[n("Confirm Delete")])),_:1}),t(U,null,{default:l(()=>{var o;return[n(' Are you sure you want to delete the zone "'+y((o=p.value)==null?void 0:o.zoneName)+'"? ',1)]}),_:1}),t(ce,null,{default:l(()=>[t(L),t(z,{variant:"secondary",onClick:e[3]||(e[3]=o=>d.value=!1)},{default:l(()=>e[10]||(e[10]=[n(" Cancel ")])),_:1}),t(z,{variant:"danger",onClick:H},{default:l(()=>e[11]||(e[11]=[n(" Delete ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},we=J(ge,[["__scopeId","data-v-8fe74707"]]);export{we as default};
