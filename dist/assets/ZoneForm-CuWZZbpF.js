import{y as i,_ as F,r as f,c as U,E as D,o as O,l as R,f as n,w as s,C as j,a2 as q,e as S,g as M,a as P,k as H,h as y,s as J,a3 as Z,U as C,aC as I,m as W,p as b,H as G,Z as $,x as K}from"./index-B12n8wa1.js";class L{async fetchDoors(){try{const r=i.getTenantId();return(await i.protectedApi.get(`/items/doors?filter[tenant][tenantId][_eq]=${r}&fields[]=id&fields[]=doorNumber&fields[]=doorName`)).data.data}catch(r){throw console.error("Error fetching doors:",r),r}}async createZone(r){try{const o=i.getTenantId(),l={...r,tenant:o};return console.log("Creating zone payload:",JSON.stringify(l,null,2)),(await i.protectedApi.post("/items/zones",l)).data.data}catch(o){throw console.error("Error creating zone:",o),o.response&&console.error("Error response data:",o.response.data),o}}async updateZone(r,o){try{const l=i.getTenantId(),c={...o,tenant:l};return(await i.protectedApi.patch(`/items/zones/${r}`,c)).data.data}catch(l){throw console.error(`Error updating zone ${r}:`,l),l}}async deleteZone(r){try{await i.protectedApi.delete(`/items/zones/${r}`)}catch(o){throw console.error(`Error deleting zone ${r}:`,o),o}}async fetchZones(){try{const r=i.getTenantId();return(await i.protectedApi.get(`/items/zones?filter[tenant][_eq]=${r}&fields[]=id&fields[]=zoneName&fields[]=entry_doors&fields[]=exit_doors&fields[]=tenant`)).data.data}catch(r){throw console.error("Error fetching zones:",r),r}}}const N=new L,Q={class:"zone-form-container"},X={__name:"ZoneForm",props:{isEditing:{type:Boolean,default:!1},zoneData:{type:Object,default:()=>({})}},emits:["save-success","cancel"],setup(z,{emit:r}){const o=z,l=r,c=f(null),g=f(!1),h=f(!1),v=f([]),u=f([]),m=f([]),p=f({zoneName:"",entry_doors:[],exit_doors:[]}),k=[t=>!!t||"Zone name is required",t=>t&&t.length>=3||"Zone name must be at least 3 characters"],E=[()=>{const t=u.value.length>0,e=m.value.length>0;return t||e||"At least one Entry Door or Exit Door must be selected"}],A=U(()=>{const t=new Set(u.value),e=new Set(m.value);for(const a of t)if(e.has(a))return!0;return!1}),T=async()=>{try{const t=await N.fetchDoors();v.value=t.map(e=>({...e,displayName:`${e.doorNumber} - ${e.doorName}`}))}catch(t){console.error("Error fetching doors:",t)}},w=t=>t.map(e=>{const a=v.value.find(d=>d.id===e);return{doorNumber:a.doorNumber,doorName:a.doorName}}),V=t=>!t||!Array.isArray(t)?[]:t.map(e=>{const a=v.value.find(d=>d.doorNumber===e.doorNumber&&d.doorName===e.doorName);return a==null?void 0:a.id}).filter(e=>e!==void 0),_=()=>{o.isEditing&&o.zoneData&&(p.value.zoneName=o.zoneData.zoneName||"",u.value=V(o.zoneData.entry_doors),m.value=V(o.zoneData.exit_doors))},x=async()=>{const{valid:t}=await c.value.validate();if(t){h.value=!0;try{p.value.entry_doors=w(u.value),p.value.exit_doors=w(m.value),o.isEditing?await N.updateZone(o.zoneData.id,p.value):await N.createZone(p.value),l("save-success")}catch(e){console.error("Error saving zone:",e),alert(`Error ${o.isEditing?"updating":"creating"} zone`)}finally{h.value=!1}}},B=()=>{l("cancel")};return D([u,m],()=>{c.value&&c.value.validate()}),D(()=>o.zoneData,t=>{t&&Object.keys(t).length>0&&_()},{deep:!0}),O(async()=>{await T(),_()}),(t,e)=>(S(),R("div",Q,[n(q,{ref_key:"formRef",ref:c,modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),onSubmit:j(x,["prevent"])},{default:s(()=>[n(M,null,{default:s(()=>[n(y,{cols:"12"},{default:s(()=>[n(J,{modelValue:p.value.zoneName,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value.zoneName=a),label:"Zone Name",placeholder:"Enter zone name",variant:"outlined",density:"comfortable",rules:k,required:""},null,8,["modelValue"])]),_:1}),n(y,{cols:"12",md:"6"},{default:s(()=>[n(Z,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value=a),items:v.value,"item-title":"displayName","item-value":"id",label:"Entry Doors",placeholder:"Select entry doors",variant:"outlined",density:"comfortable",multiple:"",chips:"","closable-chips":"",rules:E},{chip:s(({item:a,props:d})=>[n(C,I(d,{text:a.raw.displayName,closable:""}),null,16,["text"])]),_:1},8,["modelValue","items"])]),_:1}),n(y,{cols:"12",md:"6"},{default:s(()=>[n(Z,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),items:v.value,"item-title":"displayName","item-value":"id",label:"Exit Doors",placeholder:"Select exit doors",variant:"outlined",density:"comfortable",multiple:"",chips:"","closable-chips":"",rules:E},{chip:s(({item:a,props:d})=>[n(C,I(d,{text:a.raw.displayName,closable:""}),null,16,["text"])]),_:1},8,["modelValue","items"])]),_:1}),A.value?(S(),P(y,{key:0,cols:"12"},{default:s(()=>[n(W,{type:"warning",variant:"tonal",density:"compact"},{default:s(()=>[n(G,{start:""},{default:s(()=>e[4]||(e[4]=[b("mdi-alert")])),_:1}),e[5]||(e[5]=b(" Warning: Some doors are selected in both Entry and Exit doors. "))]),_:1})]),_:1})):H("",!0),n(y,{cols:"12",class:"d-flex justify-end gap-2"},{default:s(()=>[n($,{variant:"secondary",onClick:B,disabled:h.value},{default:s(()=>e[6]||(e[6]=[b(" Cancel ")])),_:1},8,["disabled"]),n($,{variant:"primary",onClick:x,loading:h.value,disabled:!g.value},{default:s(()=>[b(K(z.isEditing?"Update Zone":"Create Zone"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Y=F(X,[["__scopeId","data-v-b08fa4a4"]]),te=Object.freeze(Object.defineProperty({__proto__:null,default:Y},Symbol.toStringTag,{value:"Module"}));export{Y as Z,te as a,N as z};
