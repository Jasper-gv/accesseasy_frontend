import{_ as le,K as re,y as ce,r as s,af as ue,E as de,o as ve,l as pe,i as u,f as n,aS as me,w as l,X as ge,P as fe,q as he,e as S,j as ye,$ as _e,p as x,x as P,a1 as we,a2 as Ce,s as z,al as De,a0 as Te,v as F,a as O,S as be,T as $e,az as M,C as R,N as B,aT as ke,aU as Ve,W as Se,Z as xe,aD as Pe}from"./index-B12n8wa1.js";const Be={class:"employee-container"},Ne={class:"toolbar-with-stats"},Ie={class:"stats-container"},Ue={class:"stat-item total--text"},qe={class:"stat-value"},Ae={class:"teams-table-wrapper"},je={class:"action-buttons"},Ee={__name:"designationConfiguration",setup(ze){const v=re.getTenantId(),m=ce.getToken(),p=s(1),h=s(25),y=s(0),o=s([]),N=s([]),D=s(!0),r=s(""),H=s(!1),_=s(!1),g=s(!1),f=s(!1),w=s(!1),T=s(!1),b=s(!1),c=s({id:null,designations_name:"",description:"",status:"active",tenant:v}),J={required:e=>!!e||"This field is required"},I=[{key:"designations_name",label:"Designation Name",width:"250px",sortable:!0},{key:"description",label:"Description",width:"300px",sortable:!1},{key:"actions",label:"Actions",sortable:!1,width:"100px"}],C=s("sort"),$=s("asc"),L=()=>{const e=["id","designations_name","description","status","sort"],t={limit:h.value,page:p.value,"fields[]":e,sort:$.value==="desc"?`-${C.value}`:C.value,"filter[tenant][tenantId][_eq]":v,"filter[status][_neq]":"archived"};return r.value&&(/^\d+$/.test(r.value)||(t["filter[_or][0][designations_name][_icontains]"]=r.value,t["filter[_or][1][description][_icontains]"]=r.value)),Object.entries(t).map(([i,a])=>`${i}=${encodeURIComponent(a)}`).join("&")},U=async()=>{var e,t,i;try{const a={"aggregate[count]":"id","filter[tenant][tenantId][_eq]":v,"filter[status][_neq]":"archived"};r.value&&(/^\d+$/.test(r.value)||(a["filter[_or][0][designations_name][_icontains]"]=r.value,a["filter[_or][1][description][_icontains]"]=r.value));const k=Object.entries(a).map(([E,ie])=>`${E}=${encodeURIComponent(ie)}`).join("&"),V=await(await fetch(`https://appv1.fieldseasy.com/directus/items/designations?${k}`,{headers:{Authorization:`Bearer ${m}`}})).json(),j=(i=(t=(e=V==null?void 0:V.data)==null?void 0:e[0])==null?void 0:t.count)==null?void 0:i.id;y.value=j?Number(j):0}catch(a){console.error("Count error:",a),y.value=0}},d=async()=>{try{D.value=!0,await U();const e=L(),t=await fetch(`https://appv1.fieldseasy.com/directus/items/designations?${e}`,{headers:{Authorization:`Bearer ${m}`}});if(!t.ok)throw new Error(`HTTP ${t.status}`);const i=await t.json();N.value=i.data||[],o.value=[]}catch(e){console.error("Fetch error:",e)}finally{D.value=!1}},Q=e=>{r.value=e,q()},q=ue(()=>{p.value=1,d()},300),W=e=>C.value=e,K=e=>$.value=e,X=()=>{p.value=1,d()},Z=e=>{p.value=e,d()},G=e=>{h.value=e,p.value=1,d()},Y=e=>o.value=e,ee=async()=>{f.value=!1,await U(),c.value={id:null,designations_name:"",description:"",status:"active",tenant:v},g.value=!0},te=e=>{f.value=!0,c.value={...e},g.value=!0},A=()=>{g.value=!1,c.value={id:null,designations_name:"",description:"",status:"active",tenant:v}},ae=async()=>{if(w.value)try{T.value=!0;const e={designations_name:c.value.designations_name,description:c.value.description,status:"active",tenant:v};let t;if(f.value?t=await fetch(`https://appv1.fieldseasy.com/directus/items/designations/${c.value.id}`,{method:"PATCH",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify(e)}):t=await fetch("https://appv1.fieldseasy.com/directus/items/designations",{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify(e)}),!t.ok)throw new Error(`HTTP ${t.status}`);await d(),A()}catch(e){console.error("Save error:",e)}finally{T.value=!1}},se=e=>{o.value=[e],_.value=!0},ne=()=>{_.value=!1,o.value=[]},oe=async()=>{try{b.value=!0;const e=o.value.map(i=>i.id),t=await fetch("https://appv1.fieldseasy.com/directus/items/designations",{method:"DELETE",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({keys:e})});if(!t.ok)throw new Error(`HTTP ${t.status}`);await d()}catch(e){console.error("Delete error:",e)}finally{b.value=!1,_.value=!1,o.value=[]}};return de(r,q),ve(()=>{d()}),(e,t)=>{var i;return S(),pe("div",Be,[u("div",{class:he(["main-content",{"with-filter":H.value}])},[n(me,{show:_.value,title:"Delete Confirmation",confirmMessage:`Are you sure you want to delete ${o.value.length} ${o.value.length===1?"designation":"designations"}?`,itemLabel:"Designation(s)",itemName:o.value.length===1?(i=o.value[0])==null?void 0:i.designations_name:`${o.value.length} designations`,description:"This action cannot be undone.",cancelText:"Cancel",confirmText:"Delete",deletingText:"Deleting...",deleting:b.value,onClose:ne,onConfirm:oe},null,8,["show","confirmMessage","itemName","deleting"]),n(ge,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=a=>g.value=a),"max-width":"400px",persistent:""},{default:l(()=>[n(ye,null,{default:l(()=>[n(_e,{class:"text-h6 d-flex justify-center py-4"},{default:l(()=>[x(P(f.value?"Edit Designation":"Add Designation"),1)]),_:1}),n(we,null,{default:l(()=>[n(Ce,{ref:"designationForm",modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=a=>w.value=a)},{default:l(()=>[n(z,{modelValue:c.value.designations_name,"onUpdate:modelValue":t[0]||(t[0]=a=>c.value.designations_name=a),label:"Designation Name",rules:[J.required],variant:"outlined",density:"compact"},null,8,["modelValue","rules"]),n(z,{modelValue:c.value.description,"onUpdate:modelValue":t[1]||(t[1]=a=>c.value.description=a),label:"Description",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),n(De,null,{default:l(()=>[n(Te),n(F,{color:"grey-darken-1",variant:"text",onClick:A},{default:l(()=>t[4]||(t[4]=[x(" Cancel ")])),_:1}),n(F,{color:"primary",variant:"text",onClick:ae,loading:T.value,disabled:!w.value},{default:l(()=>[x(P(f.value?"Update":"Save"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(fe,{"search-query":r.value,"has-error":!1,"search-placeholder":"Search designations...","onUpdate:searchQuery":Q},{"toolbar-actions":l(()=>[u("div",Ne,[n(xe,{variant:"primary",text:"Add Designation",leftIcon:B(Pe),width:"100px",onClick:ee},null,8,["leftIcon"]),u("div",Ie,[u("div",Ue,[u("span",qe,P(y.value),1),t[5]||(t[5]=u("span",{class:"stat-title"},"Total Designations",-1))])])])]),pagination:l(()=>[n(Se,{page:p.value,"items-per-page":h.value,"total-items":y.value,"onUpdate:page":Z,"onUpdate:itemsPerPage":G},null,8,["page","items-per-page","total-items"])]),default:l(()=>[u("div",Ae,[D.value?(S(),O(be,{key:0,variant:"data-table",rows:h.value,columns:I.length},null,8,["rows","columns"])):(S(),O($e,{key:1,items:N.value,columns:I,"show-selection":!1,"selected-items":o.value,"sort-by":C.value,"sort-direction":$.value,"onUpdate:selectedItems":Y,"onUpdate:sortBy":W,"onUpdate:sortDirection":K,onSort:X,onRowClick:e.handleRowClick},{"cell-actions":l(({item:a})=>[u("div",je,[n(M,{icon:B(ke),variant:"ghost",size:"sm",tooltip:"Edit Designation",onClick:R(k=>te(a),["stop"])},null,8,["icon","onClick"]),n(M,{icon:B(Ve),variant:"ghost",size:"sm",tooltip:"Delete Designation",onClick:R(k=>se(a),["stop"])},null,8,["icon","onClick"])])]),_:1},8,["items","selected-items","sort-by","sort-direction","onRowClick"]))])]),_:1},8,["search-query"])],2)])}}},Me=le(Ee,[["__scopeId","data-v-2af5da34"]]);export{Me as default};
