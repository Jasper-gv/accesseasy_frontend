import{_ as fe,K as he,y as ge,r as s,c as ye,af as R,E as _e,o as we,l as Te,i as m,f as l,aS as Ce,w as n,X as $e,P as be,q as Ve,e as j,j as ke,$ as Se,p as q,x as k,a1 as Ue,a2 as xe,s as J,a3 as De,a8 as Pe,C as A,N as S,ak as Be,al as Ie,a0 as Ne,v as Q,a as W,S as je,T as qe,az as K,aT as Ae,aU as Ee,W as ze,Z as Le,aD as Oe}from"./index-B12n8wa1.js";const Fe={class:"employee-container"},He={class:"toolbar-with-stats"},Me={class:"stats-container"},Re={class:"stat-item total--text"},Je={class:"stat-value"},Qe={class:"teams-table-wrapper"},We={class:"text-no-wrap"},Ke={class:"action-buttons"},Xe={__name:"teamConfiguration",setup(Ze){const f=he.getTenantId(),h=ge.getToken(),g=s(1),T=s(25),C=s(0),r=s([]),E=s([]),U=s(!0),c=s(""),X=s(!1),$=s(!1),y=s(!1),_=s(!1),b=s(!1),x=s(!1),D=s(!1),w=s([]),v=s(""),P=s(!1),Z=ye(()=>{if(!v.value)return w.value;const e=v.value.toLowerCase();return w.value.filter(a=>a.title.toLowerCase().includes(e))}),B=R(async()=>{if(y.value){P.value=!0;try{const a=["id","assignedUser.id","assignedUser.first_name"].map(i=>`fields[]=${encodeURIComponent(i)}`).join("&"),o=await fetch(`https://appv1.fieldseasy.com/directus/items/personalModule?${a}&limit=100`,{headers:{Authorization:`Bearer ${h}`}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const t=await o.json();w.value=(t.data||[]).filter(i=>{var d;return(d=i.assignedUser)==null?void 0:d.id}).map(i=>{var d;return{value:i.id,title:((d=i.assignedUser)==null?void 0:d.first_name)||"â€”"}})}catch(e){console.error("Fetch users error:",e),w.value=[]}finally{P.value=!1}}},300),u=s({id:null,teams_name:"",status:"active",tenant:f,team_lead:null}),G={required:e=>!!e||"This field is required"},z=[{key:"teams_name",label:"Team Name",width:"250px",sortable:!0},{key:"team_lead",label:"Team Lead",width:"180px",sortable:!1},{key:"actions",label:"Actions",width:"100px",sortable:!1}],V=s("sort"),I=s("asc"),Y=()=>{const e=["id","teams_name","status","sort","team_lead.id","team_lead.assignedUser.id","team_lead.assignedUser.first_name"],a={limit:T.value,page:g.value,"fields[]":e,sort:I.value==="desc"?`-${V.value}`:V.value,"filter[tenant][tenantId][_eq]":f,"filter[status][_neq]":"archived"};return c.value&&(/^\d+$/.test(c.value)||(a["filter[_or][0][teams_name][_icontains]"]=c.value)),Object.entries(a).map(([o,t])=>`${o}=${encodeURIComponent(t)}`).join("&")},L=async()=>{var e,a,o;try{const t={"aggregate[count]":"id","filter[tenant][tenantId][_eq]":f,"filter[status][_neq]":"archived"};c.value&&(/^\d+$/.test(c.value)||(t["filter[_or][0][teams_name][_icontains]"]=c.value));const i=Object.entries(t).map(([M,pe])=>`${M}=${encodeURIComponent(pe)}`).join("&"),N=await(await fetch(`https://appv1.fieldseasy.com/directus/items/teams?${i}`,{headers:{Authorization:`Bearer ${h}`}})).json(),H=(o=(a=(e=N==null?void 0:N.data)==null?void 0:e[0])==null?void 0:a.count)==null?void 0:o.id;C.value=H?Number(H):0}catch(t){console.error("Count error:",t),C.value=0}},p=async()=>{try{U.value=!0,await L();const e=Y(),a=await fetch(`https://appv1.fieldseasy.com/directus/items/teams?${e}`,{headers:{Authorization:`Bearer ${h}`}});if(!a.ok)throw new Error(`HTTP ${a.status}`);const o=await a.json();E.value=o.data||[],r.value=[]}catch(e){console.error("Fetch error:",e)}finally{U.value=!1}},ee=e=>{c.value=e,O()},O=R(()=>{g.value=1,p()},300),ae=e=>V.value=e,te=e=>I.value=e,se=()=>{g.value=1,p()},le=e=>{g.value=e,p()},oe=e=>{T.value=e,g.value=1,p()},ne=e=>r.value=e,ie=async()=>{_.value=!1,await L(),u.value={id:null,teams_name:"",status:"active",tenant:f,team_lead:null},v.value="",y.value=!0,await B()},re=async e=>{var a;_.value=!0,u.value={...e,team_lead:((a=e.team_lead)==null?void 0:a.id)??null},v.value="",y.value=!0,await B()},F=()=>{y.value=!1,u.value={id:null,teams_name:"",status:"active",tenant:f,team_lead:null},v.value="",w.value=[]},ue=async()=>{if(b.value)try{x.value=!0;const e={teams_name:u.value.teams_name,status:"active",tenant:f,team_lead:u.value.team_lead};let a;if(_.value?a=await fetch(`https://appv1.fieldseasy.com/directus/items/teams/${u.value.id}`,{method:"PATCH",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify(e)}):a=await fetch("https://appv1.fieldseasy.com/directus/items/teams",{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify(e)}),!a.ok)throw new Error(`HTTP ${a.status}`);await p(),F()}catch(e){console.error("Save error:",e)}finally{x.value=!1}},ce=e=>{r.value=[e],$.value=!0},de=()=>{$.value=!1,r.value=[]},me=async()=>{try{D.value=!0;const e=r.value.map(o=>o.id),a=await fetch("https://appv1.fieldseasy.com/directus/items/teams",{method:"DELETE",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({keys:e})});if(!a.ok)throw new Error(`HTTP ${a.status}`);await p()}catch(e){console.error("Delete error:",e)}finally{D.value=!1,$.value=!1,r.value=[]}},ve=()=>{};return _e(c,O),we(()=>p()),(e,a)=>{var o;return j(),Te("div",Fe,[m("div",{class:Ve(["main-content",{"with-filter":X.value}])},[l(Ce,{show:$.value,title:"Delete Confirmation",confirmMessage:`Are you sure you want to delete ${r.value.length} ${r.value.length===1?"team":"teams"}?`,itemLabel:"Team(s)",itemName:r.value.length===1?(o=r.value[0])==null?void 0:o.teams_name:`${r.value.length} teams`,description:"This action cannot be undone.",cancelText:"Cancel",confirmText:"Delete",deletingText:"Deleting...",deleting:D.value,onClose:de,onConfirm:me},null,8,["show","confirmMessage","itemName","deleting"]),l($e,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=t=>y.value=t),"max-width":"460px",persistent:""},{default:n(()=>[l(ke,null,{default:n(()=>[l(Se,{class:"text-h6 d-flex justify-center py-4"},{default:n(()=>[q(k(_.value?"Edit Team":"Add Team"),1)]),_:1}),l(Ue,null,{default:n(()=>[l(xe,{ref:"teamForm",modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=t=>b.value=t)},{default:n(()=>[l(J,{modelValue:u.value.teams_name,"onUpdate:modelValue":a[0]||(a[0]=t=>u.value.teams_name=t),label:"Team Name",rules:[G.required],variant:"outlined",density:"compact",class:"mb-3"},null,8,["modelValue","rules"]),l(De,{modelValue:u.value.team_lead,"onUpdate:modelValue":a[3]||(a[3]=t=>u.value.team_lead=t),items:Z.value,"item-title":"title","item-value":"value",label:"Select Team Lead",placeholder:"Choose a user",variant:"outlined",density:"compact",clearable:"",loading:P.value,"menu-props":{maxHeight:300},"no-data-text":"No users match the search"},{"prepend-item":n(()=>[l(Pe,null,{default:n(()=>[l(J,{modelValue:v.value,"onUpdate:modelValue":[a[1]||(a[1]=t=>v.value=t),S(B)],placeholder:"Search Team Lead (first name)...",density:"compact",variant:"outlined",clearable:"","hide-details":"",autofocus:"",onClick:a[2]||(a[2]=A(()=>{},["stop"])),class:"mx-2 mb-2"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(Be)]),_:1},8,["modelValue","items","loading"])]),_:1},8,["modelValue"])]),_:1}),l(Ie,null,{default:n(()=>[l(Ne),l(Q,{color:"grey-darken-1",variant:"text",onClick:F},{default:n(()=>a[6]||(a[6]=[q(" Cancel ")])),_:1}),l(Q,{color:"primary",variant:"text",onClick:ue,loading:x.value,disabled:!b.value},{default:n(()=>[q(k(_.value?"Update":"Save"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(be,{"search-query":c.value,"has-error":!1,"search-placeholder":"Search teams...","onUpdate:searchQuery":ee},{"toolbar-actions":n(()=>[m("div",He,[l(Le,{variant:"primary",text:"Add Team",leftIcon:S(Oe),width:"100px",onClick:ie},null,8,["leftIcon"]),m("div",Me,[m("div",Re,[m("span",Je,k(C.value),1),a[7]||(a[7]=m("span",{class:"stat-title"},"Total Teams",-1))])])])]),pagination:n(()=>[l(ze,{page:g.value,"items-per-page":T.value,"total-items":C.value,"onUpdate:page":le,"onUpdate:itemsPerPage":oe},null,8,["page","items-per-page","total-items"])]),default:n(()=>[m("div",Qe,[U.value?(j(),W(je,{key:0,variant:"data-table",rows:T.value,columns:z.length},null,8,["rows","columns"])):(j(),W(qe,{key:1,items:E.value,columns:z,"show-selection":!1,"selected-items":r.value,"sort-by":V.value,"sort-direction":I.value,"onUpdate:selectedItems":ne,"onUpdate:sortBy":ae,"onUpdate:sortDirection":te,onSort:se,onRowClick:ve},{"cell-team_lead":n(({item:t})=>{var i,d;return[m("span",We,k(((d=(i=t.team_lead)==null?void 0:i.assignedUser)==null?void 0:d.first_name)??"-"),1)]}),"cell-actions":n(({item:t})=>[m("div",Ke,[l(K,{icon:S(Ae),variant:"ghost",size:"sm",tooltip:"Edit Team",onClick:A(i=>re(t),["stop"])},null,8,["icon","onClick"]),l(K,{icon:S(Ee),variant:"ghost",size:"sm",tooltip:"Delete Team",onClick:A(i=>ce(t),["stop"])},null,8,["icon","onClick"])])]),_:1},8,["items","selected-items","sort-by","sort-direction"]))])]),_:1},8,["search-query"])],2)])}}},Ye=fe(Xe,[["__scopeId","data-v-7ff9ccce"]]);export{Ye as default};
