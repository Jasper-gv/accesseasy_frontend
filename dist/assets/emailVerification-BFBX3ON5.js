import{_ as L,r as n,c as E,o as K,u as q,z as k,A as M,a as T,w as d,V as Y,b as H,d as J,e as m,f as p,g as G,h as Q,i as l,n as W,j as X,k as B,m as R,p as _,x as h,l as S,F as Z,B as ee,s as ae,q as se,C as te,v as le,y as P}from"./index-B12n8wa1.js";import{_ as oe}from"./project-CLF1wEVU.js";const ie={class:"login-container"},ne={class:"card-content"},re={class:"form-section"},ue={class:"d-flex justify-center gap-2"},ce={class:"help-text"},de={key:1},ve={class:"signup-text"},fe={__name:"emailVerification",setup(me){const I=H(),A=q(),o=n(Array(6).fill("")),v=n(!1),V=n(!1),t=n(""),c=n(""),C=n(-1),g=n(""),i=n([]);n(new Date().getFullYear());const y=n(30);let b=null;const w=E(()=>o.value.every(a=>a!==""));E(()=>g.value||localStorage.getItem("email")||"your email");const j=E(()=>({backgroundImage:"url('/public/images/loginimage.png')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",minHeight:"100vh"}));function O(){y.value=30,clearInterval(b),b=setInterval(()=>{y.value>0?y.value-=1:clearInterval(b)},1e3)}function x(){c.value=""}async function U(){V.value=!0,t.value="",c.value="";try{await N(g.value),c.value="OTP sent successfully!",setTimeout(()=>x(),3e3),O(),o.value=Array(6).fill(""),k(()=>{i.value[0]&&i.value[0].focus()})}catch(a){t.value=(a==null?void 0:a.message)||"Failed to resend OTP. Please try again."}finally{V.value=!1}}async function N(a){if(t.value="",c.value="",!z(a)){t.value="Enter a valid email address.";return}try{if(!await P.checkEmailExists(a)){t.value="This email is not registered. Please sign up first.";return}if(await P.checkUserResignedByEmail(a)){t.value="Resigned Employee has No access. Please contact your Company Admin.";return}const f=await fetch("https://appv1.fieldseasy.com/directus/emailLogin/generate-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,userApp:"fieldeasy"})}),s=await f.json().catch(()=>({}));if(!f.ok||!(s!=null&&s.otp_session_uuid))throw new Error((s==null?void 0:s.message)||"Could not start email session. Try again.");localStorage.setItem("email",a),localStorage.setItem("emailSessionUuid",s.otp_session_uuid),I.push({name:"EmailVerification",params:{email:a}})}catch(e){throw e}}function z(a){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)}function $(a){o.value[a]=o.value[a].replace(/[^0-9]/g,""),o.value[a]&&a<5&&k(()=>{var e;(e=i.value[a+1])==null||e.focus()})}function D(a,e){a.key==="Backspace"&&!o.value[e]&&e>0&&i.value[e-1].focus(),a.key==="Enter"&&e===5&&w.value&&F()}async function F(){var a,e;if(t.value="",c.value="",v.value=!0,!w.value){t.value="Please enter all 6 digits.",v.value=!1;return}try{const r=o.value.join(""),f=localStorage.getItem("emailSessionUuid"),s=g.value;if(!f||!s){t.value="Session expired. Please go back to login.",v.value=!1;return}const u=await P.verifyEmailOtp(r,f,s);u&&u.token?(c.value="OTP verified successfully!",setTimeout(()=>{x(),localStorage.setItem("fromEmailOtp","true"),I.push({name:"PinVerification",params:{contactType:"email",contactValue:s},query:{fromEmail:!0}})},2e3)):(t.value="OTP is wrong, please enter correct OTP.",o.value=Array(6).fill(""),k(()=>{i.value[0]&&i.value[0].focus()}))}catch(r){console.error("Email OTP verification error:",r),t.value=((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||"OTP is wrong, please enter correct OTP.",o.value=Array(6).fill(""),k(()=>{i.value[0]&&i.value[0].focus()})}finally{v.value=!1}}return K(()=>{if(g.value=localStorage.getItem("email")||A.params.email,!g.value){t.value="Email not found. Please go back to login.";return}O(),k(()=>{i.value[0]&&i.value[0].focus()})}),M(()=>{clearInterval(b)}),(a,e)=>{const r=J("router-link");return m(),T(Y,{fluid:"",class:"fill-height pa-0"},{default:d(()=>[p(G,{"no-gutters":"",class:"h-100"},{default:d(()=>[p(Q,{cols:"12",class:"d-flex align-center justify-end pa-0"},{default:d(()=>[l("div",{class:"background-container d-flex align-center justify-end h-100",style:W(j.value)},[l("div",ie,[p(X,{class:"login-card",style:{border:"2px solid #059669","border-radius":"16px",overflow:"hidden","box-shadow":"0 10px 30px rgba(0, 0, 0, 0.15)"}},{default:d(()=>[e[4]||(e[4]=l("div",{class:"card-header"},[l("div",{class:"logo-section"},[l("img",{src:oe,alt:"FieldsEasy",class:"logo-image"})])],-1)),e[5]||(e[5]=l("div",{class:"card-subheader"},[l("h2",{class:"subheader-title"},"Verify Your Email")],-1)),l("div",ne,[t.value?(m(),T(R,{key:0,type:"error",variant:"tonal",density:"compact",class:"mb-4"},{default:d(()=>[_(h(t.value),1)]),_:1})):B("",!0),c.value?(m(),T(R,{key:1,type:"success",variant:"tonal",density:"compact",class:"mb-4"},{default:d(()=>[_(h(c.value),1)]),_:1})):B("",!0),l("div",re,[e[2]||(e[2]=l("label",{class:"form-label"},"Verification Code",-1)),l("div",ue,[(m(),S(Z,null,ee(6,(f,s)=>p(ae,{key:s,modelValue:o.value[s],"onUpdate:modelValue":u=>o.value[s]=u,maxlength:"1",type:"text",density:"comfortable",variant:"outlined",class:se(["otp-input-field",{filled:o.value[s]}]),onInput:u=>$(s),onKeydown:u=>D(u,s),onFocus:u=>C.value=s,onBlur:e[0]||(e[0]=u=>C.value=-1),ref_for:!0,ref_key:"otpFields",ref:i},null,8,["modelValue","onUpdate:modelValue","class","onInput","onKeydown","onFocus"])),64))]),l("div",ce,[e[1]||(e[1]=_(" Didn't receive? ")),y.value<=0?(m(),S("a",{key:0,href:"#",onClick:te(U,["prevent"]),class:"signup-link"},h(V.value?"Sending...":"Resend OTP"),1)):(m(),S("span",de,"Resend in "+h(y.value)+"s",1))])]),p(le,{onClick:F,disabled:v.value||!w.value,loading:v.value,block:"",size:"large",class:"submit-btn"},{default:d(()=>[_(h(v.value?"Verifying...":"Verify Code"),1)]),_:1},8,["disabled","loading"]),l("p",ve,[p(r,{to:"/login",class:"signup-link"},{default:d(()=>e[3]||(e[3]=[_("Back to Login")])),_:1})])])]),_:1}),e[6]||(e[6]=l("p",{class:"footer-text"},"Â© 2025 Fieldseasy",-1))])],4)]),_:1})]),_:1})]),_:1})}}},ye=L(fe,[["__scopeId","data-v-e41ce917"]]);export{ye as default};
