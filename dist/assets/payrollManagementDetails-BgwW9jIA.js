import{an as ce,ab as oe,ao as et,ah as tt,ap as j,ai as K,_ as We,a as z,w as o,X as $,e as D,f as d,j as Y,k as _,$ as H,p as y,H as O,x as c,a1 as J,i,a6 as Ge,al as W,a0 as G,v as V,Q as at,O as st,Z as nt,P as rt,T as it,W as lt,S as ot,l as v,d as Q,q as he,K as ue,aq as dt,ar as ct,y as de,as as ht,at as ut,au as pt,C as ft,U as te,av as Je,F as R,B as Z}from"./index-B12n8wa1.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=ce("BadgeCheckIcon",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=ce("CheckCheckIcon",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ce("FileSpreadsheetIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=ce("Undo2Icon",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]),Ke=100,Pt="0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef";function wt(t){if(!t||typeof t!="string")return!1;const e=t.split(":");if(e.length!==2)return!1;const s=/^[0-9a-fA-F]+$/;return s.test(e[0])&&s.test(e[1])}function pe(t){try{if(!t||typeof t!="string")return t||"";if(!wt(t))return t;const e=t.split(":"),s=e[0],l=e[1],a=K.enc.Hex.parse(s),n=K.enc.Hex.parse(Pt),h=K.enc.Hex.parse(l),g=K.lib.CipherParams.create({ciphertext:h});return K.AES.decrypt(g,n,{iv:a,mode:K.mode.CBC,padding:K.pad.Pkcs7}).toString(K.enc.Utf8)}catch(e){return console.error("Decryption failed:",e),t}}async function bt(t,e,s,l,a={}){var n,h,g,f;try{a.onProgress&&a.onProgress({current:0,total:t.length,percentage:5,message:"Starting download..."});const p=a.startDate||`${s}-${e.toString().padStart(2,"0")}-01`,w=new Date(s,e,0).getDate(),U=a.endDate||`${s}-${e.toString().padStart(2,"0")}-${w}`,b=t.map(u=>u.employee.id);a.onProgress&&a.onProgress({current:0,total:t.length,percentage:10,message:"Fetching employee details..."});const k=await vt(b,l,a.cancelToken);a.onProgress&&a.onProgress({current:0,total:t.length,percentage:30,message:"Fetching verification data..."});const r=await kt(b,e,s,l,a.cancelToken,p,U);a.onProgress&&a.onProgress({current:0,total:t.length,percentage:60,message:"Processing data..."});const P=t.map((u,m)=>{const T=u.employee.id;return a.onProgress&&m%5===0&&a.onProgress({current:m+1,total:t.length,percentage:60+Math.round((m+1)/t.length*30),message:`Processing employee ${m+1} of ${t.length}...`}),{...u,employeeDetails:k[T]||{},verificationData:r[T]||{}}});a.onProgress&&a.onProgress({current:t.length,total:t.length,percentage:95,message:"Generating Excel file..."});const I=new Set,C=new Set,B=new Set,M=new Set;P.forEach(u=>{var m,T,X,se,ne,re;Object.keys(((m=u.verificationData)==null?void 0:m.earnings)||{}).forEach(N=>I.add(`Earning: ${N}`)),Object.keys(((T=u.verificationData)==null?void 0:T.deductions)||{}).forEach(N=>C.add(`Deduction: ${N}`)),Object.keys(((X=u.verificationData)==null?void 0:X.penalties)||{}).forEach(N=>B.add(`Penalty: ${N}`)),Object.keys(((se=u.verificationData)==null?void 0:se.benefits)||{}).forEach(N=>M.add(`Benefit: ${N}`)),Object.entries(((ne=u.verificationData)==null?void 0:ne.individualDeduction)||{}).forEach(([N,x])=>{if(typeof x=="object"&&x!==null){const ie=x[Object.keys(x)[0]];C.add(`Individual Deduction: ${N}`)}else C.add(`Individual Deduction: ${N}`)}),Object.entries(((re=u.verificationData)==null?void 0:re.salaryArrears)||{}).forEach(([N,x])=>{if(typeof x=="object"&&x!==null){const ie=Object.keys(x)[0];C.add(`Salary Arrear: ${ie}`)}else C.add(`Salary Arrear: ${N}`)})});const q=["Employee ID","Employee Name","Gender","Department","Branch","State","Designation","Role","Attendance Status","Salary Status","PAN","UAN","Bank Name","IFSC","Account Number","UPI","PF Account","ESI Account","Total Payable Days","Monthly CTC",...Array.from(I),"Total Earnings",...Array.from(M),"Total Benefits",...Array.from(C),"Total Deductions","Net Salary",...Array.from(B),"Paid Amount","Pending Amount","startDate","endDate","finalizeDate"],L=P.map(u=>{var se,ne,re,N,x,ie,fe,ye,ge,me,De,Pe,we,be,ve,ke,Ue,Se,Ce,_e,Fe,Ie,Ae,Ee,Ne,Ve,Re,Te,ze,xe,Be,Me,Oe,je,qe,Le,$e,Ye;const m={};m["Employee ID"]=((se=u.employeeDetails)==null?void 0:se.employeeId)||"",m["Employee Name"]=((re=(ne=u.employee)==null?void 0:ne.assignedUser)==null?void 0:re.first_name)||"",m.Designation=((N=u.employeeDetails)==null?void 0:N.designation)||"",m.Gender=((x=u.employeeDetails)==null?void 0:x.Gender)||"",m.PAN=pe(((ie=u.employeeDetails)==null?void 0:ie.pan)||""),m.UAN=pe(((fe=u.employeeDetails)==null?void 0:fe.UAN)||""),m["Bank Name"]=((ye=u.employeeDetails)==null?void 0:ye.bankName)||"",m.IFSC=pe(((ge=u.employeeDetails)==null?void 0:ge.IFSC)||""),m["Account Number"]=((me=u.employeeDetails)==null?void 0:me.accountNumber)||"",m.UPI=((De=u.employeeDetails)==null?void 0:De.UPI)||"",m["PF Account"]=((Pe=u.employeeDetails)==null?void 0:Pe.PFAccountNumber)||"",m["ESI Account"]=((we=u.employeeDetails)==null?void 0:we.ESIAccountNumber)||"",m.Department=((be=u.employeeDetails)==null?void 0:be.department)||"",m.Branch=((ve=u.employeeDetails)==null?void 0:ve.branch)||"",m.State=((ke=u.employeeDetails)==null?void 0:ke.state)||"",m.Role=((Ce=(Se=(Ue=u.employee)==null?void 0:Ue.assignedUser)==null?void 0:Se.role)==null?void 0:Ce.name)||"",m["Attendance Status"]=(_e=u.verificationData)!=null&&_e.attendaceVerification?"Verified":"Unverified",m["Salary Status"]=(Fe=u.verificationData)!=null&&Fe.salaryVerification?"Verified":"Unverified";const T=(Ie=u.verificationData)==null?void 0:Ie.totalAttendanceCount;if(T)try{const F=typeof T=="string"?JSON.parse(T):T;m["Total Payable Days"]=F.totalPayableDays||0}catch{m["Total Payable Days"]=0}m["Monthly CTC"]=(Ae=u.verificationData)!=null&&Ae.ctc?Math.round(Number.parseFloat(u.verificationData.ctc)):0,m["Net Salary"]=(Ee=u.verificationData)!=null&&Ee.netSalary?Math.round(Number.parseFloat(u.verificationData.netSalary)):0,m["PF Account"]=((Ne=u.employeeDetails)==null?void 0:Ne.PFAccountNumber)||"",m["ESI Account"]=((Ve=u.employeeDetails)==null?void 0:Ve.ESIAccountNumber)||"",Object.entries(((Re=u.verificationData)==null?void 0:Re.earnings)||{}).forEach(([F,S])=>m[`Earning: ${F}`]=S?Math.round(Number.parseFloat(S)):0),m["Total Earnings"]=(Te=u.verificationData)!=null&&Te.totalEarnings?Math.round(Number.parseFloat(u.verificationData.totalEarnings)):0,m["Total Benefits"]=(ze=u.verificationData)!=null&&ze.totalBenefits?Math.round(Number.parseFloat(u.verificationData.totalBenefits)):0,Object.entries(((xe=u.verificationData)==null?void 0:xe.deductions)||{}).forEach(([F,S])=>m[`Deduction: ${F}`]=S?Math.round(Number.parseFloat(S)):0),Object.entries(((Be=u.verificationData)==null?void 0:Be.individualDeduction)||{}).forEach(([F,S])=>{if(typeof S=="object"&&S!==null){const le=S[Object.keys(S)[0]];m[`Individual Deduction: ${F}`]=le?Math.round(Number.parseFloat(le)):0}else m[`Individual Deduction: ${F}`]=S?Math.round(Number.parseFloat(S)):0}),Object.entries(((Me=u.verificationData)==null?void 0:Me.salaryArrears)||{}).forEach(([F,S])=>{if(typeof S=="object"&&S!==null){const le=Object.keys(S)[0],He=S[le];m[`Salary Arrear: ${le}`]=He?Math.round(Number.parseFloat(He)):0}else m[`Salary Arrear: ${F}`]=S?Math.round(Number.parseFloat(S)):0}),m["Total Deductions"]=(Oe=u.verificationData)!=null&&Oe.totalOtherDeduction?Math.round(Number.parseFloat(u.verificationData.totalOtherDeduction)):0,Object.entries(((je=u.verificationData)==null?void 0:je.penalties)||{}).forEach(([F,S])=>m[`Penalty: ${F}`]=S?Math.round(Number.parseFloat(S)):0),Object.entries(((qe=u.verificationData)==null?void 0:qe.benefits)||{}).forEach(([F,S])=>m[`Benefit: ${F}`]=S?Math.round(Number.parseFloat(S)):0),m["Paid Amount"]=u.salaryPaid?Math.round(Number.parseFloat(u.salaryPaid)):0,m["Pending Amount"]=u.salaryPending?Math.round(Number.parseFloat(u.salaryPending)):0,m.startDate=((Le=u.verificationData)==null?void 0:Le.startDate)||"",m.endDate=(($e=u.verificationData)==null?void 0:$e.endDate)||"",m.finalizeDate=((Ye=u.verificationData)==null?void 0:Ye.finalizeDate)||"";const X={};return q.forEach(F=>{X[F]=m[F]??""}),X}),E=[];a.startDate&&a.endDate&&E.push({"Filter Type":"Date Range","Filter Value":`${a.startDate} to ${a.endDate}`}),(n=a.filters)!=null&&n.branch&&a.filters.branch.length>0&&E.push({"Filter Type":"Branch","Filter Value":a.filters.branch.join(", ")}),(h=a.filters)!=null&&h.department&&a.filters.department.length>0&&E.push({"Filter Type":"Department","Filter Value":a.filters.department.join(", ")}),((g=a.filters)==null?void 0:g.attendanceVerification)!==null&&E.push({"Filter Type":"Attendance Verification","Filter Value":a.filters.attendanceVerification?"Verified":"Unverified"}),((f=a.filters)==null?void 0:f.salaryVerification)!==null&&E.push({"Filter Type":"Salary Verification","Filter Value":a.filters.salaryVerification?"Verified":"Unverified"});const A=oe.book_new(),ee=oe.json_to_sheet(L),ae=[];if(L.forEach(u=>{Object.keys(u).forEach((m,T)=>{const X=String(u[m]||"");ae[T]=Math.max(ae[T]||0,m.length,X.length)})}),ee["!cols"]=ae.map(u=>({width:Math.min(u+2,50)})),oe.book_append_sheet(A,ee,"Salary Sheet"),E.length>0){const u=oe.json_to_sheet(E);oe.book_append_sheet(A,u,"Applied Filters")}const Ze=et(A,{bookType:"xlsx",type:"array"}),Xe=new Blob([Ze],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});tt.saveAs(Xe,`salary-sheet-${e}-${s}.xlsx`),a.onProgress&&a.onProgress({current:t.length,total:t.length,percentage:100,message:"Download complete!"})}catch(p){throw console.error("Error generating salary sheet:",p),p}}function Qe(t,e){const s=[];for(let l=0;l<t.length;l+=e)s.push(t.slice(l,l+e));return s}async function vt(t,e,s){try{if(!t||t.length===0)return{};const l={},a=Qe(t,Ke);for(let n=0;n<a.length;n++){const g=a[n].join(","),f=await j.get("https://appv1.fieldseasy.com/directus/items/personalModule",{params:{"filter[id][_in]":g,fields:["id","employeeId","assignedUser.first_name","assignedUser.pan","assignedUser.UAN","assignedUser.PFAccountNumber","assignedUser.ESIAccountNumber","branchLocation.locdetail.locationName","branchLocation.state","department.departmentName","assignedUser.gender","assignedUser.bankName","assignedUser.IFSC","assignedUser.accountNumber","assignedUser.UPI","assignedUser.designation"],limit:-1},headers:{Authorization:`Bearer ${e}`},cancelToken:s});f.data&&f.data.data&&f.data.data.forEach(p=>{var w,U,b,k,r,P,I,C,B,M,q,L,E,A;l[p.id]={designation:((w=p.assignedUser)==null?void 0:w.designation)||"",pan:((U=p.assignedUser)==null?void 0:U.pan)||"",UAN:((b=p.assignedUser)==null?void 0:b.UAN)||"",Gender:((k=p.assignedUser)==null?void 0:k.gender)||"",PFAccountNumber:((r=p.assignedUser)==null?void 0:r.PFAccountNumber)||"",ESIAccountNumber:((P=p.assignedUser)==null?void 0:P.ESIAccountNumber)||"",department:((I=p.department)==null?void 0:I.departmentName)||"",branch:((B=(C=p.branchLocation)==null?void 0:C.locdetail)==null?void 0:B.locationName)||"",state:((M=p.branchLocation)==null?void 0:M.state)||"",employeeId:p.employeeId||"",bankName:((q=p.assignedUser)==null?void 0:q.bankName)||"",IFSC:((L=p.assignedUser)==null?void 0:L.IFSC)||"",accountNumber:((E=p.assignedUser)==null?void 0:E.accountNumber)||"",UPI:((A=p.assignedUser)==null?void 0:A.UPI)||""}})}return l}catch(l){return console.error("Error fetching employee details in batch:",l),{}}}async function kt(t,e,s,l,a,n,h){try{if(!t||t.length===0)return{};const g={},f=Qe(t,Ke);for(let p=0;p<f.length;p++){const b={"filter[employee][id][_in]":f[p].join(","),fields:["id","employee.id","attendaceVerification","salaryVerification","ctc","payableDays","netSalary","earnings","deductions","penalties","benefits","startDate","endDate","totalAttendanceCount","individualDeduction","salaryArrears","totalEarnings","totalBenefits","totalOtherDeduction","finalizeDate"],limit:-1};n&&h?(b["filter[startDate][_between][0]"]=n,b["filter[startDate][_between][1]"]=h):(b["filter[month(endDate)][_eq]"]=e,b["filter[year(endDate)][_eq]"]=s);const k=await j.get("https://appv1.fieldseasy.com/directus/items/payrollVerification",{params:b,headers:{Authorization:`Bearer ${l}`},cancelToken:a});k.data&&k.data.data&&k.data.data.forEach(r=>{r.employee&&r.employee.id&&(g[r.employee.id]=r)})}return g}catch(g){return console.error("Error fetching verification data in batch:",g),{}}}const Ut={props:{show:{type:Boolean,default:!1},progress:{type:Number,default:0},title:{type:String,default:"Downloading Salary Sheet"},fileName:{type:String,default:"salary-sheet.xlsx"},fileSize:{type:Number,default:0},showCancel:{type:Boolean,default:!0}},emits:["update:show","cancel"],computed:{statusText(){return this.progress<100?"Downloading...":"Download Complete!"},formattedSize(){if(!this.fileSize)return"";const t=["B","KB","MB","GB"];let e=this.fileSize,s=0;for(;e>=1024&&s<t.length-1;)e/=1024,s++;return`${e.toFixed(1)} ${t[s]}`}},watch:{progress(t){t>=100&&setTimeout(()=>{this.$emit("update:show",!1)},1500)}}},St={class:"text-center mb-4"},Ct={class:"progress-status"},_t={class:"progress-percentage"},Ft={class:"d-flex justify-space-between mt-2"},It={class:"text-caption text-grey"},At={class:"text-caption text-grey"};function Et(t,e,s,l,a,n){return D(),z($,{"model-value":s.show,"onUpdate:modelValue":e[1]||(e[1]=h=>t.$emit("update:show",h)),persistent:"","max-width":"400","content-class":"download-progress-dialog"},{default:o(()=>[d(Y,null,{default:o(()=>[d(H,{class:"headline d-flex align-center"},{default:o(()=>[d(O,{color:"primary",size:"24",class:"mr-2"},{default:o(()=>e[2]||(e[2]=[y("mdi-file-download")])),_:1}),y(" "+c(s.title),1)]),_:1}),d(J,null,{default:o(()=>[i("div",St,[i("div",Ct,c(n.statusText),1),i("div",_t,c(s.progress)+"%",1)]),d(Ge,{"model-value":s.progress,color:"primary",height:"10",rounded:"",striped:"",active:s.progress<100,class:"progress-bar"},null,8,["model-value","active"]),i("div",Ft,[i("span",It,c(s.fileName),1),i("span",At,c(n.formattedSize),1)])]),_:1}),s.showCancel?(D(),z(W,{key:0},{default:o(()=>[d(G),d(V,{color:"grey",text:"",onClick:e[0]||(e[0]=h=>t.$emit("cancel"))},{default:o(()=>e[3]||(e[3]=[y("Cancel")])),_:1})]),_:1})):_("",!0)]),_:1})]),_:1},8,["model-value"])}const Nt=We(Ut,[["render",Et],["__scopeId","data-v-3551181d"]]),Vt={components:{SkeletonLoading:ot,CustomPagination:lt,DownloadProgressDialog:Nt,DataTable:it,DataTableWrapper:rt,BaseButton:nt,PayrollFilters:st,ErrorState:at},name:"PayrollManagement",data(){const t=new Date;return{Undo2:Dt,CheckCheck:gt,RefreshCw:ut,BadgeCheck:yt,FileSpreadsheet:mt,sortBy:"",sortDirection:"asc",showVerification:!1,showAttendancePopup:!1,confirmDialog:!1,userRole:null,userId:null,tenantId:null,tenantName:"",tenantAddress:"",companyLogo:"",page:1,error:null,itemsPerPage:25,totalItems:0,selectedEmployee:null,tableOptions:{},selected:[],search:"",searchTimeout:null,token:de.getToken(),showForm:!1,isEditing:!1,editedItem:null,items:[],payrollCounts:{paid:0,unpaid:0,finalized:0,unfinalized:0},loading:!1,showFilters:!0,downloadingPayslips:!1,selectedStatus:"all",attendanceData:{},salaryData:{},showDownloadProgress:!1,downloadProgress:0,downloadTitle:"Downloading Salary Sheet",downloadFileName:"salary-sheet.xlsx",downloadFileSize:2048e3,downloadCancelToken:null,showPayslipPreview:!1,currentPayslipData:null,generatingPdf:!1,cycleStartDate:null,cycleEndDate:null,cycleDays:0,attendanceDetails:{},showPaidConfirmation:!1,showNoUsersToMarkPaid:!1,showPaidUsersWarning:!1,markingAsPaidInProgress:!1,finalizedUnpaidUsers:[],paidUsersCount:0,processingUnfinalized:!1,unfinalizedUsers:[],showUnfinalizedDialog:!1,batchSize:100,currentBatch:0,totalBatches:0,processingBatch:!1,showPaidUserSelectedDialog:!1,showMixedPaidUsersDialog:!1,unpaidUsersCount:0,verificationFilters:{attendance:null,salary:null,salaryPaid:null},activeFilters:{branch:null,department:null,activity:[],cycleType:null},dateRange:{start:null,end:null},selectedMonth:t.getMonth(),selectedYear:t.getFullYear(),multiAttendanceCycles:[],cycleTypeOptions:[],pageFilters:[{key:"monthYear",label:"Month & Year",type:"month",show:!0},{key:"branch",label:"Branch",type:"select",show:!0},{key:"department",label:"Department",type:"select",show:!0},{key:"attendanceCycle",label:"Attendance Cycle",type:"select",show:!0}]}},computed:{initialFilters(){var t;return{branch:this.activeFilters.branch,department:this.activeFilters.department,activity:this.activeFilters.activity,attendanceCycle:(t=this.activeFilters.cycleType)==null?void 0:t.toString(),monthYear:`${this.selectedYear}-${String(this.selectedMonth+1).padStart(2,"0")}`}},headers(){return[{title:"EmpId",key:"employee.employeeId",width:"150px"},{title:"Name",key:"employee.assignedUser.first_name",width:"150px"},{title:"Role",key:"employee.assignedUser.role.name",width:"150px"},{title:"Designation",key:"employee.assignedUser.designation",width:"150px"},{title:"Attendance Verification",key:"attendanceVerification",width:"180px"},{title:"Salary Verification",key:"salaryVerification",width:"180px"},{title:"Monthly CTC",key:"monthlyCTC",width:"120px"},{title:"Payable Days",key:"payableDays",width:"120px"},{title:"Salary Status",key:"salaryPaid",width:"120px"},{title:"Start Date",key:"startDate",width:"120px"},{title:"End Date",key:"endDate",width:"120px"}]},columns(){return this.headers.map(t=>({key:t.key,label:t.title,width:t.width,sortable:!0}))},selectedIds(){return this.selected.map(t=>t.id||t)},hasDownloadableSelected(){return!this.selected||this.selected.length===0?!1:this.items.filter(e=>this.selected.some(s=>(s.id||s)===e.id)).some(e=>e.attendanceVerified&&e.salaryVerified)},hasFinalizedUnpaidUsers(){return this.items.some(t=>t.salaryVerified&&t.salaryPaid!=="paid")},hasPaidUsersSelected(){return!this.selected||this.selected.length===0?!1:this.items.filter(e=>this.selected.some(s=>(s.id||s)===e.id)).some(e=>e.salaryPaid==="paid")},paidUsersSelectedCount(){return!this.selected||this.selected.length===0?0:this.items.filter(e=>this.selected.some(s=>(s.id||s)===e.id)).filter(e=>e.salaryPaid==="paid").length},successCount(){return this.processedCount-this.failedCount},hasActiveFilters(){return this.activeFilters.branch!==null||this.activeFilters.department!==null||this.activeFilters.activity.length>0||this.activeFilters.cycleType!==null||this.dateRange.start&&this.dateRange.end||this.verificationFilters.attendance!==null||this.verificationFilters.salary!==null||this.verificationFilters.salaryPaid!==null}},watch:{selected:{handler(t,e){console.log("Selected changed:",{newCount:t.length,oldCount:(e==null?void 0:e.length)||0,newItems:t.map(s=>s.id||s),oldItems:(e==null?void 0:e.map(s=>s.id||s))||[]})},deep:!0,immediate:!0},selectedStatus(t){this.page=1,this.fetchItems()},verificationFilters:{handler(){this.handleFilterChange()},deep:!0},selectedMonth(t){this.handleMonthChange()},selectedYear(){this.handleMonthChange()}},methods:{async fetchItems(){this.userRole=ue.getRole(),this.userId=ue.getUserId(),this.loading=!0,this.clearSelections();const t=["id","employee.id","employee.employeeId","employee.assignedUser.first_name","employee.assignedUser.role.name","employee.approver.id","employee.assignedUser.dateOfJoining","employee.assignedUser.dateOfLeaving","employee.config.configName","employee.assignedUser.pan","employee.assignedUser.UAN","employee.assignedUser.PFAccountNumber","employee.assignedUser.ESIAccountNumber","employee.assignedUser.designation","employee.branch.branchName","employee.department.departmentName","tenant.tenantName","tenant.logo","tenant.companyAddress","status","ctc","employee.cycleType","salaryTracking"];try{const e=new URL("https://appv1.fieldseasy.com/directus/items/SalaryBreakdown");this.verificationFilters.attendance!==null||this.verificationFilters.salary!==null?e.searchParams.append("limit","-1"):(e.searchParams.append("limit",this.itemsPerPage.toString()),e.searchParams.append("page",this.page.toString())),e.searchParams.append("filter[_and][0][_and][0][employee][assignedUser][tenant][tenantId][_eq]",this.tenantId),this.userRole==="Manager"&&(e.searchParams.append("filter[_and][1][_or][0][employee][approver][id][_eq]",this.userId),e.searchParams.append("filter[_and][1][_or][1][employee][assignedUser][id][_eq]",this.userId)),this.search&&this.search.trim()!==""&&e.searchParams.append("filter[_and][0][_and][0][employee][assignedUser][first_name][_icontains]",this.search.trim()),this.activeFilters.branch&&e.searchParams.append("filter[_and][0][_and][0][employee][branch][id][_eq]",this.activeFilters.branch),this.activeFilters.department&&e.searchParams.append("filter[_and][0][_and][0][employee][department][id][_eq]",this.activeFilters.department),this.activeFilters.cycleType&&e.searchParams.append("filter[_and][0][_and][0][employee][cycleType][_eq]",this.activeFilters.cycleType.toString()),this.dateRange.start&&this.dateRange.end&&(e.searchParams.append("filter[_and][0][_and][2][_or][0][employee][assignedUser][dateOfJoining][_lte]",this.dateRange.end),e.searchParams.append("filter[_and][0][_and][2][_or][1][employee][assignedUser][dateOfJoining][_null]",!0),e.searchParams.append("filter[_and][0][_and][3][_or][0][employee][assignedUser][dateOfLeaving][_gte]",this.dateRange.start),e.searchParams.append("filter[_and][0][_and][3][_or][1][employee][assignedUser][dateOfLeaving][_null]",!0)),t.forEach(f=>{e.searchParams.append("fields[]",f)});const s=await fetch(e,{method:"GET",headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const l=await s.json();if(!l.data||l.data.length===0){this.items=[],this.loading=!1;return}const a=l.data.map(f=>f.employee.id),n=await this.checkVerificationStatus(a);let g=l.data.map(f=>{const p=f.employee.id,w=n[p]||{attendanceVerified:!1,salaryVerified:!1,ctc:"-",payableDays:"-",startDate:null,endDate:null,salaryPaid:"unPaid"},U=f.employee.assignedUser.dateOfJoining,b=f.employee.assignedUser.dateOfLeaving,k=this.calculateActivityStatus(U,b,this.dateRange.start,this.dateRange.end);if(this.activeFilters.activity.length>0&&!this.activeFilters.activity.includes(k))return null;const r=this.verificationFilters.attendance===null||w.attendanceVerified===this.verificationFilters.attendance,P=this.verificationFilters.salary===null||w.salaryVerified===this.verificationFilters.salary,I=this.verificationFilters.salaryPaid===null||w.salaryPaid===this.verificationFilters.salaryPaid;return r&&P&&I?{...f,attendanceVerified:w.attendanceVerified,salaryVerified:w.salaryVerified,ctc:w.ctc,payableDays:w.payableDays,monthlyCTC:(()=>{if(!f.salaryTracking)return"-";const C=this.dateRange.end;if(!C)return"-";const B=new Date(C).toLocaleDateString("en-GB",{month:"2-digit",year:"numeric"}).replace("/","/"),M=Object.keys(f.salaryTracking);if(M.length===0)return"-";if(f.salaryTracking[B])return f.salaryTracking[B];const q=M.map(A=>{const[ee,ae]=A.split("/").map(Number);return{key:A,date:new Date(ae,ee-1)}}).sort((A,ee)=>A.date-ee.date),L=new Date(C);let E="-";for(const A of q)A.date<=L&&(E=f.salaryTracking[A.key]);return E})(),downloadablePdf:w.downloadablePdf,startDate:w.startDate,endDate:w.endDate,salaryPaid:w.salaryPaid,joiningDate:U,leavingDate:b,activity:k}:null}).filter(f=>f!==null);if(this.verificationFilters.attendance!==null||this.verificationFilters.salary!==null){const f=(this.page-1)*this.itemsPerPage,p=f+this.itemsPerPage;this.totalItems=g.length,g=g.slice(f,p)}this.items=g,this.selected=this.selected.filter(f=>{const p=f.id||f;return this.items.some(w=>w.id===p)})}catch(e){console.error("Error fetching salary breakdown:",e),this.items=[]}finally{this.loading=!1}},async aggregateCount(){var e,s,l;const t=de.getToken();try{if(!t||!this.tenantId)throw new Error("Authentication required or tenant not found");const a=new URL("https://appv1.fieldseasy.com/directus/items/SalaryBreakdown");a.searchParams.append("aggregate[count]","id"),a.searchParams.append("fields[]","employee.id"),a.searchParams.append("filter[_and][0][_and][0][employee][assignedUser][tenant][tenantId][_eq]",this.tenantId),this.activeFilters.cycleType&&a.searchParams.append("filter[_and][0][_and][0][employee][cycleType][_eq]",this.activeFilters.cycleType.toString()),a.searchParams.append("filter[_and][0][_and][0][employee][status][_neq]","archived"),this.search&&this.search.trim()!==""&&a.searchParams.append("filter[_and][0][_and][0][employee][assignedUser][first_name][_icontains]",this.search.trim()),this.activeFilters.branch&&a.searchParams.append("filter[_and][0][_and][0][employee][branch][id][_eq]",this.activeFilters.branch),this.activeFilters.department&&a.searchParams.append("filter[_and][0][_and][0][employee][department][id][_eq]",this.activeFilters.department),this.dateRange.start&&this.dateRange.end&&(a.searchParams.append("filter[_and][0][_and][2][_or][0][employee][assignedUser][dateOfJoining][_lte]",this.dateRange.end),a.searchParams.append("filter[_and][0][_and][2][_or][1][employee][assignedUser][dateOfJoining][_null]",!0),a.searchParams.append("filter[_and][0][_and][3][_or][0][employee][assignedUser][dateOfLeaving][_gte]",this.dateRange.start),a.searchParams.append("filter[_and][0][_and][3][_or][1][employee][assignedUser][dateOfLeaving][_null]",!0));const n=await fetch(a,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const h=await n.json();let g=((l=(s=(e=h==null?void 0:h.data)==null?void 0:e[0])==null?void 0:s.count)==null?void 0:l.id)||0;this.totalItems=g,await this.PayrollVerificationCount()}catch(a){console.error("Error fetching aggregate count:",a)}},async PayrollVerificationCount(){const t=de.getToken();try{if(!t||!this.tenantId)throw new Error("Authentication required or tenant not found");if(!this.dateRange.start||!this.dateRange.end){const[h,g]=this.initialFilters.monthYear.split("-").map(Number);this.dateRange.start=`${h}-${String(g).padStart(2,"0")}-01`,this.dateRange.end=`${h}-${String(g).padStart(2,"0")}-${new Date(h,g,0).getDate()}`}const s=`https://appv1.fieldseasy.com/directus/items/payrollVerification?${["aggregate[count]=id","groupBy[]=salaryPaid","groupBy[]=salaryVerification",`filter[_and][0][employee][assignedUser][tenant][tenantId][_eq]=${this.tenantId}`,`filter[_and][1][startDate][_eq]=${this.dateRange.start}`,`filter[_and][2][endDate][_eq]=${this.dateRange.end}`,`filter[_and][3][employee][cycleType][_eq]=${this.activeFilters.cycleType||1}`,"filter[_and][4][status][_neq]=archived","limit=-1"].join("&")}`,l=await fetch(s,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const a=await l.json(),n={paid:0,unpaid:0,finalized:0,unfinalized:0};((a==null?void 0:a.data)||[]).forEach(h=>{h.salaryPaid==="paid"&&(n.paid=h.count.id),h.salaryVerification===!0&&(n.finalized=h.count.id)}),n.unpaid=this.totalItems-n.paid,n.unfinalized=this.totalItems-n.finalized,this.payrollCounts=n}catch(e){console.error("Error fetching payroll verification counts:",e)}},async calculateAttendanceCycleDates(t,e){var s;try{const l=this.tenantId,a=this.token,h=((s=(await j.get(`https://appv1.fieldseasy.com/directus/items/attendanceCycle?filter[_and][0][tenant][tenantId][_eq]=${l}`,{params:{fields:["id","status","startDate","endDate","fixedCycle","includeWeekoffs","includeHolidays","startMonth","endMonth"]},headers:{Authorization:`Bearer ${a}`}})).data)==null?void 0:s.data[0])??{};let g,f;if(h.fixedCycle){const b=`${e}-${String(t).padStart(2,"0")}-01`,k=new Date(e,t,0),r=`${e}-${String(t).padStart(2,"0")}-${String(k.getDate()).padStart(2,"0")}`;this.dateRange.start=b,this.dateRange.end=r}else{const b=t===1?12:t-1,k=t===1?e-1:e,r=b===1?12:b-1,P=b===1?k-1:k,I=parseInt(h.startDate)||21,C=parseInt(h.endDate)||20;g=`${P}-${String(r+1).padStart(2,"0")}-${String(I).padStart(2,"0")}`,f=`${k}-${String(b+1).padStart(2,"0")}-${String(C).padStart(2,"0")}`,this.dateRange.start=g,this.dateRange.end=f}const p=new Date(this.dateRange.start),w=new Date(this.dateRange.end),U=Math.abs(w-p);return this.cycleDays=Math.ceil(U/(1e3*60*60*24))+1,{cycleStartDate:this.dateRange.start,cycleEndDate:this.dateRange.end,cycleDays:this.cycleDays,includeWeekoffs:h.includeWeekoffs||!1,includeHolidays:h.includeHolidays||!1}}catch(l){console.error("Error calculating attendance cycle dates:",l);const a=`${e}-${String(t).padStart(2,"0")}-01`,n=new Date(e,t,0),h=`${e}-${String(t).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`;return this.dateRange.start=a,this.dateRange.end=h,console.warn("Using fallback dates:",{startDate:a,endDateFormatted:h}),{cycleStartDate:this.dateRange.start,cycleEndDate:this.dateRange.end,cycleDays:0,includeWeekoffs:!1,includeHolidays:!1}}},async handleApplyFilters(t){if(t.monthYear){const[e,s]=t.monthYear.split("-").map(Number);this.selectedYear=e,this.selectedMonth=s-1}else{const e=new Date;this.selectedYear=e.getFullYear(),this.selectedMonth=e.getMonth()}this.activeFilters={branch:t.branch||null,department:t.department||null,activity:Array.isArray(t.activity)?t.activity:t.activity?[t.activity]:[],cycleType:t.attendanceCycle?parseInt(t.attendanceCycle):null},t.cycleStartDate&&t.cycleEndDate?(this.dateRange.start=t.cycleStartDate,this.dateRange.end=t.cycleEndDate):await this.calculateAttendanceCycleDates(this.selectedMonth+1,this.selectedYear),this.page=1,await this.aggregateCount(),await this.fetchItems(),await this.PayrollVerificationCount()},async openAttendancePopup(){this.showAttendancePopup=!0,this.cancelProcessing=!1,this.attendanceStatus=[]},cancel(){this.cancelProcessing=!0,alert("Attendance processing has been stopped.")},close(){this.cancelProcessing=!0,this.showAttendancePopup=!1},async recalculateAttendance(){if(!this.selected||this.selected.length===0){this.$emit("show-snackbar",{message:"Please select at least one employee",color:"warning"});return}this.showAttendancePopup=!0,this.processedCount=0,this.failedCount=0;try{this.isProcessing=!0;const t=100,e=this.selected.map(s=>s.employee.id);this.totalCount=e.length;for(let s=0;s<e.length&&!this.cancelProcessing;s+=t){const l=e.slice(s,s+t),a={tenantId:this.tenantId,startDate:this.dateRange.start,endDate:this.dateRange.end,employeeIds:l};try{const n=await j.post("https://appv1.fieldseasy.com/directus/reCalulate-Attendance/re-attendance",a,{headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"}});this.processedCount+=l.length}catch(n){console.error("Batch processing error:",n),this.failedCount+=l.length,this.processedCount+=l.length,this.$emit("show-snackbar",{message:`Error processing batch: ${n.message}`,color:"error"})}}this.cancelProcessing||(this.isProcessing=!1)}catch(t){console.error("Error processing attendance:",t),this.$emit("show-snackbar",{message:`Error processing attendance: ${t.message}`,color:"error"})}finally{this.showAttendancePopup=!1,this.isProcessing=!1}},async confirmDeleteExisting(){this.confirmDialog=!1;try{const t=this.attendanceRecords.map(e=>e.id);if(t.length>0){const e=await fetch("https://appv1.fieldseasy.com/directus/items/attendance",{method:"DELETE",headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`Failed to delete attendance: ${e.statusText}`);this.attendanceRecords=[],this.existingEmployees=[],alert("Attendance records deleted successfully.")}else alert("No attendance records selected to delete.")}catch(t){console.error("Error deleting attendance records:",t),alert("Error deleting attendance records. Please try again.")}},isItemSelected(t){const e=t.id||t;return this.selected.some(s=>(s.id||s)===e)},handleCheckboxChange(t,e){if(e)this.isItemSelected(t)||this.selected.push(t);else{const s=t.id||t;this.selected=this.selected.filter(l=>(l.id||l)!==s)}this.$forceUpdate()},clearSelections(){this.selected=[]},isItemSelectable(t){return!(t.activity==="New Joining"||t.activity==="left")},getRowProps(t){return{class:this.isItemSelectable(t.item)?"":"disabled-row"}},getActivityColor(t){switch(t){case"New Joining":return"success";case"left":return"error";case"Active":return"primary";default:return"grey"}},calculateActivityStatus(t,e,s,l){const a=new Date,n=a.getMonth(),h=a.getFullYear(),g=new Date(s),f=new Date(l);if(t){const p=new Date(t),w=p.getMonth(),U=p.getFullYear();if(w===n&&U===h&&f<new Date(h,n,1))return"New Joining"}if(e){const p=new Date(e),w=p.getMonth(),U=p.getFullYear();if(w===n&&U===h&&g>new Date(h,n+1,0)||p<g)return"left"}return"Active"},async markAsUnpaid(){if(!this.selected||this.selected.length===0){this.$emit("show-snackbar",{message:"Please select at least one employee",color:"warning"});return}try{const t=this.items.filter(a=>this.selected.some(n=>(n.id||n)===a.id)),e=t.map(a=>a.employee.id),s=await this.fetchPayrollVerificationIds(e);if(s.length===0){this.$emit("show-snackbar",{message:"No payroll records found for selected employees",color:"warning"});return}const l=s.map(a=>({id:a.id,salaryPaid:"unPaid"}));await j.patch("https://appv1.fieldseasy.com/directus/items/payrollVerification",l,{headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"}}),t.forEach(a=>{const n=this.items.findIndex(h=>h.id===a.id);n!==-1&&(this.items[n].salaryPaid="unPaid")}),this.$emit("show-snackbar",{message:`Successfully marked ${t.length} users as unpaid`,color:"success"})}catch(t){console.error("Error marking users as unpaid:",t),this.$emit("show-snackbar",{message:`Error marking users as unpaid: ${t.message}`,color:"error"})}},async selectUnfinalizedUsers(){this.processingUnfinalized=!0;try{if(this.selected&&this.selected.length>0){const t=this.items.filter(n=>this.selected.some(h=>(h.id||h)===n.id));if(t.length===0){this.$emit("show-snackbar",{message:"No valid users selected for unfinalization",color:"warning"});return}const e=t.map(n=>n.employee.id),s=new URL("https://appv1.fieldseasy.com/directus/items/payrollVerification");s.searchParams.append("limit","-1"),s.searchParams.append("filter[tenant][tenantId][_eq]",this.tenantId),s.searchParams.append("filter[employee][_in]",e.join(",")),s.searchParams.append("filter[_or][0][salaryVerification][_eq]","true"),s.searchParams.append("filter[_or][1][attendaceVerification][_eq]","true"),s.searchParams.append("filter[salaryPaid][_neq]","paid"),this.dateRange.start&&this.dateRange.end&&(s.searchParams.append("filter[startDate][_gte]",this.dateRange.start),s.searchParams.append("filter[endDate][_lte]",this.dateRange.end)),s.searchParams.append("fields[]","id"),s.searchParams.append("fields[]","employee"),s.searchParams.append("fields[]","salaryPaid"),s.searchParams.append("fields[]","leavededuction");const l=await fetch(s,{headers:{Authorization:`Bearer ${this.token}`}});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const a=await l.json();if(!a.data||a.data.length===0){this.$emit("show-snackbar",{message:"No finalized unpaid payroll records found for selected users",color:"info"});return}this.unfinalizedUsers=a.data}else{const t=new URL("https://appv1.fieldseasy.com/directus/items/payrollVerification");t.searchParams.append("limit","-1"),t.searchParams.append("filter[tenant][tenantId][_eq]",this.tenantId),t.searchParams.append("filter[_or][0][salaryVerification][_eq]","true"),t.searchParams.append("filter[_or][1][attendaceVerification][_eq]","true"),t.searchParams.append("filter[salaryPaid][_neq]","paid"),this.dateRange.start&&this.dateRange.end&&(t.searchParams.append("filter[startDate][_gte]",this.dateRange.start),t.searchParams.append("filter[endDate][_lte]",this.dateRange.end)),t.searchParams.append("fields[]","id"),t.searchParams.append("fields[]","employee"),t.searchParams.append("fields[]","salaryPaid"),t.searchParams.append("fields[]","leavededuction");const e=await fetch(t,{headers:{Authorization:`Bearer ${this.token}`}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();if(!s.data||s.data.length===0){this.$emit("show-snackbar",{message:"No finalized unpaid users found for the selected period",color:"info"});return}this.unfinalizedUsers=s.data}this.totalBatches=Math.ceil(this.unfinalizedUsers.length/this.batchSize),this.currentBatch=0,this.showUnfinalizedDialog=!0}catch(t){console.error("Error fetching finalized users:",t),this.$emit("show-snackbar",{message:`Error fetching finalized users: ${t.message}`,color:"error"})}finally{this.processingUnfinalized=!1}},async adjustLeavesFromUnfinalizedUsers(){var t,e;if(!this.unfinalizedUsers||this.unfinalizedUsers.length===0){this.$emit("show-snackbar",{message:"No unfinalized users to adjust leave for",color:"warning"});return}try{const s=this.unfinalizedUsers.map(h=>h.employee),l=new URL("https://appv1.fieldseasy.com/directus/items/leave");l.searchParams.append("limit","-1"),l.searchParams.append("filter[assignedTo][_in]",s.join(",")),l.searchParams.append("fields[]","id"),l.searchParams.append("fields[]","assignedTo"),l.searchParams.append("fields[]","leaveTaken"),l.searchParams.append("fields[]","leaveBalance");const a=await fetch(l,{headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();if(!n.data||n.data.length===0){this.$emit("show-snackbar",{message:"No leave records found for unfinalized users",color:"info"});return}for(const h of this.unfinalizedUsers){const g=n.data.find(f=>f.assignedTo===h.employee);if(g&&h.leavededuction)for(const f in h.leavededuction){const p="t"+f.toLowerCase(),w=f.toLowerCase(),U=h.leavededuction[f];if(((t=g.leaveTaken)==null?void 0:t[p])!==void 0&&((e=g.leaveBalance)==null?void 0:e[w])!==void 0){g.leaveTaken[p]-=U,g.leaveBalance[w]+=U;const b=`https://appv1.fieldseasy.com/directus/items/leave/${g.id}`;(await fetch(b,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({leaveTaken:g.leaveTaken,leaveBalance:g.leaveBalance})})).ok||console.error(`Failed to update leave ID ${g.id}`)}}}this.$emit("show-snackbar",{message:"Leave balances updated for unfinalized users",color:"success"})}catch(s){console.error("Error adjusting leaves:",s),this.$emit("show-snackbar",{message:`Error adjusting leaves: ${s.message}`,color:"error"})}},async processUnfinalizedBatch(){if(this.currentBatch>=this.totalBatches){this.$emit("show-snackbar",{message:"All batches processed successfully",color:"success"}),this.showUnfinalizedDialog=!1;return}this.processingBatch=!0,await this.adjustLeavesFromUnfinalizedUsers();try{const t=this.currentBatch*this.batchSize,e=Math.min(t+this.batchSize,this.unfinalizedUsers.length),l=this.unfinalizedUsers.slice(t,e).map(n=>({id:n.id,salaryVerification:!1,attendaceVerification:!1,leavededuction:{}})),a=await fetch("https://appv1.fieldseasy.com/directus/items/payrollVerification",{method:"PATCH",headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"},body:JSON.stringify(l)});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);this.currentBatch++,this.$emit("show-snackbar",{message:`Processed batch ${this.currentBatch} of ${this.totalBatches}`,color:"success"}),this.currentBatch<this.totalBatches?await this.processUnfinalizedBatch():(this.showUnfinalizedDialog=!1,this.fetchItems())}catch(t){console.error("Error processing batch:",t),this.$emit("show-snackbar",{message:`Error processing batch: ${t.message}`,color:"error"})}finally{this.processingBatch=!1}},cancelUnfinalizedProcess(){this.showUnfinalizedDialog=!1,this.unfinalizedUsers=[],this.currentBatch=0,this.totalBatches=0},async markAsPaid(){if(this.finalizedUnpaidUsers=this.items.filter(t=>t.salaryVerified&&t.salaryPaid!=="paid"),this.finalizedUnpaidUsers.length===0){this.showNoUsersToMarkPaid=!0;return}try{const t=await this.fetchPayrollVerificationIds(this.finalizedUnpaidUsers.map(e=>e.employee.id));if(t.length===0){this.showNoUsersToMarkPaid=!0;return}this.finalizedUnpaidUsers=this.finalizedUnpaidUsers.map(e=>{var s;return{...e,payrollVerificationId:(s=t.find(l=>l.employee===e.employee.id))==null?void 0:s.id}}).filter(e=>e.payrollVerificationId),this.showPaidConfirmation=!0}catch(t){console.error("Error fetching payroll verification IDs:",t),this.$emit("show-snackbar",{message:"Error verifying payroll records",color:"error"})}},async fetchPayrollVerificationIds(t){try{return(await j.get("https://appv1.fieldseasy.com/directus/items/payrollVerification",{params:{filter:{_and:[{employee:{_in:t}},{startDate:{_eq:this.dateRange.start}},{endDate:{_eq:this.dateRange.end}}]},fields:["id","employee"]},headers:{Authorization:`Bearer ${this.token}`}})).data.data||[]}catch(e){return console.error("Error fetching payroll verification IDs:",e),[]}},async confirmMarkAsPaid(){this.markingAsPaidInProgress=!0;try{const t=this.finalizedUnpaidUsers.filter(e=>e.payrollVerificationId).map(e=>({id:e.payrollVerificationId,salaryPaid:"paid",paidDate:new Date().toISOString().split("T")[0]}));if(t.length===0)throw new Error("No valid payroll records found to mark as paid");await j.patch("https://appv1.fieldseasy.com/directus/items/payrollVerification",t,{headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"}}),this.finalizedUnpaidUsers.forEach(e=>{const s=this.items.findIndex(l=>l.id===e.id);s!==-1&&(this.items[s].salaryPaid="paid")}),this.$emit("show-snackbar",{message:`Successfully marked ${this.finalizedUnpaidUsers.length} users as paid`,color:"success"}),this.showPaidConfirmation=!1}catch(t){console.error("Error marking users as paid:",t),this.$emit("show-snackbar",{message:`Error marking users as paid: ${t.message}`,color:"error"})}finally{this.markingAsPaidInProgress=!1}},finalizeMultiplePayroll(){if(!this.selected||this.selected.length===0){this.$emit("show-snackbar",{message:"Please select at least one employee",color:"warning"});return}const t=this.items.filter(l=>this.selected.some(a=>(a.id||a)===l.id));if(this.selected.filter(l=>l.attendanceVerified===!0).length>0){this.selectUnfinalizedUsers();return}const s=t.filter(l=>l.salaryPaid==="paid");if(s.length>0){if(t.length===1&&s.length===1){this.showPaidUserSelectedDialog=!0;return}if(t.length>1&&s.length>0){this.paidUsersCount=s.length,this.unpaidUsersCount=t.length-s.length,this.unpaidUsersCount>0?this.showMixedPaidUsersDialog=!0:this.showPaidUsersWarning=!0;return}}localStorage.setItem("selectedEmployees",JSON.stringify(t)),localStorage.setItem("attendanceDateRange",JSON.stringify({startDate:this.dateRange.start,endDate:this.dateRange.end,selectedMonth:this.selectedMonth,fixedCycle:this.fixedCycle,tenantId:this.tenantId})),this.$router.push({name:"attendance-verification"})},skipPaidUsers(){const e=this.items.filter(s=>this.selected.some(l=>(l.id||l)===s.id)).filter(s=>s.salaryPaid!=="paid");if(e.length===0){this.$emit("show-snackbar",{message:"No unpaid users to process. Please select at least one unpaid user.",color:"warning"}),this.showPaidUserSelectedDialog=!1,this.showMixedPaidUsersDialog=!1;return}localStorage.setItem("selectedEmployees",JSON.stringify(e)),localStorage.setItem("attendanceDateRange",JSON.stringify({startDate:this.dateRange.start,endDate:this.dateRange.end,selectedMonth:this.selectedMonth,fixedCycle:this.fixedCycle,tenantId:this.tenantId})),this.$emit("show-snackbar",{message:`Processing ${e.length} unpaid users. Skipped ${this.paidUsersCount} paid users.`,color:"info"}),this.showPaidUserSelectedDialog=!1,this.showMixedPaidUsersDialog=!1,this.$router.push({name:"attendance-verification"})},handleSelectionChange(){this.hasPaidUsersSelected&&this.$emit("show-snackbar",{message:`Warning: ${this.paidUsersSelectedCount} selected users are paid and cannot be unfinalized`,color:"warning"})},getCycleNameById(t){const e=this.multiAttendanceCycles.find(s=>s.cycleId===t);return e?e.cycleName:`Cycle ${t}`},cycleTypeOptionsWithDates(){const t=new Date().getFullYear(),e=this.selectedMonth;return this.multiAttendanceCycles.map(s=>{const l=parseInt(s.startDate)||21,a=parseInt(s.endDate)||20;let n,h,g,f;e===0?(n=11,h=t-1):(n=e-1,h=t),g=e,f=t;const p=`${h}-${String(n+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`,w=`${f}-${String(g+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`;return{cycleId:s.cycleId,cycleName:s.cycleName,title:`${s.cycleName} (${this.formatDateForDisplay(p)} - ${this.formatDateForDisplay(w)})`,value:s.cycleId,dateRange:{start:p,end:w}}})},getCycleWithDateRange(t){const e=this.cycleTypeOptionsWithDates.find(s=>s.cycleId===t);return e?e.title:`Cycle ${t}`},async fetchCycleTypesData(){try{this.multiAttendanceCycles=await ht(),this.cycleTypeOptions=this.multiAttendanceCycles.map(t=>({cycleId:t.cycleId,cycleName:t.cycleName}))}catch(t){console.error("Error fetching cycle types:",t),this.$emit("show-snackbar",{message:"Failed to load cycle types",color:"error"})}},formatAttendanceData(t){if(!t)return{};try{const e=typeof t=="string"?JSON.parse(t):t,{employeeId:s,...l}=e;return l}catch(e){return console.error("Error formatting attendance data:",e),{}}},getNoDataMessage(){return"No employees match your current filter criteria."},formatDateForDisplay(t){if(!t)return"-";try{return new Date(t+"T00:00:00Z").toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(e){return console.error("Error formatting date:",e),t}},clearAttendanceFilter(){this.verificationFilters.attendance=null,this.applyFilters()},formatAmount(t){if(!t)return"0";const e=parseFloat(t);return Math.round(e).toLocaleString("en-IN")},formatPayrollMonth(t,e){return new Date(e,t-1,1).toLocaleDateString("en-US",{month:"long",year:"numeric"})},async downloadPayslip(t){var e,s,l,a,n,h,g,f;if(!t.attendanceVerified||!t.salaryVerified){this.$emit("show-snackbar",{message:"This employee's payslip is not available for download. Both attendance and salary must be verified and finalized.",color:"warning"});return}try{this.generatingPdf=!0;const p=await fetch(`https://appv1.fieldseasy.com/directus/items/personalModule/${t.employee.id}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!p.ok)throw new Error(`Failed to fetch employee details: ${p.statusText}`);const w=await p.json();let U=`https://appv1.fieldseasy.com/directus/items/payrollVerification?filter[_and][0][employee][id][_eq]=${t.employee.id}`;this.dateRange.start&&this.dateRange.end&&(U+=`&filter[_and][1][startDate][_gte]=${this.dateRange.start}`,U+=`&filter[_and][2][endDate][_lte]=${this.dateRange.end}`);const b=await fetch(U,{headers:{Authorization:`Bearer ${this.token}`}});if(!b.ok)throw new Error(`Failed to fetch verification details: ${b.statusText}`);const k=await b.json();if(!k.data||k.data.length===0)throw new Error("No payroll verification data found for this employee in the selected date range.");const r=k.data[0],P=r.earnings||{},I=r.deductions||{},C=r.benefits||{},B=r.penalties||{},M=r.otherDeduction||{},q=new Date,L=this.dateRange.end?new Date(this.dateRange.end).getMonth()+1:q.getMonth()+1,E=this.dateRange.end?new Date(this.dateRange.end).getFullYear():q.getFullYear();this.currentPayslipData={employeeName:t.employee.assignedUser.first_name||"Employee",employeeId:t.employee.employeeId||"-",department:((e=t.employee.department)==null?void 0:e.departmentName)||"-",Role:((s=t.employee.assignedUser.role)==null?void 0:s.name)||"-",PFNumber:(l=t.employee.assignedUser)==null?void 0:l.PFAccountNumber,ESINumber:(a=t.employee.assignedUser)==null?void 0:a.ESIAccountNumber,tenantName:(n=t.tenant)==null?void 0:n.tenantName,Address:(h=t.tenant)==null?void 0:h.companyAddress,designation:(g=t.employee.assignedUser)==null?void 0:g.designation,month:L,year:E,payableDays:t.payableDays||r.payableDays||0,earnings:P,deductions:I,benefits:C,penalties:B,otherDeduction:M,totalEarnings:r.totalEarnings,individualDeduction:r.individualDeduction,salaryArrears:r.salaryArrears,totalDeductions:r.totalOtherDeduction,netSalary:r.netSalary,totalBenefits:r.totalBenefits,totalAttendanceCount:r.totalAttendanceCount||null,loanRepayment:r.loanRepayment||0,payableAmount:r.payableAmount||0,ctc:r.ctc||0,cycleDates:{startDate:this.dateRange.start,endDate:this.dateRange.end,totalDays:this.dateRange.start&&this.dateRange.end?Math.ceil((new Date(this.dateRange.end)-new Date(this.dateRange.start))/(1e3*60*60*24))+1:0},startDate:r.startDate||this.dateRange.start||"-",endDate:r.endDate||this.dateRange.end||"-"};const A=await this.files((f=t.tenant)==null?void 0:f.logo);this.currentPayslipData.logo=A,this.showPayslipPreview=!0}catch(p){return console.error("Error preparing payslip:",p),this.$emit("show-snackbar",{message:`Error preparing payslip: ${p.message}`,color:"error"}),!1}finally{this.generatingPdf=!1}return!0},async files(t){try{const e=de.getToken();if(!t)return;const s=await fetch(`https://appv1.fieldseasy.com/directus/assets/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch file");const l=await s.blob();return URL.createObjectURL(l)}catch(e){return console.error("Error fetching file URL:",e),null}},async downloadCurrentPayslip(){if(this.currentPayslipData)try{this.generatingPdf=!0;const t=this.$refs.payslipPreviewContent.querySelector(".payslip-container");if(!t)throw new Error("Payslip element not found");const e=await dt(t,{scale:2,useCORS:!0,logging:!1,backgroundColor:"#ffffff"}),s=e.toDataURL("image/png"),l=new ct({orientation:"portrait",unit:"pt",format:"a4"}),a=595.28,n=841.89,h=20,g=a-2*h,f=e.height*g/e.width;l.addImage(s,"PNG",h,h,g,f);const p=`payslip-${this.currentPayslipData.employeeName.replace(/\s+/g,"-")}-${this.currentPayslipData.month}-${this.currentPayslipData.year}.pdf`;l.save(p),this.$emit("show-snackbar",{message:"Payslip downloaded as PDF successfully",color:"success"})}catch(t){console.error("Error downloading payslip:",t),this.$emit("show-snackbar",{message:`Error downloading payslip: ${t.message}`,color:"error"})}finally{this.generatingPdf=!1}},async downloadSelectedPayslips(){if(!this.selected||this.selected.length===0){this.$emit("show-snackbar",{message:"Please select at least one employee",color:"warning"});return}if(this.selected.length>1){this.$emit("show-snackbar",{message:"Please select only one employee to download a payslip",color:"warning"});return}this.downloadingPayslips=!0;try{const e=this.items.filter(l=>this.selected.some(a=>(a.id||a)===l.id)).filter(l=>l.attendanceVerified&&l.salaryVerified);if(e.length===0){this.$emit("show-snackbar",{message:"The selected employee doesn't have verified attendance and finalized salary for payslip download",color:"warning"}),this.downloadingPayslips=!1;return}await this.downloadPayslip(e[0])&&this.currentPayslipData?(await this.downloadCurrentPayslip(),this.$emit("show-snackbar",{message:"Successfully processed payslip",color:"success"})):(console.error("Failed to load payslip data"),this.$emit("show-snackbar",{message:"Failed to load payslip data",color:"error"}))}catch(t){console.error("Error downloading payslip:",t),this.$emit("show-snackbar",{message:`Error downloading payslip: ${t.message}`,color:"error"})}finally{this.downloadingPayslips=!1}},cancelDownload(){this.downloadCancelToken&&this.downloadCancelToken.cancel("Download canceled by user"),this.showDownloadProgress=!1,this.downloadProgress=0},async downloadSalarySheet(){var t,e,s,l;try{this.loading=!0,this.downloadProgress=0,this.showDownloadProgress=!0,this.downloadTitle="Downloading Salary Sheet",this.downloadFileName=`salary-sheet-${new Date().toISOString().slice(0,10)}.xlsx`;let a=[];if(this.selected.length>0)a=this.items.filter(b=>this.selected.some(k=>(k.id||k)===b.id));else if(this.hasActiveFilters||this.search)a=this.items;else{let b=1,k=[],r=!0;for(;r;){const I=(await j.get("https://appv1.fieldseasy.com/directus/items/SalaryBreakdown",{params:{limit:100,page:b,"filter[_and][0][_and][0][employee][assignedUser][tenant][tenantId][_eq]":this.tenantId,"filter[_and][0][_and][2][_or][0][employee][assignedUser][dateOfJoining][_lte]":this.dateRange.end,"filter[_and][0][_and][2][_or][1][employee][assignedUser][dateOfJoining][_null]":!0,"filter[_and][0][_and][3][_or][0][employee][assignedUser][dateOfLeaving][_gte]":this.dateRange.start,"filter[_and][0][_and][3][_or][1][employee][assignedUser][dateOfLeaving][_null]":!0,fields:["id","employee.id","employee.employeeId","employee.assignedUser.first_name","employee.assignedUser.role.name","employee.assignedUser.dateOfJoining","employee.assignedUser.dateOfLeaving","employee.branch.branchName","employee.department.departmentName","employee.cycleType"]},headers:{Authorization:`Bearer ${this.token}`}})).data.data||[];k=k.concat(I),r=I.length===100,b++}a=k}this.downloadFileSize=a.length*10240;const n=new Date,h=n.getMonth()+1,g=n.getFullYear();this.downloadCancelToken=j.CancelToken.source();let f,p;const w=await this.calculateAttendanceCycleDates(h,g);f=w.cycleStartDate,p=w.cycleEndDate,this.dateRange.start&&this.dateRange.end&&(f=this.dateRange.start,p=this.dateRange.end);const U=setInterval(()=>{this.downloadProgress<90&&(this.downloadProgress+=Math.floor(Math.random()*10)+1)},300);await bt(a,h,g,this.token,{cancelToken:this.downloadCancelToken.token,onProgress:b=>{this.downloadProgress=b.percentage},startDate:f,endDate:p,isFixedCycle:this.fixedCycle,filters:{branch:((t=this.filters)==null?void 0:t.branch)||null,department:((e=this.filters)==null?void 0:e.department)||null,attendanceVerification:((s=this.verificationFilters)==null?void 0:s.attendance)||null,salaryVerification:((l=this.verificationFilters)==null?void 0:l.salary)||null}}),clearInterval(U),this.downloadProgress=100,this.showDownloadProgress=!1,this.$emit("show-snackbar",{message:`Successfully generated salary sheet for ${a.length} employees`,color:"success"})}catch(a){this.showDownloadProgress=!1,j.isCancel(a)?this.$emit("show-snackbar",{message:"Download canceled",color:"info"}):(console.error("Error generating salary sheet:",a),this.$emit("show-snackbar",{message:`Error generating salary sheet: ${a.message}`,color:"error"}))}finally{this.loading=!1}},handleRowClick(t){if(t.attendanceVerified&&t.salaryVerified){this.downloadPayslip(t);return}localStorage.setItem("selectedEmployee",JSON.stringify(t)),localStorage.setItem("attendanceDateRange",JSON.stringify({startDate:this.dateRange.start,endDate:this.dateRange.end,selectedMonth:this.selectedMonth,fixedCycle:this.fixedCycle,tenantId:this.tenantId}))},debouncedSearch(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.page=1,this.aggregateCount(),this.fetchItems()},500)},async user(){var e,s,l,a;const t=await ue.fetchLoginUserDetails();this.tenantId=((e=t.tenant)==null?void 0:e.tenantId)||t.tenant;try{const n=await fetch(`https://appv1.fieldseasy.com/directus/items/tenant/${this.tenantId}`,{headers:{Authorization:`Bearer ${this.token}`}});if(n.ok){const h=await n.json();this.tenantName=((s=h.data)==null?void 0:s.tenantName)||"Company Name",this.tenantAddress=((l=h.data)==null?void 0:l.companyAddress)||"Company Address",this.companyLogo=((a=h.data)==null?void 0:a.logo)||"https://via.placeholder.com/150x50?text=Company+Logo",this.currentPayslipData={tenantName:this.tenantName,logo:this.companyLogo,address:this.tenantAddress}}}catch(n){console.error("Error fetching tenant details:",n)}},async checkVerificationStatus(t){try{const e=new URL("https://appv1.fieldseasy.com/directus/items/payrollVerification?limit=-1");Array.isArray(t)?e.searchParams.append("filter[employee][id][_in]",t.join(",")):e.searchParams.append("filter[employee][id][_eq]",t),this.tenantId&&e.searchParams.append("filter[tenant][tenantId][_eq]",this.tenantId),this.dateRange.start&&this.dateRange.end&&(e.searchParams.append("filter[startDate][_eq]",this.dateRange.start),e.searchParams.append("filter[endDate][_eq]",this.dateRange.end)),this.verificationFilters.attendance!==null&&e.searchParams.append("filter[attendaceVerification][_eq]",this.verificationFilters.attendance),this.verificationFilters.salary!==null&&e.searchParams.append("filter[salaryVerification][_eq]",this.verificationFilters.salary),this.verificationFilters.salaryPaid!==null&&e.searchParams.append("filter[salaryPaid][_eq]",this.verificationFilters.salaryPaid);const s=await fetch(e,{headers:{Authorization:`Bearer ${this.token}`}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const l=await s.json();if(!l.data||l.data.length===0)return Array.isArray(t)&&t.length>0?{}:{attendanceVerified:!1,salaryVerified:!1,ctc:"0",payableDays:"0",downloadablePdf:null,startDate:null,endDate:null,salaryPaid:"unPaid"};if(Array.isArray(t)&&t.length>0){const a={};return l.data.forEach(n=>{n.employee&&(a[n.employee]={attendanceVerified:n.attendaceVerification||!1,salaryVerified:n.salaryVerification||!1,ctc:n.ctc?Math.round(parseFloat(n.ctc)).toString():"-",payableDays:n.payableDays||"-",downloadablePdf:n.downloadablePdf,startDate:n.startDate||null,endDate:n.endDate||null,salaryPaid:n.salaryPaid||"unPaid"})}),a}return{attendanceVerified:l.data[0].attendaceVerification||!1,salaryVerified:l.data[0].salaryVerification||!1,ctc:l.data[0].ctc?Math.round(parseFloat(l.data[0].ctc)).toString():"-",payableDays:l.data[0].payableDays||"-",downloadablePdf:l.data[0].downloadablePdf,startDate:l.data[0].startDate||null,endDate:l.data[0].endDate||null,salaryPaid:l.data[0].salaryPaid||"unPaid"}}catch(e){return console.error("Error checking verification status:",e),Array.isArray(t)&&t.length>1?{}:{attendanceVerified:!1,salaryVerified:!1,ctc:"-",payableDays:"-",downloadablePdf:null,startDate:null,endDate:null,salaryPaid:"unPaid"}}},onFilterVisibilityChanged(t){this.showFilters=t},toggleFilters(){this.showFilters=!this.showFilters},handlePageChange(t){this.page=t,this.fetchItems()},handleItemsPerPageChange(t){this.itemsPerPage=t,this.page=1,this.fetchItems()},getStatusCount(t){return!this.hasActiveFilters&&this.selectedStatus==="all"?0:t==="all"?this.totalItems:this.items.filter(e=>e.status===t).length},getStatusColor(t){return{Active:"success",Inactive:"error",Pending:"warning"}[t]||"grey"}},watch:{dateRange:{handler(t,e){console.log("dateRange changed:",{newVal:t,oldVal:e})},deep:!0}},async mounted(){await this.user(),await this.aggregateCount(),await this.fetchItems()}},Rt={key:0,class:"filter-pane"},Tt={class:"filter-content"},zt={class:"main-content"},xt=["title"],Bt={key:0,class:"filter-indicator"},Mt={class:"position-relative"},Ot={key:0,class:"ml-1"},jt={class:"stats-container"},qt={class:"stat-item"},Lt={class:"stat-value"},$t={class:"stat-item"},Yt={class:"stat-value"},Ht={class:"stat-item"},Jt={class:"stat-value"},Wt={class:"stat-item"},Gt={class:"stat-value"},Kt={key:2},Qt={class:"d-flex align-center py-2 px-4"},Zt={class:"text-primary"},Xt={ref:"payslipPreviewContent",class:"payslip-preview-content"},ea={key:0,class:"payslip-container-new"},ta={key:0,class:"payslip-loading"},aa={key:1,class:"payslip-content"},sa={class:"payslip-header-new"},na={class:"company-name"},ra={key:0,class:"company-address"},ia={class:"payslip-title-text"},la={class:"section-container"},oa={class:"details-table"},da={class:"value-cell"},ca={class:"value-cell"},ha={class:"value-cell"},ua={class:"value-cell"},pa={colspan:"3",class:"value-cell"},fa={colspan:"3",class:"value-cell"},ya={class:"value-cell"},ga={class:"value-cell"},ma={class:"salary-grid"},Da={class:"salary-column"},Pa={class:"salary-table"},wa={class:"item-cell"},ba={class:"amount-cell"},va={class:"item-cell"},ka={class:"amount-cell"},Ua={class:"item-cell"},Sa={class:"amount-cell"},Ca={class:"total-row"},_a={class:"amount-cell"},Fa={class:"salary-column"},Ia={class:"salary-table"},Aa={class:"item-cell"},Ea={class:"amount-cell"},Na={class:"item-cell"},Va={class:"amount-cell"},Ra={class:"item-cell"},Ta={class:"amount-cell"},za={class:"item-cell"},xa={class:"amount-cell"},Ba={class:"total-row"},Ma={class:"amount-cell"},Oa={class:"net-salary-box"},ja={class:"net-salary-amount"},qa={key:0,class:"d-flex flex-column align-center"},La={class:"text-body-1"},$a={class:"text-body-1 mt-2"},Ya={key:1,class:"d-flex flex-column align-center"},Ha={class:"text-body-1"};function Ja(t,e,s,l,a,n){const h=Q("PayrollFilters"),g=Q("BaseButton"),f=Q("SkeletonLoading"),p=Q("ErrorState"),w=Q("DataTable"),U=Q("CustomPagination"),b=Q("data-table-wrapper"),k=Q("DownloadProgressDialog");return D(),v("div",{class:he(["employee-container",{"filter-open":a.showFilters}])},[a.showFilters&&a.tenantId?(D(),v("div",Rt,[i("div",Tt,[d(h,{tenantId:a.tenantId,initialFilters:n.initialFilters,initiallyVisible:!0,"filter-schema":a.pageFilters,onApplyFilters:n.handleApplyFilters,onFilterVisibilityChanged:n.onFilterVisibilityChanged},null,8,["tenantId","initialFilters","filter-schema","onApplyFilters","onFilterVisibilityChanged"])])])):_("",!0),i("div",zt,[d(b,{searchQuery:a.search,"onUpdate:searchQuery":[e[7]||(e[7]=r=>a.search=r),n.debouncedSearch],"search-placeholder":"Search Employee ","show-search":!0,"is-empty":a.items.length===0&&!a.search,"has-error":!1},{"before-search":o(()=>[a.tenantId?(D(),v("button",{key:0,class:he(["filter-toggle-static",{active:n.hasActiveFilters}]),onClick:e[0]||(e[0]=(...r)=>n.toggleFilters&&n.toggleFilters(...r)),title:a.showFilters?"Hide filters":"Show filters","aria-label":"Toggle filters"},[e[23]||(e[23]=i("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[i("polygon",{points:"22,3 2,3 10,12.46 10,19 14,21 14,12.46"})],-1)),n.hasActiveFilters?(D(),v("div",Bt)):_("",!0)],10,xt)):_("",!0)]),"below-search":o(()=>[i("div",Mt,[d(g,{variant:"primary",size:"md","left-icon":a.RefreshCw,onClick:n.recalculateAttendance,class:"ms-2"},{default:o(()=>e[24]||(e[24]=[y(" Recalc Attendance ")])),_:1},8,["left-icon","onClick"]),d(g,{variant:"success",size:"md","left-icon":a.BadgeCheck,onClick:n.markAsPaid,disabled:!n.hasFinalizedUnpaidUsers,class:"ms-2"},{default:o(()=>e[25]||(e[25]=[y(" Mark as Paid ")])),_:1},8,["left-icon","onClick","disabled"]),d(g,{variant:"primary",size:"md","left-icon":a.CheckCheck,onClick:e[1]||(e[1]=r=>n.finalizeMultiplePayroll()),disabled:a.selected.length===0,class:"ms-2"},{default:o(()=>[y(" Finalize Payroll ("+c(a.selected.length)+") ",1)]),_:1},8,["left-icon","disabled"]),d(g,{variant:"primary",size:"md","left-icon":a.FileSpreadsheet,onClick:e[2]||(e[2]=r=>n.downloadSalarySheet()),class:"ms-2"},{default:o(()=>[e[26]||(e[26]=y(" Salary Sheet ")),a.selected.length>0?(D(),v("span",Ot," ("+c(a.selected.length)+") ",1)):_("",!0)]),_:1},8,["left-icon"])])]),"toolbar-actions":o(()=>[i("div",jt,[i("div",qt,[i("span",Lt,c(a.payrollCounts.paid),1),e[27]||(e[27]=i("span",{class:"stat-title"},"Paid",-1))]),i("div",$t,[i("span",Yt,c(a.payrollCounts.unpaid),1),e[28]||(e[28]=i("span",{class:"stat-title"},"Unpaid",-1))]),i("div",Ht,[i("span",Jt,c(a.payrollCounts.finalized),1),e[29]||(e[29]=i("span",{class:"stat-title"},"Finalized",-1))]),i("div",Wt,[i("span",Gt,c(a.payrollCounts.unfinalized),1),e[30]||(e[30]=i("span",{class:"stat-title"},"Unfinalized",-1))])])]),default:o(()=>[a.loading?(D(),z(f,{key:0,variant:"data-table",rows:6,columns:n.columns.length,animated:!0},null,8,["columns"])):a.error?(D(),z(p,{key:1,title:"Unable to load employees",message:a.error,"retry-action":{text:"Try Again",icon:a.RefreshCw},onRetry:n.fetchItems},null,8,["message","retry-action","onRetry"])):(D(),v("div",Kt,[d(w,{items:a.items,columns:n.columns,"selected-items":a.selected,"show-selection":!0,"sort-by":a.sortBy,"sort-direction":a.sortDirection,"row-clickable":!0,"onUpdate:selectedItems":e[4]||(e[4]=r=>a.selected=r),onRowClick:n.handleRowClick},{top:o(()=>[i("div",Qt,[a.dateRange.start&&a.dateRange.end?(D(),z(te,{key:0,class:"mr-2 mb-1 mt-1",closable:!1},{default:o(()=>[y(c(n.formatDateForDisplay(a.dateRange.start))+" - "+c(n.formatDateForDisplay(a.dateRange.end)),1)]),_:1})):_("",!0),a.verificationFilters.attendance!==null?(D(),z(te,{key:1,color:a.verificationFilters.attendance?"success":"error",closable:"","onClick:close":n.clearAttendanceFilter},{default:o(()=>[y(" Attendance: "+c(a.verificationFilters.attendance?"Verified":"Unverified"),1)]),_:1},8,["color","onClick:close"])):_("",!0),a.verificationFilters.salary!==null?(D(),z(te,{key:2,class:"mr-2 mb-1 mt-1",color:a.verificationFilters.salary?"success":"error",closable:"","onClick:close":t.clearSalaryFilter},{default:o(()=>[y(" Salary: "+c(a.verificationFilters.salary?"Finalized":"Unfinalized"),1)]),_:1},8,["color","onClick:close"])):_("",!0),a.verificationFilters.salaryPaid!==null?(D(),z(te,{key:3,class:"mr-2 mb-1 mt-1",color:a.verificationFilters.salaryPaid==="paid"?"success":"error",closable:"","onClick:close":t.clearSalaryPaidFilter},{default:o(()=>[y(" Salary Status: "+c(a.verificationFilters.salaryPaid==="paid"?"Paid":"Unpaid"),1)]),_:1},8,["color","onClick:close"])):_("",!0)])]),"cell-employee.employeeId":o(({item:r})=>[i("strong",null,c(r.employee.employeeId||"-"),1)]),"cell-employee.assignedUser.first_name":o(({item:r})=>[i("span",Zt,c(r.employee.assignedUser.first_name||"-"),1)]),"cell-employee.assignedUser.role.name":o(({item:r})=>{var P;return[y(c(((P=r.employee.assignedUser.role)==null?void 0:P.name)||"-"),1)]}),"cell-employee.assignedUser.designation":o(({item:r})=>[y(c(r.employee.assignedUser.designation||"-"),1)]),"cell-attendanceVerification":o(({item:r})=>[d(O,{color:r.attendanceVerified?"success":"error",small:"",style:{position:"static"}},{default:o(()=>[y(c(r.attendanceVerified?"mdi-check-circle":"mdi-alert-circle"),1)]),_:2},1032,["color"]),y(" "+c(r.attendanceVerified?"Verified":"Unverified"),1)]),"cell-salaryVerification":o(({item:r})=>[d(O,{color:r.salaryVerified?"success":"error",small:"",style:{position:"static"}},{default:o(()=>[y(c(r.salaryVerified?"mdi-check-circle":"mdi-alert-circle"),1)]),_:2},1032,["color"]),y(" "+c(r.salaryVerified?"Finalized":"Unfinalized"),1)]),"cell-pending":o(({item:r})=>[d(te,{color:r.isPending?"orange":"green",small:""},{default:o(()=>[y(c(r.isPending?"Pending":"Approved"),1)]),_:2},1032,["color"])]),"cell-salaryPaid":o(({item:r})=>[i("span",{class:he(["salary-paid-status",r.salaryPaid==="paid"?"paid":"unpaid"])},c(r.salaryPaid==="paid"?"Paid":"Unpaid"),3)]),"cell-activity":o(({item:r})=>[d(te,{color:n.getActivityColor(r.activity),small:"",variant:"outlined"},{default:o(()=>[y(c(r.activity),1)]),_:2},1032,["color"])]),"cell-joiningDate":o(({item:r})=>[y(c(r.joiningDate?n.formatDateForDisplay(r.joiningDate):"-"),1)]),"cell-leavingDate":o(({item:r})=>[y(c(r.leavingDate?n.formatDateForDisplay(r.leavingDate):"-"),1)]),"cell-startDate":o(({item:r})=>[y(c(r.startDate?n.formatDateForDisplay(r.startDate):"-"),1)]),"cell-endDate":o(({item:r})=>[y(c(r.endDate?n.formatDateForDisplay(r.endDate):"-"),1)]),"cell-ctc":o(({item:r})=>[y(c(n.formatAmount(r.ctc)),1)]),"cell-payableDays":o(({item:r})=>[y(c(r.payableDays||"-"),1)]),"cell-payableCTC":o(({item:r})=>[y(c(n.formatAmount(r.payableCTC)),1)]),"cell-data-table-select":o(({item:r})=>[d(pt,{"model-value":n.isItemSelected(r),"onUpdate:modelValue":P=>n.handleCheckboxChange(r,P),disabled:!n.isItemSelectable(r),color:"black",density:"compact",onClick:e[3]||(e[3]=ft(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue","disabled"])]),_:1},8,["items","columns","selected-items","sort-by","sort-direction","onRowClick"])]))]),pagination:o(()=>[a.showForm?_("",!0):(D(),z(U,{key:0,page:a.page,"onUpdate:page":[e[5]||(e[5]=r=>a.page=r),n.handlePageChange],itemsPerPage:a.itemsPerPage,"onUpdate:itemsPerPage":[e[6]||(e[6]=r=>a.itemsPerPage=r),n.handleItemsPerPageChange],"total-items":a.totalItems},null,8,["page","itemsPerPage","total-items","onUpdate:page","onUpdate:itemsPerPage"]))]),_:1},8,["searchQuery","is-empty","onUpdate:searchQuery"]),d(k,{show:a.showDownloadProgress,"onUpdate:show":e[8]||(e[8]=r=>a.showDownloadProgress=r),progress:a.downloadProgress,title:a.downloadTitle,"file-name":a.downloadFileName,"file-size":a.downloadFileSize,"show-cancel":a.downloadProgress<100,onCancel:n.cancelDownload},null,8,["show","progress","title","file-name","file-size","show-cancel","onCancel"]),d($,{modelValue:a.showPayslipPreview,"onUpdate:modelValue":e[10]||(e[10]=r=>a.showPayslipPreview=r),"max-width":"800px"},{default:o(()=>[d(Y,null,{default:o(()=>[d(H,{class:"text-h5 bg-primary text-white"},{default:o(()=>[e[31]||(e[31]=y(" Payslip Preview ")),d(G)]),_:1}),d(J,{class:"pa-0"},{default:o(()=>[i("div",Xt,[a.currentPayslipData?(D(),v("div",ea,[a.generatingPdf?(D(),v("div",ta,[d(Je,{indeterminate:"",color:"primary"}),e[32]||(e[32]=i("span",{class:"ml-2"},"Generating PDF...",-1))])):(D(),v("div",aa,[i("div",sa,[i("div",null,[i("h1",na,c(a.currentPayslipData.tenantName),1),a.currentPayslipData.Address?(D(),v("p",ra,c(a.currentPayslipData.Address.house)+", "+c(a.currentPayslipData.Address.street)+", "+c(a.currentPayslipData.Address.vtc)+", "+c(a.currentPayslipData.Address.dist)+", "+c(a.currentPayslipData.Address.zip),1)):_("",!0),i("h2",ia," PAYSLIP FOR "+c(n.formatPayrollMonth(a.currentPayslipData.month,a.currentPayslipData.year)),1)])]),i("div",la,[e[41]||(e[41]=i("div",{class:"section-header"},"Employee Details",-1)),i("table",oa,[i("tbody",null,[i("tr",null,[e[33]||(e[33]=i("td",{class:"label-cell"},"Employee Name:",-1)),i("td",da,c(a.currentPayslipData.employeeName),1),e[34]||(e[34]=i("td",{class:"label-cell"},"Employee ID:",-1)),i("td",ca,c(a.currentPayslipData.employeeId),1)]),i("tr",null,[e[35]||(e[35]=i("td",{class:"label-cell"},"Role:",-1)),i("td",ha,c(a.currentPayslipData.Role),1),e[36]||(e[36]=i("td",{class:"label-cell"},"Designation:",-1)),i("td",ua,c(a.currentPayslipData.designation),1)]),i("tr",null,[e[37]||(e[37]=i("td",{class:"label-cell"},"PF(UAN) Number:",-1)),i("td",pa,c(a.currentPayslipData.PFNumber),1)]),i("tr",null,[e[38]||(e[38]=i("td",{class:"label-cell"},"ESI Number:",-1)),i("td",fa,c(a.currentPayslipData.ESINumber),1)]),i("tr",null,[e[39]||(e[39]=i("td",{class:"label-cell"},"Pay Period:",-1)),i("td",ya,c(n.formatPayrollMonth(a.currentPayslipData.month,a.currentPayslipData.year)),1),e[40]||(e[40]=i("td",{class:"label-cell"},"Payable Days:",-1)),i("td",ga,c(a.currentPayslipData.payableDays),1)])])])]),i("div",ma,[i("div",Da,[e[45]||(e[45]=i("div",{class:"section-header"},"Earnings",-1)),i("table",Pa,[i("tbody",null,[(D(!0),v(R,null,Z(a.currentPayslipData.earnings,(r,P)=>(D(),v("tr",{key:`earning-${P}`},[i("td",wa,c(P),1),i("td",ba,c(r===null?"NaN":n.formatAmount(r||0)),1)]))),128)),a.currentPayslipData.salaryArrears&&Object.keys(a.currentPayslipData.salaryArrears).length>0?(D(),v(R,{key:0},[e[42]||(e[42]=i("tr",null,[i("td",{colspan:"2",class:"subsection-header"}," Salary Arrears ")],-1)),(D(!0),v(R,null,Z(a.currentPayslipData.salaryArrears,(r,P)=>(D(),v("tr",{key:`arrear-${P}`},[i("td",va,c(P),1),i("td",ka,c(n.formatAmount(r||0)),1)]))),128))],64)):_("",!0),a.currentPayslipData.benefits&&Object.keys(a.currentPayslipData.benefits).length>0?(D(),v(R,{key:1},[e[43]||(e[43]=i("tr",null,[i("td",{colspan:"2",class:"subsection-header"}," Benefits ")],-1)),(D(!0),v(R,null,Z(a.currentPayslipData.benefits,(r,P)=>(D(),v("tr",{key:`benefit-${P}`},[i("td",Ua,c(P),1),i("td",Sa,c(n.formatAmount(r||0)),1)]))),128))],64)):_("",!0),i("tr",Ca,[e[44]||(e[44]=i("td",{class:"item-cell"},"Total Earnings",-1)),i("td",_a,c(a.currentPayslipData.totalEarnings===null?"NaN":n.formatAmount(a.currentPayslipData.totalEarnings||0)),1)])])])]),i("div",Fa,[e[50]||(e[50]=i("div",{class:"section-header"},"Deductions",-1)),i("table",Ia,[i("tbody",null,[(D(!0),v(R,null,Z(a.currentPayslipData.deductions,(r,P)=>(D(),v("tr",{key:`deduction-${P}`},[i("td",Aa,c(P),1),i("td",Ea,c(n.formatAmount(r||0)),1)]))),128)),a.currentPayslipData.penalties&&Object.keys(a.currentPayslipData.penalties).length>0?(D(),v(R,{key:0},[e[46]||(e[46]=i("tr",null,[i("td",{colspan:"2",class:"subsection-header"}," Penalties ")],-1)),(D(!0),v(R,null,Z(a.currentPayslipData.penalties,(r,P)=>(D(),v("tr",{key:`penalty-${P}`},[i("td",Na,c(P),1),i("td",Va,c(n.formatAmount(r||0)),1)]))),128))],64)):_("",!0),a.currentPayslipData.otherDeduction&&Object.keys(a.currentPayslipData.otherDeduction).length>0?(D(),v(R,{key:1},[e[47]||(e[47]=i("tr",null,[i("td",{colspan:"2",class:"subsection-header"}," Other Deductions ")],-1)),(D(!0),v(R,null,Z(a.currentPayslipData.otherDeduction,(r,P)=>(D(),v("tr",{key:`other-deduction-${P}`},[i("td",Ra,c(P),1),i("td",Ta,c(n.formatAmount(r||0)),1)]))),128))],64)):_("",!0),a.currentPayslipData.individualDeduction&&Object.keys(a.currentPayslipData.individualDeduction).length>0?(D(),v(R,{key:2},[e[48]||(e[48]=i("tr",null,[i("td",{colspan:"2",class:"subsection-header"}," Individual Deductions ")],-1)),(D(!0),v(R,null,Z(a.currentPayslipData.individualDeduction,(r,P)=>(D(),v(R,{key:`individual-deduction-group-${P}`},[(D(!0),v(R,null,Z(r,(I,C)=>(D(),v("tr",{key:`individual-deduction-${P}-${C}`},[i("td",za,c(C),1),i("td",xa,c(n.formatAmount(I||0)),1)]))),128))],64))),128))],64)):_("",!0),i("tr",Ba,[e[49]||(e[49]=i("td",{class:"item-cell"},"Total Deductions",-1)),i("td",Ma,c(n.formatAmount(a.currentPayslipData.totalDeductions||0)),1)])])])])]),i("div",Oa,[e[51]||(e[51]=i("span",{class:"net-salary-label"},"Net Salary (in words):",-1)),i("span",ja,c(n.formatAmount(a.currentPayslipData.netSalary)),1)])]))])):_("",!0)],512)]),_:1}),d(W,{class:"pa-4"},{default:o(()=>[d(G),d(V,{color:"error",onClick:e[9]||(e[9]=r=>a.showPayslipPreview=!1)},{default:o(()=>e[52]||(e[52]=[y("Close")])),_:1}),d(V,{color:"primary",onClick:n.downloadCurrentPayslip,loading:a.generatingPdf,disabled:a.generatingPdf},{default:o(()=>[d(O,{left:""},{default:o(()=>e[53]||(e[53]=[y("mdi-download")])),_:1}),e[54]||(e[54]=y(" Download PDF "))]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d($,{modelValue:a.showPaidConfirmation,"onUpdate:modelValue":e[12]||(e[12]=r=>a.showPaidConfirmation=r),"max-width":"500px"},{default:o(()=>[d(Y,null,{default:o(()=>[d(H,{class:"text-h5 bg-success text-white"},{default:o(()=>e[55]||(e[55]=[y(" Mark Users as Paid ")])),_:1}),d(J,{class:"pa-4 mt-4"},{default:o(()=>e[56]||(e[56]=[i("p",{class:"mt-2"},[i("strong",null,"Note:"),y(" Once marked as paid, these users cannot be unfinalized. ")],-1)])),_:1}),d(W,{class:"pa-4"},{default:o(()=>[d(G),d(V,{color:"grey",onClick:e[11]||(e[11]=r=>a.showPaidConfirmation=!1)},{default:o(()=>e[57]||(e[57]=[y("Cancel")])),_:1}),d(V,{color:"success",onClick:n.confirmMarkAsPaid,loading:a.markingAsPaidInProgress,disabled:a.markingAsPaidInProgress},{default:o(()=>[d(O,{left:""},{default:o(()=>e[58]||(e[58]=[y("mdi-cash")])),_:1}),e[59]||(e[59]=y(" Mark as Paid "))]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d($,{modelValue:a.showNoUsersToMarkPaid,"onUpdate:modelValue":e[14]||(e[14]=r=>a.showNoUsersToMarkPaid=r),"max-width":"500px"},{default:o(()=>[d(Y,null,{default:o(()=>[d(H,{class:"text-h5 bg-warning text-white"},{default:o(()=>e[60]||(e[60]=[y(" No Users to Mark as Paid ")])),_:1}),d(J,{class:"pa-4 mt-4"},{default:o(()=>e[61]||(e[61]=[i("p",null," No users available to mark as paid. Only finalized and unpaid users can be marked as paid. ",-1)])),_:1}),d(W,{class:"pa-4"},{default:o(()=>[d(G),d(V,{color:"primary",onClick:e[13]||(e[13]=r=>a.showNoUsersToMarkPaid=!1)},{default:o(()=>e[62]||(e[62]=[y("OK")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),d($,{modelValue:a.showPaidUsersWarning,"onUpdate:modelValue":e[16]||(e[16]=r=>a.showPaidUsersWarning=r),"max-width":"500px"},{default:o(()=>[d(Y,null,{default:o(()=>[d(H,{class:"text-h5 bg-warning text-white"},{default:o(()=>e[63]||(e[63]=[y(" Paid Users Selected ")])),_:1}),d(J,{class:"pa-4 mt-4"},{default:o(()=>[i("p",null," You have selected "+c(a.paidUsersCount)+" paid users. Paid users cannot be unfinalized. ",1),e[64]||(e[64]=i("p",{class:"mt-2"},[i("strong",null,"Note:"),y(" Only unpaid users can be unfinalized. Paid users are permanently finalized. ")],-1))]),_:1}),d(W,{class:"pa-4"},{default:o(()=>[d(G),d(V,{color:"primary",onClick:e[15]||(e[15]=r=>a.showPaidUsersWarning=!1)},{default:o(()=>e[65]||(e[65]=[y("OK")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),d($,{modelValue:a.showUnfinalizedDialog,"onUpdate:modelValue":e[17]||(e[17]=r=>a.showUnfinalizedDialog=r),"max-width":"500px"},{default:o(()=>[d(Y,null,{default:o(()=>[d(H,{class:"text-h5 bg-warning text-white"},{default:o(()=>e[66]||(e[66]=[y(" Process Unfinalized Users ")])),_:1}),d(J,{class:"pa-4 mt-4"},{default:o(()=>[i("p",null," Found "+c(a.unfinalizedUsers.length)+" finalized users or else unselect that employee ",1),a.processingBatch?(D(),z(Ge,{key:0,value:a.currentBatch/a.totalBatches*100,height:"25",color:"warning",class:"mt-4"},{default:o(({value:r})=>[i("strong",null,c(Math.ceil(r))+"% Complete",1)]),_:1},8,["value"])):_("",!0)]),_:1}),d(W,{class:"pa-4"},{default:o(()=>[d(G),d(V,{color:"grey",onClick:n.cancelUnfinalizedProcess,disabled:a.processingBatch},{default:o(()=>e[67]||(e[67]=[y(" Cancel ")])),_:1},8,["onClick","disabled"]),d(V,{color:"warning",onClick:n.processUnfinalizedBatch,loading:a.processingBatch,disabled:a.processingBatch},{default:o(()=>[d(O,{left:""},{default:o(()=>e[68]||(e[68]=[y("mdi-account-check")])),_:1}),e[69]||(e[69]=y(" UnFinalized "))]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d($,{modelValue:a.showPaidUserSelectedDialog,"onUpdate:modelValue":e[19]||(e[19]=r=>a.showPaidUserSelectedDialog=r),"max-width":"500px"},{default:o(()=>[d(Y,null,{default:o(()=>[d(H,{class:"text-h5 bg-warning text-white"},{default:o(()=>e[70]||(e[70]=[y(" Paid User Selected ")])),_:1}),d(J,{class:"pa-4 mt-4"},{default:o(()=>e[71]||(e[71]=[i("p",null," You have selected a user who has already been paid. Paid users cannot be unfinalized. ",-1)])),_:1}),d(W,{class:"pa-4"},{default:o(()=>[d(G),d(V,{color:"grey",onClick:e[18]||(e[18]=r=>a.showPaidUserSelectedDialog=!1)},{default:o(()=>e[72]||(e[72]=[y("Cancel")])),_:1}),d(V,{color:"warning",onClick:n.skipPaidUsers},{default:o(()=>[d(O,{left:""},{default:o(()=>e[73]||(e[73]=[y("mdi-skip-next")])),_:1}),e[74]||(e[74]=y(" Skip Paid Users "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d($,{modelValue:a.showMixedPaidUsersDialog,"onUpdate:modelValue":e[21]||(e[21]=r=>a.showMixedPaidUsersDialog=r),"max-width":"500px"},{default:o(()=>[d(Y,null,{default:o(()=>[d(H,{class:"text-h5 bg-warning text-white"},{default:o(()=>e[75]||(e[75]=[y(" Some Selected Users Are Paid ")])),_:1}),d(J,{class:"pa-4 mt-4"},{default:o(()=>[i("p",null," You have selected "+c(a.paidUsersCount)+" paid users and "+c(a.unpaidUsersCount)+" unpaid users. ",1),e[76]||(e[76]=i("p",{class:"mt-2"},[i("strong",null,"Note:"),y(" Paid users cannot be unfinalized. Would you like to: ")],-1))]),_:1}),d(W,{class:"pa-4"},{default:o(()=>[d(G),d(V,{color:"grey",onClick:e[20]||(e[20]=r=>a.showMixedPaidUsersDialog=!1)},{default:o(()=>e[77]||(e[77]=[y("Cancel")])),_:1}),d(V,{color:"warning",onClick:n.skipPaidUsers},{default:o(()=>[d(O,{left:""},{default:o(()=>e[78]||(e[78]=[y("mdi-skip-next")])),_:1}),e[79]||(e[79]=y(" Skip Paid & Continue with Unpaid "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d($,{modelValue:a.showAttendancePopup,"onUpdate:modelValue":e[22]||(e[22]=r=>a.showAttendancePopup=r),"max-width":"500"},{default:o(()=>[d(Y,{rounded:"xl",class:"pa-4",elevation:"8"},{default:o(()=>[d(H,{class:"d-flex justify-space-between align-center"},{default:o(()=>e[80]||(e[80]=[i("span",{class:"text-h6 font-weight-bold"},"Processing Attendance",-1)])),_:1}),d(J,null,{default:o(()=>[t.isProcessing?(D(),v("div",qa,[d(Je,{indeterminate:"",color:"indigo",size:"40",class:"mb-4"}),i("p",La," Processing attendance for "+c(t.totalCount)+" employee(s)... ",1),i("p",$a," Finished: "+c(t.processedCount)+" / "+c(t.totalCount),1)])):(D(),v("div",Ya,[d(O,{size:"64",color:"green",class:"mb-4"},{default:o(()=>e[81]||(e[81]=[y("mdi-check-circle")])),_:1}),i("p",Ha," Successfully processed attendance for "+c(n.successCount)+" employee(s). Failed: "+c(t.failedCount),1)]))]),_:1}),d(W,{class:"justify-end"},{default:o(()=>[t.isProcessing?(D(),z(V,{key:0,color:"grey darken-1",dark:"",rounded:"",onClick:n.cancel},{default:o(()=>[d(O,{left:""},{default:o(()=>e[82]||(e[82]=[y("mdi-close")])),_:1}),e[83]||(e[83]=y(" Cancel "))]),_:1},8,["onClick"])):(D(),z(V,{key:1,color:"primary",dark:"",rounded:"",onClick:n.close},{default:o(()=>e[84]||(e[84]=[y(" OK ")])),_:1},8,["onClick"]))]),_:1})]),_:1})]),_:1},8,["modelValue"])])],2)}const Ga=We(Vt,[["render",Ja],["__scopeId","data-v-f0f6614e"]]);export{Ga as default};
