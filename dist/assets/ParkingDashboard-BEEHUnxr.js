import{r,c as A,o as L,l as S,i,f as e,w as l,g as T,e as _,h as u,j as d,a1 as f,F as R,B as z,n as B,q as H,x as y,a6 as M,ak as U,a7 as $,a8 as C,H as j,p as c,v as g,a2 as q,C as O,k as J,s as N,a3 as K,aJ as G}from"./index-B12n8wa1.js";import{p as x}from"./parkingService-BRMXjCST.js";import{p as Q}from"./passTemplateService-D9Jd4I3Q.js";const W={class:"d-flex align-end justify-space-between px-4 pb-2",style:{height:"250px"}},X={class:"text-caption text-grey",style:{"font-size":"10px"}},Y={class:"bg-black rounded mb-2 d-flex align-center justify-center white--text",style:{height:"150px"}},Z={key:0,class:"mb-4 text-caption text-grey"},se={__name:"ParkingDashboard",setup(ee){const p=r({occupied:0,available:0,totalSlots:0}),h=r([]),b=r([]),V=r(!1),k=r(!1),w=r(null),P=r(null),o=r({plateNumber:"",templateId:"",slot:""}),m=A(()=>b.value.find(s=>s.id===o.value.templateId)),D=[{title:"Plate Number",key:"plateNumber"},{title:"Pass Type",key:"templateName"},{title:"Slot",key:"slot"},{title:"Entry Time",key:"entryTime"},{title:"Actions",key:"actions",sortable:!1}],v=async()=>{V.value=!0;try{const[s,t,a]=await Promise.all([x.getStats(),x.getParkedVehicles(),Q.getAll()]);p.value=s,h.value=t,b.value=a.filter(n=>n.type==="Parking")}catch(s){console.error(s)}finally{V.value=!1}},E=async()=>{const{valid:s}=await P.value.validate();if(s){k.value=!0;try{await x.vehicleEntry({...o.value,templateName:m.value.name,costPerUnit:m.value.cost}),o.value={plateNumber:"",templateId:"",slot:""},await v()}catch(t){alert(t.message)}finally{k.value=!1}}},F=async s=>{w.value=s.id;try{const t=await x.vehicleExit(s.id),a=(new Date-new Date(s.entryTime))/36e5,n=s.costPerUnit||20,I=Math.ceil(a)*n;alert(`Vehicle Exited.
Duration: ${a.toFixed(2)} Hrs
Rate: ₹${n}/hr
Total Fee: ₹${I}`),await v()}catch(t){console.error(t)}finally{w.value=null}};return L(()=>{v()}),(s,t)=>(_(),S("div",null,[t[12]||(t[12]=i("h1",{class:"text-h4 mb-4"},"Parking Management",-1)),e(T,null,{default:l(()=>[e(u,{cols:"12",md:"4"},{default:l(()=>[e(d,{title:"Occupied Slots",text:p.value.occupied.toString(),color:"warning",variant:"tonal"},null,8,["text"])]),_:1}),e(u,{cols:"12",md:"4"},{default:l(()=>[e(d,{title:"Available Slots",text:p.value.available.toString(),color:"success",variant:"tonal"},null,8,["text"])]),_:1}),e(u,{cols:"12",md:"4"},{default:l(()=>[e(d,{title:"Total Capacity",text:p.value.totalSlots.toString(),variant:"outlined"},null,8,["text"])]),_:1})]),_:1}),e(T,{class:"mt-2 text-left"},{default:l(()=>[e(u,{cols:"12",md:"8"},{default:l(()=>[e(d,{title:"Occupancy Trends",subtitle:"24 Hour History"},{default:l(()=>[e(f,null,{default:l(()=>[i("div",W,[(_(),S(R,null,z([20,35,60,85,95,80,55,30,15,10,5,25],(a,n)=>i("div",{key:n,class:"d-flex flex-column align-center",style:{width:"7%"}},[i("div",{class:H([a>80?"bg-error":a>50?"bg-warning":"bg-success","rounded-t mb-1 opacity-80"]),style:B({width:"70%",height:a+"%"})},null,6),i("div",X,y(8+n)+"h",1)])),64))])]),_:1})]),_:1})]),_:1}),e(u,{cols:"12",md:"4"},{default:l(()=>[e(d,{title:"Revenue Snapshot",subtitle:"Today"},{default:l(()=>[e(f,null,{default:l(()=>[t[3]||(t[3]=i("div",{class:"d-flex align-end mb-2"},[i("div",{class:"text-h4 font-weight-bold text-success"},"₹12,450"),i("div",{class:"text-caption text-success mb-1 ml-2"},"+15% vs Avg")],-1)),e(M,{"model-value":"75",color:"success",height:"8",rounded:""}),t[4]||(t[4]=i("div",{class:"text-caption text-grey mt-1"},"75% of daily target",-1))]),_:1}),e(U),e($,{density:"compact"},{default:l(()=>[e(C,{title:"Premium Slots",subtitle:"₹4,500"},{prepend:l(()=>t[5]||(t[5]=[i("div",{class:"mr-2 text-body-2"},"36%",-1)])),_:1}),e(C,{title:"Regular Slots",subtitle:"₹7,950"},{prepend:l(()=>t[6]||(t[6]=[i("div",{class:"mr-2 text-body-2"},"64%",-1)])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{class:"mt-4"},{default:l(()=>[e(u,{cols:"12",md:"5"},{default:l(()=>[e(d,{title:"Video Entry",class:"mb-4"},{default:l(()=>[e(f,{class:"text-center"},{default:l(()=>[i("div",Y,[e(j,{color:"grey",size:"48"},{default:l(()=>t[7]||(t[7]=[c("mdi-cctv")])),_:1}),t[8]||(t[8]=i("span",{class:"ml-2"},"Live Camera Feed",-1))]),e(g,{block:"",color:"primary","prepend-icon":"mdi-camera"},{default:l(()=>t[9]||(t[9]=[c("Capture Plate")])),_:1})]),_:1})]),_:1}),e(d,{title:"Manual Entry"},{default:l(()=>[e(f,null,{default:l(()=>[e(q,{onSubmit:O(E,["prevent"]),ref_key:"entryForm",ref:P},{default:l(()=>[e(N,{modelValue:o.value.plateNumber,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.plateNumber=a),label:"Vehicle Number (e.g. KA-01-AB-1234)",variant:"outlined",rules:[a=>!!a||"Required"]},null,8,["modelValue","rules"]),e(K,{modelValue:o.value.templateId,"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.templateId=a),label:"Pass Type",items:b.value,"item-title":"name","item-value":"id",variant:"outlined",rules:[a=>!!a||"Required"]},null,8,["modelValue","items","rules"]),e(N,{modelValue:o.value.slot,"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.slot=a),label:"Assign Slot (Optional)",variant:"outlined"},null,8,["modelValue"]),m.value?(_(),S("div",Z," Rate: ₹"+y(m.value.cost)+" / "+y(m.value.duration)+" Hours ",1)):J("",!0),e(g,{block:"",color:"secondary",size:"large",type:"submit",loading:k.value},{default:l(()=>t[10]||(t[10]=[c("Log Entry")])),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1})]),_:1}),e(u,{cols:"12",md:"7"},{default:l(()=>[e(d,{title:"Parked Vehicles"},{append:l(()=>[e(g,{icon:"mdi-refresh",variant:"text",onClick:v})]),default:l(()=>[e(G,{headers:D,items:h.value,loading:V.value},{"item.entryTime":l(({item:a})=>[c(y(new Date(a.entryTime).toLocaleTimeString()),1)]),"item.actions":l(({item:a})=>[e(g,{size:"small",color:"error",variant:"tonal",onClick:n=>F(a),loading:w.value===a.id},{default:l(()=>t[11]||(t[11]=[c(" Exit ")])),_:2},1032,["onClick","loading"])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]))}};export{se as default};
